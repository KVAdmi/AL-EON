import{c as I,a as Q,e as fe,r as N,j as a,_ as Oe,R as De,X as ye,u as We}from"./index-e4e1323c.js";import{u as Z,A as Ae,p as Fe,E as Ye,I as $e}from"./EmailComposer-037afb78.js";import{s as Ie,e as qe,r as Re,v as ee,g as Le}from"./emailService-c4da49df.js";import{M as L}from"./mail-1aad0795.js";import{E as te}from"./eye-off-ed9c0be4.js";import{E as re}from"./eye-3ec80a3c.js";import{L as G}from"./loader-2-b4ab27ec.js";import{C as J}from"./check-circle-3feff249.js";import{X as ae}from"./x-circle-14dea691.js";import{S as xe}from"./send-1877c269.js";import{A as pe}from"./arrow-left-1a8dd8e5.js";import{A as ze}from"./arrow-right-ec1bb1bb.js";import{R as oe}from"./refresh-cw-3a330f0d.js";import{A as K}from"./alert-circle-55dbc938.js";import{T as be}from"./trash-2-720af3a0.js";import{C as He}from"./calendar-e8089789.js";import{P as ne}from"./paperclip-ea40dd47.js";import{D as Xe}from"./download-d08d90ee.js";import{P as se}from"./plus-b374ad1c.js";import{M as Ve,S as Ge}from"./settings-4f3ac8dd.js";import{M as Be}from"./mic-5fe6cbf6.js";import{F as Qe}from"./file-text-dbc5a523.js";import"./save-8c42dcad.js";import"./requestId-b38e007e.js";const Ue=I("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]),Je=I("Forward",[["polyline",{points:"15 17 20 12 15 7",key:"1w3sku"}],["path",{d:"M4 18v-2a4 4 0 0 1 4-4h12",key:"jmiej9"}]]),Ke=I("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),Ze=I("MailOpen",[["path",{d:"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z",key:"1jhwl8"}],["path",{d:"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10",key:"1qfld7"}]]),et=I("ReplyAll",[["polyline",{points:"7 17 2 12 7 7",key:"t83bqg"}],["polyline",{points:"12 17 7 12 12 7",key:"1g4ajm"}],["path",{d:"M22 18v-2a4 4 0 0 0-4-4H7",key:"1fcyog"}]]),tt=I("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]),rt=I("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]),ge=I("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),at=[{id:"gmail",name:"Gmail",icon:"ðŸ“§",smtp:{host:"smtp.gmail.com",port:587,secure:!1},imap:{host:"imap.gmail.com",port:993,secure:!0},help:"Usa una contraseÃ±a de aplicaciÃ³n, no tu contraseÃ±a normal."},{id:"outlook",name:"Outlook / Office 365",icon:"ðŸ“¨",smtp:{host:"smtp.office365.com",port:587,secure:!1},imap:{host:"outlook.office365.com",port:993,secure:!0},help:"AsegÃºrate de tener IMAP habilitado en la configuraciÃ³n de tu cuenta."},{id:"yahoo",name:"Yahoo Mail",icon:"ðŸ’Œ",smtp:{host:"smtp.mail.yahoo.com",port:587,secure:!1},imap:{host:"imap.mail.yahoo.com",port:993,secure:!0},help:"Genera una contraseÃ±a de aplicaciÃ³n desde tu cuenta de Yahoo."},{id:"other",name:"Otro proveedor",icon:"âœ‰ï¸",smtp:{host:"",port:587,secure:!1},imap:{host:"",port:993,secure:!0},help:"Configura manualmente tu proveedor de correo."}];function ot({onComplete:e,onCancel:t}){const{toast:r}=Q(),{accessToken:o}=fe(),[n,l]=N.useState(1),[i,x]=N.useState(null),[y,p]=N.useState({imap:!1,smtp:!1}),[u,v]=N.useState({imap:null,smtp:null}),[P,E]=N.useState(!1),[M,T]=N.useState({imap:!1,smtp:!1}),[f,_]=N.useState({provider:"",fromName:"",fromEmail:"",imap:{host:"",port:993,secure:!0,user:"",password:""},smtp:{host:"",port:587,secure:!1,user:"",password:""}}),j=d=>{x(d),_({...f,provider:d.id,imap:{...f.imap,...d.imap},smtp:{...f.smtp,...d.smtp}})},c=(d,s,w)=>{_(d?{...f,[d]:{...f[d],[s]:w}}:{...f,[s]:w})},b=async()=>{if(!f.imap.host||!f.imap.user||!f.imap.password){r.error("Completa todos los campos IMAP");return}p({...y,imap:!0}),v({...u,imap:null});try{const s=await(await fetch("https://api.al-eon.com/api/email/test-imap",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(f.imap)})).json();s.success?(v({...u,imap:{success:!0,message:s.message}}),r.success("âœ“ ConexiÃ³n IMAP exitosa")):(v({...u,imap:{success:!1,message:s.message}}),r.error(s.message||"Error en conexiÃ³n IMAP"))}catch(d){v({...u,imap:{success:!1,message:d.message}}),r.error("Error al probar IMAP: "+d.message)}finally{p({...y,imap:!1})}},k=async()=>{if(!f.smtp.host||!f.smtp.user||!f.smtp.password){r.error("Completa todos los campos SMTP");return}p({...y,smtp:!0}),v({...u,smtp:null});try{const s=await(await fetch("https://api.al-eon.com/api/email/test-smtp",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(f.smtp)})).json();s.success?(v({...u,smtp:{success:!0,message:s.message}}),r.success("âœ“ ConexiÃ³n SMTP exitosa")):(v({...u,smtp:{success:!1,message:s.message}}),r.error(s.message||"Error en conexiÃ³n SMTP"))}catch(d){v({...u,smtp:{success:!1,message:d.message}}),r.error("Error al probar SMTP: "+d.message)}finally{p({...y,smtp:!1})}},m=async()=>{if(!f.fromName||!f.fromEmail){r.error("Completa el nombre y email del remitente");return}E(!0);try{const d={"Content-Type":"application/json"};o&&(d.Authorization=`Bearer ${o}`);const s=await fetch("https://api.al-eon.com/api/email/accounts",{method:"POST",headers:d,credentials:"include",body:JSON.stringify(f)}),w=await s.json();if(!s.ok)throw new Error(w.message||"Error al guardar cuenta");r.success("âœ“ Cuenta guardada exitosamente");try{r.info("Sincronizando correos..."),await Ie(w.id),r.success("âœ“ SincronizaciÃ³n completa")}catch(S){console.warn("[EmailConfigWizard] âš ï¸ No se pudo sincronizar automÃ¡ticamente:",S.message),r.warning("âš ï¸ Cuenta guardada pero la sincronizaciÃ³n fallÃ³. Puedes sincronizar manualmente mÃ¡s tarde.")}e&&e(w)}catch(d){r.error("Error: "+d.message)}finally{E(!1)}},C=()=>{var d,s;return n===1?i!==null:n===2?((d=u.imap)==null?void 0:d.success)===!0:n===3?((s=u.smtp)==null?void 0:s.success)===!0:!1};return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",style:{backgroundColor:"rgba(0, 0, 0, 0.5)"},children:a.jsxs("div",{className:"max-w-3xl w-full rounded-2xl shadow-2xl overflow-hidden",style:{backgroundColor:"var(--color-bg-primary)"},children:[a.jsxs("div",{className:"px-6 py-4 border-b",style:{borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(L,{className:"w-6 h-6",style:{color:"var(--color-primary)"}}),a.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text-primary)"},children:"Configurar Cuenta de Correo"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-sm",style:{color:"var(--color-text-secondary)"},children:["Paso ",n," de 3"]})]}),a.jsx("div",{className:"mt-4 h-1.5 rounded-full",style:{backgroundColor:"var(--color-bg-tertiary)"},children:a.jsx("div",{className:"h-full rounded-full transition-all duration-300",style:{backgroundColor:"var(--color-primary)",width:`${n/3*100}%`}})})]}),a.jsxs("div",{className:"p-6 max-h-[70vh] overflow-y-auto",children:[n===1&&a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-text-primary)"},children:"Selecciona tu proveedor de correo"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:at.map(d=>a.jsxs("button",{onClick:()=>j(d),className:`p-4 rounded-2xl border-2 transition-all text-left ${(i==null?void 0:i.id)===d.id?"ring-2":""}`,style:{backgroundColor:(i==null?void 0:i.id)===d.id?"var(--color-bg-secondary)":"var(--color-bg-primary)",borderColor:(i==null?void 0:i.id)===d.id?"var(--color-primary)":"var(--color-border)",ringColor:"var(--color-primary)"},children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("span",{className:"text-3xl",children:d.icon}),a.jsx("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:d.name})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:d.help})]},d.id))})]}),n===2&&a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-start gap-3 p-3 rounded-2xl",style:{backgroundColor:"var(--color-bg-secondary)"},children:[a.jsx(Ke,{className:"w-5 h-5 mt-0.5 shrink-0",style:{color:"var(--color-primary)"}}),a.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:i==null?void 0:i.help})]}),a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"ConfiguraciÃ³n IMAP (RecepciÃ³n)"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Servidor IMAP *"}),a.jsx("input",{type:"text",value:f.imap.host,onChange:d=>c("imap","host",d.target.value),placeholder:(i==null?void 0:i.id)==="other"?"imap.tudominio.com":"",className:"w-full px-4 py-2.5 rounded-2xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Puerto *"}),a.jsx("input",{type:"number",value:f.imap.port,onChange:d=>c("imap","port",parseInt(d.target.value)),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsx("div",{className:"flex items-center h-full",children:a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:f.imap.secure,onChange:d=>c("imap","secure",d.target.checked),className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-primary)"},children:"Usar SSL/TLS"})]})}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Usuario IMAP *"}),a.jsx("input",{type:"text",value:f.imap.user,onChange:d=>c("imap","user",d.target.value),placeholder:"tu@email.com",className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"ContraseÃ±a / App Password *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:M.imap?"text":"password",value:f.imap.password,onChange:d=>c("imap","password",d.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-4 py-2.5 pr-12 rounded-2xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0}),a.jsx("button",{type:"button",onClick:()=>T({...M,imap:!M.imap}),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded hover:opacity-70 transition-all",style:{color:"var(--color-text-secondary)"},children:M.imap?a.jsx(te,{className:"w-5 h-5"}):a.jsx(re,{className:"w-5 h-5"})})]})]})]}),a.jsx("button",{onClick:b,disabled:y.imap,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-2xl font-medium transition-all",style:{backgroundColor:y.imap?"var(--color-bg-tertiary)":"var(--color-primary)",color:"white"},children:y.imap?a.jsxs(a.Fragment,{children:[a.jsx(G,{className:"w-5 h-5 animate-spin"}),"Probando conexiÃ³n..."]}):a.jsxs(a.Fragment,{children:[a.jsx(rt,{className:"w-5 h-5"}),"Probar ConexiÃ³n IMAP"]})}),u.imap&&a.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-2xl ${u.imap.success?"bg-green-50":"bg-red-50"}`,children:[u.imap.success?a.jsx(J,{className:"w-5 h-5 text-green-600 shrink-0 mt-0.5"}):a.jsx(ae,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`font-medium ${u.imap.success?"text-green-900":"text-red-900"}`,children:u.imap.success?"Â¡ConexiÃ³n exitosa!":"Error en la conexiÃ³n"}),a.jsx("p",{className:`text-sm mt-1 ${u.imap.success?"text-green-700":"text-red-700"}`,children:u.imap.message})]})]})]}),n===3&&a.jsxs("div",{className:"space-y-4",children:[a.jsx("h3",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:"ConfiguraciÃ³n SMTP (EnvÃ­o)"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Nombre del remitente *"}),a.jsx("input",{type:"text",value:f.fromName,onChange:d=>c(null,"fromName",d.target.value),placeholder:"Tu Nombre",className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Email del remitente *"}),a.jsx("input",{type:"email",value:f.fromEmail,onChange:d=>c(null,"fromEmail",d.target.value),placeholder:"tu@email.com",className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Servidor SMTP *"}),a.jsx("input",{type:"text",value:f.smtp.host,onChange:d=>c("smtp","host",d.target.value),placeholder:(i==null?void 0:i.id)==="other"?"smtp.tudominio.com":"",className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Puerto *"}),a.jsx("input",{type:"number",value:f.smtp.port,onChange:d=>c("smtp","port",parseInt(d.target.value)),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsx("div",{className:"flex items-center h-full",children:a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:f.smtp.secure,onChange:d=>c("smtp","secure",d.target.checked),className:"w-4 h-4"}),a.jsx("span",{className:"text-sm",style:{color:"var(--color-text-primary)"},children:"Usar TLS"})]})}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Usuario SMTP *"}),a.jsx("input",{type:"text",value:f.smtp.user,onChange:d=>c("smtp","user",d.target.value),placeholder:"tu@email.com",className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),a.jsxs("div",{className:"md:col-span-2",children:[a.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"ContraseÃ±a / App Password *"}),a.jsxs("div",{className:"relative",children:[a.jsx("input",{type:M.smtp?"text":"password",value:f.smtp.password,onChange:d=>c("smtp","password",d.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",className:"w-full px-4 py-2.5 pr-12 rounded-2xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0}),a.jsx("button",{type:"button",onClick:()=>T({...M,smtp:!M.smtp}),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1.5 rounded hover:opacity-70 transition-all",style:{color:"var(--color-text-secondary)"},children:M.smtp?a.jsx(te,{className:"w-5 h-5"}):a.jsx(re,{className:"w-5 h-5"})})]})]})]}),a.jsx("button",{onClick:k,disabled:y.smtp,className:"w-full flex items-center justify-center gap-2 px-4 py-3 rounded-2xl font-medium transition-all",style:{backgroundColor:y.smtp?"var(--color-bg-tertiary)":"var(--color-primary)",color:"white"},children:y.smtp?a.jsxs(a.Fragment,{children:[a.jsx(G,{className:"w-5 h-5 animate-spin"}),"Probando conexiÃ³n..."]}):a.jsxs(a.Fragment,{children:[a.jsx(xe,{className:"w-5 h-5"}),"Probar ConexiÃ³n SMTP"]})}),u.smtp&&a.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-2xl ${u.smtp.success?"bg-green-50":"bg-red-50"}`,children:[u.smtp.success?a.jsx(J,{className:"w-5 h-5 text-green-600 shrink-0 mt-0.5"}):a.jsx(ae,{className:"w-5 h-5 text-red-600 shrink-0 mt-0.5"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:`font-medium ${u.smtp.success?"text-green-900":"text-red-900"}`,children:u.smtp.success?"Â¡ConexiÃ³n exitosa!":"Error en la conexiÃ³n"}),a.jsx("p",{className:`text-sm mt-1 ${u.smtp.success?"text-green-700":"text-red-700"}`,children:u.smtp.message})]})]})]})]}),a.jsxs("div",{className:"px-6 py-4 border-t flex items-center justify-between",style:{borderColor:"var(--color-border)"},children:[a.jsxs("button",{onClick:()=>{n>1?l(n-1):t()},className:"flex items-center gap-2 px-4 py-2 rounded-2xl",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},children:[a.jsx(pe,{className:"w-4 h-4"}),n===1?"Cancelar":"Anterior"]}),n<3?a.jsxs("button",{onClick:()=>l(n+1),disabled:!C(),className:"flex items-center gap-2 px-6 py-2 rounded-2xl font-medium transition-all disabled:opacity-50",style:{backgroundColor:C()?"var(--color-primary)":"var(--color-bg-tertiary)",color:"white"},children:["Siguiente",a.jsx(ze,{className:"w-4 h-4"})]}):a.jsx("button",{onClick:m,disabled:!C()||P,className:"flex items-center gap-2 px-6 py-2 rounded-2xl font-medium transition-all disabled:opacity-50",style:{backgroundColor:C()&&!P?"var(--color-primary)":"var(--color-bg-tertiary)",color:"white"},children:P?a.jsxs(a.Fragment,{children:[a.jsx(G,{className:"w-5 h-5 animate-spin"}),"Guardando..."]}):a.jsxs(a.Fragment,{children:[a.jsx(J,{className:"w-5 h-5"}),"Guardar y Sincronizar"]})})]})]})})}function nt({accountId:e,folder:t,onSelectMessage:r}){const{toast:o}=Q(),{setRefreshMessages:n}=Z(),[l,i]=N.useState([]),[x,y]=N.useState(!0),[p,u]=N.useState(null),[v,P]=N.useState(!1),[E,M]=N.useState(!1);N.useEffect(()=>{T(),n(T)},[e,t]);async function T(){if(e)try{y(!0);const{supabase:c}=await Oe(()=>import("./index-e4e1323c.js").then(s=>s.n),["assets/index-e4e1323c.js","assets/index-76a80d91.css"]);console.log("[EmailInbox] ðŸ“¬ Cargando mensajes para:",{accountId:e,folder:t});let b=null;if(t){const w={inbox:"Inbox",sent:"Sent",drafts:"Drafts",starred:"Starred",spam:"Spam",archive:"Archive",trash:"Trash"}[t]||t;console.log(`[EmailInbox] ðŸ” FILTRO APLICADO: folder UI="${t}" â†’ DB folder_type="${w}"`);const{data:S,error:A}=await c.from("email_folders").select("id").eq("account_id",e).eq("folder_type",w).single();A?console.warn(`[EmailInbox] âš ï¸ No se encontrÃ³ folder tipo "${w}":`,A):S!=null&&S.id&&(b=S.id,console.log(`[EmailInbox] âœ… Folder encontrado: id=${b}`))}else console.log("[EmailInbox] âš ï¸ NO HAY FOLDER, trayendo TODOS los mensajes");let k=c.from("email_messages").select(`
          *,
          folder:email_folders!folder_id(id, folder_name, folder_type, imap_path)
        `).eq("account_id",e);b&&(k=k.eq("folder_id",b),console.log(`[EmailInbox] ðŸ” Filtrando por folder_id: ${b}`)),k=k.order("sent_at",{ascending:!1});const{data:m,error:C}=await k;if(console.log(`[EmailInbox] ðŸ“Š RESULTADO: ${(m==null?void 0:m.length)||0} mensajes`),console.log("[EmailInbox] ðŸ“‹ Folders Ãºnicos en resultado:",[...new Set((m||[]).map(s=>{var w,S;return((w=s.folder)==null?void 0:w.folder_name)||((S=s.folder)==null?void 0:S.folder_type)||"sin folder"}))].join(", ")),t&&m&&m.length>0){const w={inbox:"Inbox",sent:"Sent",drafts:"Drafts",starred:"Starred",spam:"Spam",archive:"Archive",trash:"Trash"}[t]||t,S=[...new Set(m.map(H=>{var V;return((V=H.folder)==null?void 0:V.folder_type)||"sin folder"}))];S.every(H=>H===w)?console.log(`[EmailInbox] âœ… FILTRO OK: Todos los mensajes son de "${w}"`):(console.error("[EmailInbox] âŒ FILTRO NO FUNCIONA:"),console.error(`  â†’ Esperaba folder_type="${w}"`),console.error(`  â†’ RecibÃ­ folder_types="${S.join(", ")}"`),console.error(`  â†’ Supabase query .eq('folder.folder_type', '${w}') NO estÃ¡ filtrando`))}if(C){console.error("[EmailInbox] Error de Supabase:",C),i([]);return}const d=(m||[]).filter(s=>s.id?!s.from_address&&!s.from_email?(console.warn("[EmailInbox] âš ï¸ Mensaje sin remitente, ignorado. ID:",s.id),!1):!0:(console.warn("[EmailInbox] âš ï¸ Mensaje sin ID, ignorado:",s),!1)).map(s=>{var w,S,A;return{id:s.id,from:s.from_name||s.from_address||s.from_email||"Desconocido",from_address:s.from_address||s.from_email||"unknown@example.com",from_name:s.from_name||s.from_address||null,to_addresses:s.to_addresses||[],cc_addresses:s.cc_addresses||[],bcc_addresses:s.bcc_addresses||[],subject:s.subject||"(Sin asunto)",preview:s.body_preview||((w=s.body_text)==null?void 0:w.substring(0,100))||((S=s.body_html)==null?void 0:S.substring(0,100).replace(/<[^>]*>/g,""))||"",body_text:s.body_text||"",body_html:s.body_html||"",date:s.date||s.sent_at||s.received_at||s.created_at,sent_at:s.sent_at||s.date,received_at:s.received_at,created_at:s.created_at,read:s.is_read||!1,is_read:s.is_read||!1,starred:s.is_starred||!1,is_starred:s.is_starred||!1,folder:s.folder,account_id:s.account_id,has_attachments:s.has_attachments||!1,attachments:s.attachments||[],attachment_count:((A=s.attachments)==null?void 0:A.length)||0}});console.log(`[EmailInbox] âœ… ${d.length} mensajes vÃ¡lidos de ${(m==null?void 0:m.length)||0} totales`),i(d)}catch(c){console.error("Error cargando mensajes:",c),o({variant:"destructive",title:"Error",description:c.message||"No se pudieron cargar los mensajes"})}finally{y(!1)}}async function f(){P(!0),await T(),P(!1)}async function _(c){var b,k;try{u(c.id),M(!0),console.log("[EmailInbox] ðŸ“§ Cargando mensaje completo:",c.id);const m=await qe(e,c.id);console.log("[EmailInbox] âœ… Mensaje completo recibido:",{id:m.id,has_body_html:!!m.body_html,has_body_text:!!m.body_text,body_html_length:((b=m.body_html)==null?void 0:b.length)||0,body_text_length:((k=m.body_text)==null?void 0:k.length)||0}),r&&r(m)}catch(m){console.error("[EmailInbox] âŒ Error cargando mensaje completo:",m),o({variant:"destructive",title:"Error",description:"No se pudo cargar el contenido del mensaje"}),r&&r(c)}finally{M(!1)}}function j(c){if(!c)return"Sin fecha";try{const b=new Date(c);if(isNaN(b.getTime()))return"Fecha invÃ¡lida";const k=new Date,m=new Date(k);return m.setDate(m.getDate()-1),b.toDateString()===k.toDateString()?b.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):b.toDateString()===m.toDateString()?"Ayer":b.getFullYear()===k.getFullYear()?b.toLocaleDateString("es-ES",{day:"numeric",month:"short"}):b.toLocaleDateString("es-ES",{day:"numeric",month:"short",year:"numeric"})}catch(b){return console.error("Error formatting date:",c,b),"Sin fecha"}}return x?a.jsx("div",{className:"flex-1 flex items-center justify-center",style:{color:"var(--color-text-secondary)"},children:"Cargando mensajes..."}):a.jsxs("div",{className:"flex-1 flex flex-col",children:[a.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",style:{borderColor:"var(--color-border)"},children:[a.jsxs("h3",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:[t==="inbox"&&"Bandeja de entrada",t==="sent"&&"Enviados",t==="starred"&&"Destacados",t==="archive"&&"Archivados",t==="trash"&&"Papelera",!t&&"Todos los mensajes"]}),a.jsx("button",{onClick:f,disabled:v,className:"p-2 rounded-lg transition-all hover:opacity-80",style:{color:"var(--color-text-secondary)"},title:"Sincronizar mensajes",children:a.jsx(oe,{size:18,className:v?"animate-spin":""})})]}),l.length===0?a.jsx("div",{className:"flex-1 flex items-center justify-center p-6",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsx(L,{size:48,className:"mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"No hay mensajes en esta carpeta"}),a.jsx("p",{className:"text-sm mb-4",style:{color:"var(--color-text-secondary)"},children:"Los mensajes que envÃ­es o recibas aparecerÃ¡n aquÃ­."}),a.jsxs("button",{onClick:f,disabled:v,className:"flex items-center gap-2 px-4 py-2 rounded-lg mx-auto transition-all hover:opacity-90",style:{backgroundColor:"var(--color-primary)",color:"white"},children:[a.jsx(oe,{size:16,className:v?"animate-spin":""}),"Sincronizar ahora"]})]})}):a.jsx("div",{className:"flex-1 overflow-y-auto",children:l.map(c=>a.jsx("button",{onClick:()=>_(c),disabled:E&&p===c.id,className:`w-full px-4 py-3 border-b text-left transition-all hover:opacity-80 ${p===c.id?"font-medium":""} ${E&&p===c.id?"opacity-50 cursor-wait":""}`,style:{backgroundColor:p===c.id?"var(--color-bg-secondary)":"transparent",borderColor:"var(--color-border)"},children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"mt-1",children:c.read?a.jsx(Ze,{size:16,style:{color:"var(--color-text-tertiary)"}}):a.jsx(L,{size:16,style:{color:"var(--color-accent)"}})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"font-medium truncate",style:{color:"var(--color-text-primary)"},children:c.from}),a.jsx("span",{className:"text-xs ml-2 flex-shrink-0",style:{color:"var(--color-text-tertiary)"},children:j(c.date||c.sent_at||c.received_at||c.created_at)})]}),a.jsx("p",{className:"text-sm truncate mb-1",style:{color:c.read?"var(--color-text-secondary)":"var(--color-text-primary)",fontWeight:c.read?"normal":"500"},children:c.subject||"(Sin asunto)"}),a.jsx("p",{className:"text-xs truncate",style:{color:"var(--color-text-tertiary)"},children:c.preview})]})]})},c.id))})]})}const ve=6048e5,st=864e5,le=Symbol.for("constructDateFrom");function $(e,t){return typeof e=="function"?e(t):e&&typeof e=="object"&&le in e?e[le](t):e instanceof Date?new e.constructor(t):new Date(t)}function O(e,t){return $(t||e,e)}let lt={};function U(){return lt}function X(e,t){var x,y,p,u;const r=U(),o=(t==null?void 0:t.weekStartsOn)??((y=(x=t==null?void 0:t.locale)==null?void 0:x.options)==null?void 0:y.weekStartsOn)??r.weekStartsOn??((u=(p=r.locale)==null?void 0:p.options)==null?void 0:u.weekStartsOn)??0,n=O(e,t==null?void 0:t.in),l=n.getDay(),i=(l<o?7:0)+l-o;return n.setDate(n.getDate()-i),n.setHours(0,0,0,0),n}function B(e,t){return X(e,{...t,weekStartsOn:1})}function we(e,t){const r=O(e,t==null?void 0:t.in),o=r.getFullYear(),n=$(r,0);n.setFullYear(o+1,0,4),n.setHours(0,0,0,0);const l=B(n),i=$(r,0);i.setFullYear(o,0,4),i.setHours(0,0,0,0);const x=B(i);return r.getTime()>=l.getTime()?o+1:r.getTime()>=x.getTime()?o:o-1}function ie(e){const t=O(e),r=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds(),t.getMilliseconds()));return r.setUTCFullYear(t.getFullYear()),+e-+r}function it(e,...t){const r=$.bind(null,e||t.find(o=>typeof o=="object"));return t.map(r)}function ce(e,t){const r=O(e,t==null?void 0:t.in);return r.setHours(0,0,0,0),r}function ct(e,t,r){const[o,n]=it(r==null?void 0:r.in,e,t),l=ce(o),i=ce(n),x=+l-ie(l),y=+i-ie(i);return Math.round((x-y)/st)}function dt(e,t){const r=we(e,t),o=$((t==null?void 0:t.in)||e,0);return o.setFullYear(r,0,4),o.setHours(0,0,0,0),B(o)}function mt(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function ut(e){return!(!mt(e)&&typeof e!="number"||isNaN(+O(e)))}function ht(e,t){const r=O(e,t==null?void 0:t.in);return r.setFullYear(r.getFullYear(),0,1),r.setHours(0,0,0,0),r}const ft={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},yt=(e,t,r)=>{let o;const n=ft[e];return typeof n=="string"?o=n:t===1?o=n.one:o=n.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"in "+o:o+" ago":o};function z(e){return(t={})=>{const r=t.width?String(t.width):e.defaultWidth;return e.formats[r]||e.formats[e.defaultWidth]}}const xt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},pt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},bt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},gt={date:z({formats:xt,defaultWidth:"full"}),time:z({formats:pt,defaultWidth:"full"}),dateTime:z({formats:bt,defaultWidth:"full"})},vt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},wt=(e,t,r,o)=>vt[e];function D(e){return(t,r)=>{const o=r!=null&&r.context?String(r.context):"standalone";let n;if(o==="formatting"&&e.formattingValues){const i=e.defaultFormattingWidth||e.defaultWidth,x=r!=null&&r.width?String(r.width):i;n=e.formattingValues[x]||e.formattingValues[i]}else{const i=e.defaultWidth,x=r!=null&&r.width?String(r.width):e.defaultWidth;n=e.values[x]||e.values[i]}const l=e.argumentCallback?e.argumentCallback(t):t;return n[l]}}const jt={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Nt={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},kt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ct={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Mt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Pt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},St=(e,t)=>{const r=Number(e),o=r%100;if(o>20||o<10)switch(o%10){case 1:return r+"st";case 2:return r+"nd";case 3:return r+"rd"}return r+"th"},Et={ordinalNumber:St,era:D({values:jt,defaultWidth:"wide"}),quarter:D({values:Nt,defaultWidth:"wide",argumentCallback:e=>e-1}),month:D({values:kt,defaultWidth:"wide"}),day:D({values:Ct,defaultWidth:"wide"}),dayPeriod:D({values:Mt,defaultWidth:"wide",formattingValues:Pt,defaultFormattingWidth:"wide"})};function W(e){return(t,r={})=>{const o=r.width,n=o&&e.matchPatterns[o]||e.matchPatterns[e.defaultMatchWidth],l=t.match(n);if(!l)return null;const i=l[0],x=o&&e.parsePatterns[o]||e.parsePatterns[e.defaultParseWidth],y=Array.isArray(x)?Tt(x,v=>v.test(i)):_t(x,v=>v.test(i));let p;p=e.valueCallback?e.valueCallback(y):y,p=r.valueCallback?r.valueCallback(p):p;const u=t.slice(i.length);return{value:p,rest:u}}}function _t(e,t){for(const r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t(e[r]))return r}function Tt(e,t){for(let r=0;r<e.length;r++)if(t(e[r]))return r}function je(e){return(t,r={})=>{const o=t.match(e.matchPattern);if(!o)return null;const n=o[0],l=t.match(e.parsePattern);if(!l)return null;let i=e.valueCallback?e.valueCallback(l[0]):l[0];i=r.valueCallback?r.valueCallback(i):i;const x=t.slice(n.length);return{value:i,rest:x}}}const Ot=/^(\d+)(th|st|nd|rd)?/i,Dt=/\d+/i,Wt={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},At={any:[/^b/i,/^(a|c)/i]},Ft={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Yt={any:[/1/i,/2/i,/3/i,/4/i]},$t={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},It={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},qt={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Rt={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Lt={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},zt={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ht={ordinalNumber:je({matchPattern:Ot,parsePattern:Dt,valueCallback:e=>parseInt(e,10)}),era:W({matchPatterns:Wt,defaultMatchWidth:"wide",parsePatterns:At,defaultParseWidth:"any"}),quarter:W({matchPatterns:Ft,defaultMatchWidth:"wide",parsePatterns:Yt,defaultParseWidth:"any",valueCallback:e=>e+1}),month:W({matchPatterns:$t,defaultMatchWidth:"wide",parsePatterns:It,defaultParseWidth:"any"}),day:W({matchPatterns:qt,defaultMatchWidth:"wide",parsePatterns:Rt,defaultParseWidth:"any"}),dayPeriod:W({matchPatterns:Lt,defaultMatchWidth:"any",parsePatterns:zt,defaultParseWidth:"any"})},Xt={code:"en-US",formatDistance:yt,formatLong:gt,formatRelative:wt,localize:Et,match:Ht,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Vt(e,t){const r=O(e,t==null?void 0:t.in);return ct(r,ht(r))+1}function Gt(e,t){const r=O(e,t==null?void 0:t.in),o=+B(r)-+dt(r);return Math.round(o/ve)+1}function Ne(e,t){var u,v,P,E;const r=O(e,t==null?void 0:t.in),o=r.getFullYear(),n=U(),l=(t==null?void 0:t.firstWeekContainsDate)??((v=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:v.firstWeekContainsDate)??n.firstWeekContainsDate??((E=(P=n.locale)==null?void 0:P.options)==null?void 0:E.firstWeekContainsDate)??1,i=$((t==null?void 0:t.in)||e,0);i.setFullYear(o+1,0,l),i.setHours(0,0,0,0);const x=X(i,t),y=$((t==null?void 0:t.in)||e,0);y.setFullYear(o,0,l),y.setHours(0,0,0,0);const p=X(y,t);return+r>=+x?o+1:+r>=+p?o:o-1}function Bt(e,t){var x,y,p,u;const r=U(),o=(t==null?void 0:t.firstWeekContainsDate)??((y=(x=t==null?void 0:t.locale)==null?void 0:x.options)==null?void 0:y.firstWeekContainsDate)??r.firstWeekContainsDate??((u=(p=r.locale)==null?void 0:p.options)==null?void 0:u.firstWeekContainsDate)??1,n=Ne(e,t),l=$((t==null?void 0:t.in)||e,0);return l.setFullYear(n,0,o),l.setHours(0,0,0,0),X(l,t)}function Qt(e,t){const r=O(e,t==null?void 0:t.in),o=+X(r,t)-+Bt(r,t);return Math.round(o/ve)+1}function g(e,t){const r=e<0?"-":"",o=Math.abs(e).toString().padStart(t,"0");return r+o}const Y={y(e,t){const r=e.getFullYear(),o=r>0?r:1-r;return g(t==="yy"?o%100:o,t.length)},M(e,t){const r=e.getMonth();return t==="M"?String(r+1):g(r+1,2)},d(e,t){return g(e.getDate(),t.length)},a(e,t){const r=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.toUpperCase();case"aaa":return r;case"aaaaa":return r[0];case"aaaa":default:return r==="am"?"a.m.":"p.m."}},h(e,t){return g(e.getHours()%12||12,t.length)},H(e,t){return g(e.getHours(),t.length)},m(e,t){return g(e.getMinutes(),t.length)},s(e,t){return g(e.getSeconds(),t.length)},S(e,t){const r=t.length,o=e.getMilliseconds(),n=Math.trunc(o*Math.pow(10,r-3));return g(n,t.length)}},R={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},de={G:function(e,t,r){const o=e.getFullYear()>0?1:0;switch(t){case"G":case"GG":case"GGG":return r.era(o,{width:"abbreviated"});case"GGGGG":return r.era(o,{width:"narrow"});case"GGGG":default:return r.era(o,{width:"wide"})}},y:function(e,t,r){if(t==="yo"){const o=e.getFullYear(),n=o>0?o:1-o;return r.ordinalNumber(n,{unit:"year"})}return Y.y(e,t)},Y:function(e,t,r,o){const n=Ne(e,o),l=n>0?n:1-n;if(t==="YY"){const i=l%100;return g(i,2)}return t==="Yo"?r.ordinalNumber(l,{unit:"year"}):g(l,t.length)},R:function(e,t){const r=we(e);return g(r,t.length)},u:function(e,t){const r=e.getFullYear();return g(r,t.length)},Q:function(e,t,r){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"Q":return String(o);case"QQ":return g(o,2);case"Qo":return r.ordinalNumber(o,{unit:"quarter"});case"QQQ":return r.quarter(o,{width:"abbreviated",context:"formatting"});case"QQQQQ":return r.quarter(o,{width:"narrow",context:"formatting"});case"QQQQ":default:return r.quarter(o,{width:"wide",context:"formatting"})}},q:function(e,t,r){const o=Math.ceil((e.getMonth()+1)/3);switch(t){case"q":return String(o);case"qq":return g(o,2);case"qo":return r.ordinalNumber(o,{unit:"quarter"});case"qqq":return r.quarter(o,{width:"abbreviated",context:"standalone"});case"qqqqq":return r.quarter(o,{width:"narrow",context:"standalone"});case"qqqq":default:return r.quarter(o,{width:"wide",context:"standalone"})}},M:function(e,t,r){const o=e.getMonth();switch(t){case"M":case"MM":return Y.M(e,t);case"Mo":return r.ordinalNumber(o+1,{unit:"month"});case"MMM":return r.month(o,{width:"abbreviated",context:"formatting"});case"MMMMM":return r.month(o,{width:"narrow",context:"formatting"});case"MMMM":default:return r.month(o,{width:"wide",context:"formatting"})}},L:function(e,t,r){const o=e.getMonth();switch(t){case"L":return String(o+1);case"LL":return g(o+1,2);case"Lo":return r.ordinalNumber(o+1,{unit:"month"});case"LLL":return r.month(o,{width:"abbreviated",context:"standalone"});case"LLLLL":return r.month(o,{width:"narrow",context:"standalone"});case"LLLL":default:return r.month(o,{width:"wide",context:"standalone"})}},w:function(e,t,r,o){const n=Qt(e,o);return t==="wo"?r.ordinalNumber(n,{unit:"week"}):g(n,t.length)},I:function(e,t,r){const o=Gt(e);return t==="Io"?r.ordinalNumber(o,{unit:"week"}):g(o,t.length)},d:function(e,t,r){return t==="do"?r.ordinalNumber(e.getDate(),{unit:"date"}):Y.d(e,t)},D:function(e,t,r){const o=Vt(e);return t==="Do"?r.ordinalNumber(o,{unit:"dayOfYear"}):g(o,t.length)},E:function(e,t,r){const o=e.getDay();switch(t){case"E":case"EE":case"EEE":return r.day(o,{width:"abbreviated",context:"formatting"});case"EEEEE":return r.day(o,{width:"narrow",context:"formatting"});case"EEEEEE":return r.day(o,{width:"short",context:"formatting"});case"EEEE":default:return r.day(o,{width:"wide",context:"formatting"})}},e:function(e,t,r,o){const n=e.getDay(),l=(n-o.weekStartsOn+8)%7||7;switch(t){case"e":return String(l);case"ee":return g(l,2);case"eo":return r.ordinalNumber(l,{unit:"day"});case"eee":return r.day(n,{width:"abbreviated",context:"formatting"});case"eeeee":return r.day(n,{width:"narrow",context:"formatting"});case"eeeeee":return r.day(n,{width:"short",context:"formatting"});case"eeee":default:return r.day(n,{width:"wide",context:"formatting"})}},c:function(e,t,r,o){const n=e.getDay(),l=(n-o.weekStartsOn+8)%7||7;switch(t){case"c":return String(l);case"cc":return g(l,t.length);case"co":return r.ordinalNumber(l,{unit:"day"});case"ccc":return r.day(n,{width:"abbreviated",context:"standalone"});case"ccccc":return r.day(n,{width:"narrow",context:"standalone"});case"cccccc":return r.day(n,{width:"short",context:"standalone"});case"cccc":default:return r.day(n,{width:"wide",context:"standalone"})}},i:function(e,t,r){const o=e.getDay(),n=o===0?7:o;switch(t){case"i":return String(n);case"ii":return g(n,t.length);case"io":return r.ordinalNumber(n,{unit:"day"});case"iii":return r.day(o,{width:"abbreviated",context:"formatting"});case"iiiii":return r.day(o,{width:"narrow",context:"formatting"});case"iiiiii":return r.day(o,{width:"short",context:"formatting"});case"iiii":default:return r.day(o,{width:"wide",context:"formatting"})}},a:function(e,t,r){const n=e.getHours()/12>=1?"pm":"am";switch(t){case"a":case"aa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"aaa":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"aaaa":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},b:function(e,t,r){const o=e.getHours();let n;switch(o===12?n=R.noon:o===0?n=R.midnight:n=o/12>=1?"pm":"am",t){case"b":case"bb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"bbb":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"bbbb":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},B:function(e,t,r){const o=e.getHours();let n;switch(o>=17?n=R.evening:o>=12?n=R.afternoon:o>=4?n=R.morning:n=R.night,t){case"B":case"BB":case"BBB":return r.dayPeriod(n,{width:"abbreviated",context:"formatting"});case"BBBBB":return r.dayPeriod(n,{width:"narrow",context:"formatting"});case"BBBB":default:return r.dayPeriod(n,{width:"wide",context:"formatting"})}},h:function(e,t,r){if(t==="ho"){let o=e.getHours()%12;return o===0&&(o=12),r.ordinalNumber(o,{unit:"hour"})}return Y.h(e,t)},H:function(e,t,r){return t==="Ho"?r.ordinalNumber(e.getHours(),{unit:"hour"}):Y.H(e,t)},K:function(e,t,r){const o=e.getHours()%12;return t==="Ko"?r.ordinalNumber(o,{unit:"hour"}):g(o,t.length)},k:function(e,t,r){let o=e.getHours();return o===0&&(o=24),t==="ko"?r.ordinalNumber(o,{unit:"hour"}):g(o,t.length)},m:function(e,t,r){return t==="mo"?r.ordinalNumber(e.getMinutes(),{unit:"minute"}):Y.m(e,t)},s:function(e,t,r){return t==="so"?r.ordinalNumber(e.getSeconds(),{unit:"second"}):Y.s(e,t)},S:function(e,t){return Y.S(e,t)},X:function(e,t,r){const o=e.getTimezoneOffset();if(o===0)return"Z";switch(t){case"X":return ue(o);case"XXXX":case"XX":return q(o);case"XXXXX":case"XXX":default:return q(o,":")}},x:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"x":return ue(o);case"xxxx":case"xx":return q(o);case"xxxxx":case"xxx":default:return q(o,":")}},O:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"O":case"OO":case"OOO":return"GMT"+me(o,":");case"OOOO":default:return"GMT"+q(o,":")}},z:function(e,t,r){const o=e.getTimezoneOffset();switch(t){case"z":case"zz":case"zzz":return"GMT"+me(o,":");case"zzzz":default:return"GMT"+q(o,":")}},t:function(e,t,r){const o=Math.trunc(+e/1e3);return g(o,t.length)},T:function(e,t,r){return g(+e,t.length)}};function me(e,t=""){const r=e>0?"-":"+",o=Math.abs(e),n=Math.trunc(o/60),l=o%60;return l===0?r+String(n):r+String(n)+t+g(l,2)}function ue(e,t){return e%60===0?(e>0?"-":"+")+g(Math.abs(e)/60,2):q(e,t)}function q(e,t=""){const r=e>0?"-":"+",o=Math.abs(e),n=g(Math.trunc(o/60),2),l=g(o%60,2);return r+n+t+l}const he=(e,t)=>{switch(e){case"P":return t.date({width:"short"});case"PP":return t.date({width:"medium"});case"PPP":return t.date({width:"long"});case"PPPP":default:return t.date({width:"full"})}},ke=(e,t)=>{switch(e){case"p":return t.time({width:"short"});case"pp":return t.time({width:"medium"});case"ppp":return t.time({width:"long"});case"pppp":default:return t.time({width:"full"})}},Ut=(e,t)=>{const r=e.match(/(P+)(p+)?/)||[],o=r[1],n=r[2];if(!n)return he(e,t);let l;switch(o){case"P":l=t.dateTime({width:"short"});break;case"PP":l=t.dateTime({width:"medium"});break;case"PPP":l=t.dateTime({width:"long"});break;case"PPPP":default:l=t.dateTime({width:"full"});break}return l.replace("{{date}}",he(o,t)).replace("{{time}}",ke(n,t))},Jt={p:ke,P:Ut},Kt=/^D+$/,Zt=/^Y+$/,er=["D","DD","YY","YYYY"];function tr(e){return Kt.test(e)}function rr(e){return Zt.test(e)}function ar(e,t,r){const o=or(e,t,r);if(console.warn(o),er.includes(e))throw new RangeError(o)}function or(e,t,r){const o=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${t}\`) for formatting ${o} to the input \`${r}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const nr=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,sr=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,lr=/^'([^]*?)'?$/,ir=/''/g,cr=/[a-zA-Z]/;function dr(e,t,r){var u,v,P,E,M,T,f,_;const o=U(),n=(r==null?void 0:r.locale)??o.locale??Xt,l=(r==null?void 0:r.firstWeekContainsDate)??((v=(u=r==null?void 0:r.locale)==null?void 0:u.options)==null?void 0:v.firstWeekContainsDate)??o.firstWeekContainsDate??((E=(P=o.locale)==null?void 0:P.options)==null?void 0:E.firstWeekContainsDate)??1,i=(r==null?void 0:r.weekStartsOn)??((T=(M=r==null?void 0:r.locale)==null?void 0:M.options)==null?void 0:T.weekStartsOn)??o.weekStartsOn??((_=(f=o.locale)==null?void 0:f.options)==null?void 0:_.weekStartsOn)??0,x=O(e,r==null?void 0:r.in);if(!ut(x))throw new RangeError("Invalid time value");let y=t.match(sr).map(j=>{const c=j[0];if(c==="p"||c==="P"){const b=Jt[c];return b(j,n.formatLong)}return j}).join("").match(nr).map(j=>{if(j==="''")return{isToken:!1,value:"'"};const c=j[0];if(c==="'")return{isToken:!1,value:mr(j)};if(de[c])return{isToken:!0,value:j};if(c.match(cr))throw new RangeError("Format string contains an unescaped latin alphabet character `"+c+"`");return{isToken:!1,value:j}});n.localize.preprocessor&&(y=n.localize.preprocessor(x,y));const p={firstWeekContainsDate:l,weekStartsOn:i,locale:n};return y.map(j=>{if(!j.isToken)return j.value;const c=j.value;(!(r!=null&&r.useAdditionalWeekYearTokens)&&rr(c)||!(r!=null&&r.useAdditionalDayOfYearTokens)&&tr(c))&&ar(c,t,String(e));const b=de[c[0]];return b(x,c,n.localize,p)}).join("")}function mr(e){const t=e.match(lr);return t?t[1].replace(ir,"'"):e}const ur={lessThanXSeconds:{one:"menos de un segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"medio minuto",lessThanXMinutes:{one:"menos de un minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"alrededor de 1 hora",other:"alrededor de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dÃ­a",other:"{{count}} dÃ­as"},aboutXWeeks:{one:"alrededor de 1 semana",other:"alrededor de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"alrededor de 1 mes",other:"alrededor de {{count}} meses"},xMonths:{one:"1 mes",other:"{{count}} meses"},aboutXYears:{one:"alrededor de 1 aÃ±o",other:"alrededor de {{count}} aÃ±os"},xYears:{one:"1 aÃ±o",other:"{{count}} aÃ±os"},overXYears:{one:"mÃ¡s de 1 aÃ±o",other:"mÃ¡s de {{count}} aÃ±os"},almostXYears:{one:"casi 1 aÃ±o",other:"casi {{count}} aÃ±os"}},hr=(e,t,r)=>{let o;const n=ur[e];return typeof n=="string"?o=n:t===1?o=n.one:o=n.other.replace("{{count}}",t.toString()),r!=null&&r.addSuffix?r.comparison&&r.comparison>0?"en "+o:"hace "+o:o},fr={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/y"},yr={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},xr={full:"{{date}} 'a las' {{time}}",long:"{{date}} 'a las' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},pr={date:z({formats:fr,defaultWidth:"full"}),time:z({formats:yr,defaultWidth:"full"}),dateTime:z({formats:xr,defaultWidth:"full"})},br={lastWeek:"'el' eeee 'pasado a la' p",yesterday:"'ayer a la' p",today:"'hoy a la' p",tomorrow:"'maÃ±ana a la' p",nextWeek:"eeee 'a la' p",other:"P"},gr={lastWeek:"'el' eeee 'pasado a las' p",yesterday:"'ayer a las' p",today:"'hoy a las' p",tomorrow:"'maÃ±ana a las' p",nextWeek:"eeee 'a las' p",other:"P"},vr=(e,t,r,o)=>t.getHours()!==1?gr[e]:br[e],wr={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","despuÃ©s de cristo"]},jr={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1Âº trimestre","2Âº trimestre","3Âº trimestre","4Âº trimestre"]},Nr={narrow:["e","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["ene","feb","mar","abr","may","jun","jul","ago","sep","oct","nov","dic"],wide:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"]},kr={narrow:["d","l","m","m","j","v","s"],short:["do","lu","ma","mi","ju","vi","sÃ¡"],abbreviated:["dom","lun","mar","miÃ©","jue","vie","sÃ¡b"],wide:["domingo","lunes","martes","miÃ©rcoles","jueves","viernes","sÃ¡bado"]},Cr={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"maÃ±ana",afternoon:"tarde",evening:"tarde",night:"noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"maÃ±ana",afternoon:"tarde",evening:"tarde",night:"noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"maÃ±ana",afternoon:"tarde",evening:"tarde",night:"noche"}},Mr={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"de la maÃ±ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},abbreviated:{am:"AM",pm:"PM",midnight:"medianoche",noon:"mediodia",morning:"de la maÃ±ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"},wide:{am:"a.m.",pm:"p.m.",midnight:"medianoche",noon:"mediodia",morning:"de la maÃ±ana",afternoon:"de la tarde",evening:"de la tarde",night:"de la noche"}},Pr=(e,t)=>Number(e)+"Âº",Sr={ordinalNumber:Pr,era:D({values:wr,defaultWidth:"wide"}),quarter:D({values:jr,defaultWidth:"wide",argumentCallback:e=>Number(e)-1}),month:D({values:Nr,defaultWidth:"wide"}),day:D({values:kr,defaultWidth:"wide"}),dayPeriod:D({values:Cr,defaultWidth:"wide",formattingValues:Mr,defaultFormattingWidth:"wide"})},Er=/^(\d+)(Âº)?/i,_r=/\d+/i,Tr={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|a\.?\s?e\.?\s?c\.?|d\.?\s?c\.?|e\.?\s?c\.?)/i,wide:/^(antes de cristo|antes de la era com[uÃº]n|despu[eÃ©]s de cristo|era com[uÃº]n)/i},Or={any:[/^ac/i,/^dc/i],wide:[/^(antes de cristo|antes de la era com[uÃº]n)/i,/^(despu[eÃ©]s de cristo|era com[uÃº]n)/i]},Dr={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](Âº)? trimestre/i},Wr={any:[/1/i,/2/i,/3/i,/4/i]},Ar={narrow:/^[efmajsond]/i,abbreviated:/^(ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)/i,wide:/^(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre)/i},Fr={narrow:[/^e/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^en/i,/^feb/i,/^mar/i,/^abr/i,/^may/i,/^jun/i,/^jul/i,/^ago/i,/^sep/i,/^oct/i,/^nov/i,/^dic/i]},Yr={narrow:/^[dlmjvs]/i,short:/^(do|lu|ma|mi|ju|vi|s[Ã¡a])/i,abbreviated:/^(dom|lun|mar|mi[Ã©e]|jue|vie|s[Ã¡a]b)/i,wide:/^(domingo|lunes|martes|mi[Ã©e]rcoles|jueves|viernes|s[Ã¡a]bado)/i},$r={narrow:[/^d/i,/^l/i,/^m/i,/^m/i,/^j/i,/^v/i,/^s/i],any:[/^do/i,/^lu/i,/^ma/i,/^mi/i,/^ju/i,/^vi/i,/^sa/i]},Ir={narrow:/^(a|p|mn|md|(de la|a las) (maÃ±ana|tarde|noche))/i,any:/^([ap]\.?\s?m\.?|medianoche|mediodia|(de la|a las) (maÃ±ana|tarde|noche))/i},qr={any:{am:/^a/i,pm:/^p/i,midnight:/^mn/i,noon:/^md/i,morning:/maÃ±ana/i,afternoon:/tarde/i,evening:/tarde/i,night:/noche/i}},Rr={ordinalNumber:je({matchPattern:Er,parsePattern:_r,valueCallback:function(e){return parseInt(e,10)}}),era:W({matchPatterns:Tr,defaultMatchWidth:"wide",parsePatterns:Or,defaultParseWidth:"any"}),quarter:W({matchPatterns:Dr,defaultMatchWidth:"wide",parsePatterns:Wr,defaultParseWidth:"any",valueCallback:e=>e+1}),month:W({matchPatterns:Ar,defaultMatchWidth:"wide",parsePatterns:Fr,defaultParseWidth:"any"}),day:W({matchPatterns:Yr,defaultMatchWidth:"wide",parsePatterns:$r,defaultParseWidth:"any"}),dayPeriod:W({matchPatterns:Ir,defaultMatchWidth:"any",parsePatterns:qr,defaultParseWidth:"any"})},Lr={code:"es",formatDistance:hr,formatLong:pr,formatRelative:vr,localize:Sr,match:Rr,options:{weekStartsOn:1,firstWeekContainsDate:1}};function zr({message:e,onReply:t,onReplyAll:r,onForward:o,onCreateTask:n,onClose:l}){var c,b,k;const{toast:i}=Q(),{toggleStar:x,updateMessage:y}=Z(),[p,u]=N.useState(!1),[v,P]=N.useState(!1);if(De.useEffect(()=>{var m,C;e&&console.log("ðŸ“§ [EmailMessageDetail] Mensaje recibido:",{id:e.id,subject:e.subject,has_body_html:!!e.body_html,has_body_text:!!e.body_text,body_html_length:((m=e.body_html)==null?void 0:m.length)||0,body_text_length:((C=e.body_text)==null?void 0:C.length)||0,all_keys:Object.keys(e)})},[e]),!e)return a.jsx("div",{className:"h-full flex items-center justify-center p-6",style:{backgroundColor:"var(--color-bg-primary)"},children:a.jsxs("div",{className:"text-center",children:[a.jsx(K,{className:"w-16 h-16 mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),a.jsx("p",{className:"text-lg font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Selecciona un mensaje"}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Elige un correo de tu bandeja para ver su contenido"})]})});const E=async()=>{u(!0);try{await Re(e.account_id,e.id),x(e.id)}catch{i.error("Error al actualizar estrella")}finally{u(!1)}},M=async()=>{P(!0);try{await ee(e.account_id,e.id,"archive"),y(e.id,{folder_id:"archive"}),i.success("âœ“ Mensaje archivado"),l&&l()}catch{i.error("Error al archivar mensaje")}finally{P(!1)}},T=async()=>{if(confirm("Â¿Mover este mensaje a la papelera?"))try{await ee(e.account_id,e.id,"trash"),y(e.id,{folder_id:"trash"}),i.success("âœ“ Mensaje movido a papelera"),l&&l()}catch{i.error("Error al eliminar mensaje")}},f=m=>m?Fe.sanitize(m,{ALLOWED_TAGS:["p","br","strong","b","i","em","u","a","ul","ol","li","h1","h2","h3","h4","h5","h6","div","span","img","table","thead","tbody","tr","td","th","blockquote","pre","code"],ALLOWED_ATTR:["href","src","alt","title","style","class","target"]}):"",_=m=>{try{return dr(new Date(m),"d 'de' MMMM 'de' yyyy 'a las' HH:mm",{locale:Lr})}catch{return""}},j=()=>{var C,d;const m=[];return(C=e.to_addresses)!=null&&C.length&&m.push(...e.to_addresses.map(s=>`Para: ${s}`)),(d=e.cc_addresses)!=null&&d.length&&m.push(...e.cc_addresses.map(s=>`CC: ${s}`)),m};return a.jsxs("div",{className:"h-full flex flex-col",style:{backgroundColor:"var(--color-bg-primary)"},children:[a.jsxs("div",{className:"p-4 border-b space-y-3",style:{borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("button",{onClick:()=>t&&t(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Responder",children:[a.jsx(tt,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Responder"})]}),a.jsxs("button",{onClick:()=>r&&r(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Responder a todos",children:[a.jsx(et,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Responder todos"})]}),a.jsxs("button",{onClick:()=>o&&o(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Reenviar",children:[a.jsx(Je,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium hidden sm:inline",children:"Reenviar"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:E,disabled:p,className:"p-2 rounded-lg hover:opacity-80 transition-all disabled:opacity-50",style:{backgroundColor:"var(--color-bg-secondary)",color:e.is_starred?"var(--color-accent)":"var(--color-text-primary)"},title:"Destacar",children:a.jsx(ge,{className:`w-5 h-5 ${e.is_starred?"fill-current":""}`})}),a.jsx("button",{onClick:M,disabled:v,className:"p-2 rounded-lg hover:opacity-80 transition-all disabled:opacity-50",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Archivar",children:v?a.jsx(G,{className:"w-5 h-5 animate-spin"}):a.jsx(Ae,{className:"w-5 h-5"})}),a.jsx("button",{onClick:T,className:"p-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Eliminar",children:a.jsx(be,{className:"w-5 h-5"})}),l&&a.jsx("button",{onClick:l,className:"p-2 rounded-lg hover:opacity-80 transition-all lg:hidden",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},children:a.jsx(ye,{className:"w-5 h-5"})})]})]}),a.jsxs("div",{className:"flex items-center gap-2 pt-2 border-t",style:{borderColor:"var(--color-border)"},children:[a.jsxs("button",{onClick:()=>n&&n(e),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-primary)",color:"white"},children:[a.jsx(Ue,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Crear Tarea"})]}),a.jsxs("button",{onClick:()=>i.info("FunciÃ³n prÃ³ximamente"),className:"flex items-center gap-2 px-3 py-2 rounded-lg hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},children:[a.jsx(He,{className:"w-4 h-4"}),a.jsx("span",{className:"text-sm font-medium",children:"Agendar"})]})]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4",style:{color:"var(--color-text-primary)"},children:e.subject||"(Sin asunto)"}),a.jsxs("div",{className:"mb-6 space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{children:[a.jsx("p",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:e.from_name||e.from_address}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:e.from_address})]}),a.jsx("p",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:_(e.date)})]}),j().length>0&&a.jsxs("details",{className:"text-sm",children:[a.jsxs("summary",{className:"cursor-pointer hover:opacity-80",style:{color:"var(--color-text-secondary)"},children:["Para: ",((c=e.to_addresses)==null?void 0:c[0])||"mÃ­",j().length>1&&` y ${j().length-1} mÃ¡s`]}),a.jsx("div",{className:"mt-2 pl-4 space-y-1",style:{color:"var(--color-text-tertiary)"},children:j().map((m,C)=>a.jsx("p",{children:m},C))})]})]}),e.has_attachments&&((b=e.attachments)==null?void 0:b.length)>0&&a.jsxs("div",{className:"mb-6 p-4 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(ne,{className:"w-5 h-5",style:{color:"var(--color-text-primary)"}}),a.jsxs("p",{className:"font-medium",style:{color:"var(--color-text-primary)"},children:[e.attachment_count," adjunto",e.attachment_count>1?"s":""]})]}),a.jsx("div",{className:"space-y-2",children:e.attachments.map((m,C)=>a.jsxs("div",{className:"flex items-center justify-between p-2 rounded",style:{backgroundColor:"var(--color-bg-primary)"},children:[a.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[a.jsx(ne,{className:"w-4 h-4 shrink-0",style:{color:"var(--color-text-tertiary)"}}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("p",{className:"text-sm truncate",style:{color:"var(--color-text-primary)"},children:m.filename}),a.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:[(m.size_bytes/1024).toFixed(1)," KB"]})]})]}),a.jsx("a",{href:m.download_url,download:!0,className:"p-1.5 rounded hover:opacity-80 transition-all shrink-0",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Descargar",children:a.jsx(Xe,{className:"w-4 h-4"})})]},C))})]}),e.body_html||e.body_text?a.jsx("div",{className:"prose max-w-none",style:{color:"var(--color-text-primary)"},dangerouslySetInnerHTML:{__html:f(e.body_html)||((k=e.body_text)==null?void 0:k.replace(/\n/g,"<br />"))||""}}):a.jsxs("div",{className:"p-6 rounded-lg text-center",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-tertiary)"},children:[a.jsx(K,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),a.jsx("p",{className:"font-medium mb-2",children:"Sin contenido"}),a.jsxs("p",{className:"text-sm",children:["Este mensaje no tiene contenido disponible.",e.preview&&a.jsxs("span",{className:"block mt-2 text-xs",children:["Preview: ",e.preview]})]})]})]})]})}function fa(){const{user:e,accessToken:t}=fe(),{toast:r}=Q(),o=We(),{currentAccount:n,accounts:l,selectedMessage:i,isComposing:x,currentFolder:y,selectedAccountId:p,setCurrentAccount:u,setAccounts:v,setSelectedMessage:P,setCurrentFolder:E,startCompose:M,closeCompose:T}=Z(),[f,_]=N.useState(!1),[j,c]=N.useState(!0),[b,k]=N.useState("new"),[m,C]=N.useState(null),[d,s]=N.useState(!0),[w,S]=N.useState(!1);N.useEffect(()=>{console.log("[EmailModule] ðŸ” DEBUG User:",{hasUser:!!e,userId:e==null?void 0:e.id,userEmail:e==null?void 0:e.email,hasToken:!!t})},[e,t]),N.useEffect(()=>{e!=null&&e.id&&A()},[e]);const A=async()=>{s(!0);try{console.log("ðŸ”µ [EmailModulePage] Cargando cuentas para user:",e==null?void 0:e.id);const h=await Le(e.id,t);if(console.log("ðŸ”µ [EmailModulePage] Cuentas recibidas:",h),console.log("ðŸ”µ [EmailModulePage] selectedAccountId from localStorage:",p),v(h),h&&h.length>0){let F=null;p&&(F=h.find(Te=>Te.id===p),F&&console.log("âœ… [EmailModulePage] Restaurando cuenta desde localStorage:",F)),F||(F=h[0],console.log("ðŸ”µ [EmailModulePage] Seleccionando primera cuenta:",F)),u(F)}else console.log("âš ï¸ [EmailModulePage] NO se encontraron cuentas en Supabase"),u(null)}catch(h){console.error("âŒ [EmailModulePage] Error al cargar cuentas:",h),r({variant:"destructive",title:"Error al cargar cuentas",description:h.message||"No se pudieron cargar las cuentas de correo"})}finally{console.log("ðŸ”µ [EmailModulePage] Finalizando loadAccounts, setLoading(false)"),s(!1)}},H=h=>{_(!1),A(),r({title:"Cuenta configurada",description:"âœ“ Tu cuenta de correo estÃ¡ lista para usar"})},V=h=>{console.log("ðŸ”µ [EmailModulePage] Cuenta seleccionada:",h),u(h),E("inbox"),P(null)},Ce=()=>{if(console.log("ðŸ“§ [EmailModulePage] handleCompose llamado"),console.log("ðŸ“§ [EmailModulePage] currentAccount:",n),console.log("ðŸ“§ [EmailModulePage] accounts:",l),!n){console.warn("âš ï¸ [EmailModulePage] NO HAY CUENTA SELECCIONADA"),r({variant:"destructive",title:"No hay cuenta seleccionada",description:"Por favor selecciona una cuenta de correo en la barra lateral"});return}k("new"),C(null),M()},Me=h=>{console.log("ðŸ“§ [EmailModulePage] handleReply llamado con:",h),C(h),k("reply"),setTimeout(()=>{M()},50)},Pe=h=>{console.log("ðŸ“§ [EmailModulePage] handleReplyAll llamado con:",h),C(h),k("replyAll"),setTimeout(()=>{M()},50)},Se=h=>{console.log("ðŸ“§ [EmailModulePage] handleForward llamado con:",h),C(h),k("forward"),setTimeout(()=>{M()},50)},Ee=h=>{r({title:"PrÃ³ximamente",description:"FunciÃ³n de crear tarea estarÃ¡ disponible pronto"})},_e=[{id:"inbox",name:"Bandeja de entrada",icon:$e,color:"var(--color-primary)"},{id:"sent",name:"Enviados",icon:xe,color:"var(--color-text-secondary)"},{id:"drafts",name:"Borradores",icon:Qe,color:"var(--color-text-secondary)"},{id:"starred",name:"Destacados",icon:ge,color:"#facc15"},{id:"spam",name:"Spam",icon:K,color:"#f97316"},{id:"trash",name:"Papelera",icon:be,color:"#ef4444"}];return d?a.jsx("div",{className:"h-screen flex items-center justify-center",style:{backgroundColor:"var(--color-bg-primary)"},children:a.jsxs("div",{className:"text-center",children:[a.jsx(L,{className:"w-16 h-16 mx-auto mb-4 animate-pulse",style:{color:"var(--color-primary)"}}),a.jsx("p",{className:"text-lg",style:{color:"var(--color-text-primary)"},children:"Cargando correo..."})]})}):l.length===0&&!f?a.jsx("div",{className:"h-screen flex items-center justify-center p-6",style:{backgroundColor:"var(--color-bg-primary)"},children:a.jsxs("div",{className:"max-w-md text-center",children:[a.jsx(L,{className:"w-24 h-24 mx-auto mb-6",style:{color:"var(--color-primary)"}}),a.jsx("h1",{className:"text-3xl font-bold mb-4",style:{color:"var(--color-text-primary)"},children:"Bienvenido al mÃ³dulo de Correo"}),a.jsx("p",{className:"text-lg mb-8",style:{color:"var(--color-text-secondary)"},children:"Conecta tu cuenta de correo (Gmail, Outlook o cualquier proveedor IMAP/SMTP) para comenzar"}),a.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-6 py-3 rounded-2xl font-semibold mx-auto hover:opacity-90 transition-all",style:{backgroundColor:"var(--color-primary)",color:"white"},children:[a.jsx(se,{className:"w-5 h-5"}),"Configurar mi primera cuenta"]})]})}):a.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundColor:"var(--color-bg-primary)"},children:[a.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:()=>o(-1),className:"p-2 rounded-2xl hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},title:"Volver",children:a.jsx(pe,{className:"w-5 h-5"})}),a.jsx("button",{onClick:()=>c(!j),className:"lg:hidden p-2 rounded-2xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)"},children:a.jsx(Ve,{className:"w-5 h-5",style:{color:"var(--color-text-primary)"}})}),a.jsx(L,{className:"w-6 h-6",style:{color:"var(--color-primary)"}}),a.jsx("h1",{className:"text-xl font-bold",style:{color:"var(--color-text-primary)"},children:"AL-E Correo"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:()=>S(!w),className:`p-2 rounded-2xl transition-all ${w?"animate-pulse ring-2":""}`,style:{backgroundColor:w?"var(--color-primary)":"var(--color-bg-secondary)",color:w?"white":"var(--color-text-primary)",ringColor:w?"var(--color-accent)":"transparent"},title:w?"Modo voz ACTIVO - Click para desactivar":"Activar modo voz manos libres",children:a.jsx(Be,{className:"w-5 h-5"})}),a.jsxs("button",{onClick:Ce,className:"flex items-center gap-2 px-4 py-2 rounded-2xl font-medium hover:opacity-90 transition-all",style:{backgroundColor:"var(--color-primary)",color:"white"},children:[a.jsx(se,{className:"w-5 h-5"}),a.jsx("span",{className:"hidden sm:inline",children:"Redactar"})]}),a.jsx("button",{onClick:()=>_(!0),className:"p-2 rounded-2xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)"},title:"Configurar cuenta",children:a.jsx(Ge,{className:"w-5 h-5",style:{color:"var(--color-text-primary)"}})})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsxs("div",{className:`${j?"translate-x-0":"-translate-x-full"} fixed lg:static inset-y-0 left-0 z-40 w-64 border-r flex flex-col transition-transform lg:translate-x-0`,style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"p-4 border-b",style:{borderColor:"var(--color-border)"},children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("h2",{className:"font-semibold text-sm",style:{color:"var(--color-text-secondary)"},children:"CUENTAS"}),a.jsx("button",{onClick:()=>c(!1),className:"lg:hidden p-1 rounded-2xl hover:opacity-80",children:a.jsx(ye,{className:"w-4 h-4",style:{color:"var(--color-text-secondary)"}})})]}),a.jsxs("div",{className:"space-y-1",children:[l.length===0&&a.jsx("p",{className:"text-sm text-center py-4",style:{color:"var(--color-text-tertiary)"},children:"No hay cuentas configuradas"}),l.map(h=>a.jsxs("button",{onClick:()=>V(h),className:`w-full text-left px-3 py-2 rounded-2xl transition-all ${(n==null?void 0:n.id)===h.id?"ring-2":""}`,style:{backgroundColor:(n==null?void 0:n.id)===h.id?"var(--color-bg-secondary)":"transparent",ringColor:"var(--color-primary)",color:"var(--color-text-primary)"},children:[a.jsx("p",{className:"font-medium truncate text-sm",children:h.from_name||h.fromName||"Sin nombre"}),a.jsx("p",{className:"text-xs truncate",style:{color:"var(--color-text-tertiary)"},children:h.from_email||h.fromEmail||"sin-email@example.com"})]},h.id))]})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[a.jsx("h2",{className:"font-semibold text-sm mb-2",style:{color:"var(--color-text-secondary)"},children:"CARPETAS"}),a.jsx("div",{className:"space-y-1",children:_e.map(h=>{const F=h.icon;return a.jsxs("button",{onClick:()=>E(h.id),className:`w-full flex items-center gap-3 px-3 py-2 rounded-2xl transition-all ${y===h.id?"ring-2":""}`,style:{backgroundColor:y===h.id?"var(--color-bg-secondary)":"transparent",ringColor:"var(--color-primary)"},children:[a.jsx(F,{className:"w-5 h-5",style:{color:h.color}}),a.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:h.name})]},h.id)})})]})]}),a.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[a.jsx("div",{className:`${i?"hidden lg:flex":"flex"} w-full lg:w-96 border-r flex-col`,style:{borderColor:"var(--color-border)"},children:a.jsx(nt,{accountId:n==null?void 0:n.id,folder:y,onSelectMessage:h=>{P(h)}})}),a.jsx("div",{className:`${i?"flex":"hidden lg:flex"} flex-1 flex-col`,children:i?a.jsx(zr,{message:i,onReply:Me,onReplyAll:Pe,onForward:Se,onCreateTask:Ee,onClose:()=>P(null)}):a.jsx("div",{className:"h-full flex items-center justify-center",style:{color:"var(--color-text-tertiary)"},children:"Selecciona un mensaje para verlo"})})]})]}),j&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden",onClick:()=>c(!1)}),f&&a.jsx(ot,{onComplete:H,onCancel:()=>_(!1)}),x&&a.jsx(Ye,{mode:b,replyTo:m,onClose:T,onSent:()=>{T(),r({title:"Correo enviado",description:"âœ“ Tu mensaje ha sido enviado exitosamente"})}})]})}export{fa as default};
