import{c as N,a as j,r as n,j as e,e as C,u as k,L as T}from"./index-e4e1323c.js";import{c as E,g as w,u as S}from"./telegramService-43640fc1.js";import{A as h}from"./alert-circle-55dbc938.js";import{L as F}from"./loader-2-b4ab27ec.js";import{S as f}from"./send-1877c269.js";import{A}from"./arrow-left-1a8dd8e5.js";import{C as _}from"./check-circle-2-1ec1591c.js";import{X as z}from"./x-circle-14dea691.js";const I=N("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),g="ale_telegram_bot_draft";function U({userId:o,onSuccess:m,onCancel:b}){const{toast:c}=j(),[i,u]=n.useState(!1),p=()=>{try{const t=localStorage.getItem(g);if(t)return JSON.parse(t)}catch(t){console.error("Error recuperando draft:",t)}return{botUsername:"",botToken:""}},[s,x]=n.useState(p);n.useEffect(()=>{try{localStorage.setItem(g,JSON.stringify(s))}catch(t){console.error("Error guardando draft:",t)}},[s]);function d(t,r){x(a=>({...a,[t]:r}))}async function y(t){if(t.preventDefault(),!o){c({variant:"destructive",title:"Error",description:"No se pudo obtener el ID de usuario"});return}try{u(!0);const r={ownerUserId:o,botUsername:s.botUsername.replace(/^@/,""),botToken:s.botToken.trim()};console.log("[ConnectBotForm] üîç DEBUG - Informaci√≥n de env√≠o:"),console.log("  - userId recibido:",o),console.log("  - tipo de userId:",typeof o),console.log("  - userId v√°lido:",!!o&&o!=="undefined"),console.log("  - payload completo:",{...r,botToken:"***HIDDEN***"});const a=await E(r);console.log("[ConnectBotForm] ‚úÖ Respuesta exitosa:",a),c({title:"Bot conectado",description:`@${s.botUsername} se conect√≥ correctamente`});try{localStorage.removeItem(g)}catch(l){console.error("Error limpiando draft:",l)}m()}catch(r){console.error("[ConnectBotForm] ‚ùå Error detallado:",r),console.error("  - Mensaje:",r.message),console.error("  - Stack:",r.stack),c({variant:"destructive",title:"Error",description:r.message||"No se pudo conectar el bot"})}finally{u(!1)}}return e.jsxs("form",{onSubmit:y,className:"space-y-5",children:[e.jsx("div",{children:e.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-text-primary)"},children:"Conectar bot de Telegram"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Username del bot"}),e.jsx("input",{type:"text",value:s.botUsername,onChange:t=>d("botUsername",t.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"@mi_bot",required:!0}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:"Ejemplo: @mi_asistente_bot"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Token del bot"}),e.jsx("input",{type:"password",value:s.botToken,onChange:t=>d("botToken",t.target.value),className:"w-full px-4 py-2.5 rounded-lg border font-mono text-sm",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"1234567890:ABCdefGHIjklMNOpqrsTUVwxyz",required:!0}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:"Obtenlo de @BotFather en Telegram"})]}),e.jsxs("div",{className:"p-4 rounded-lg border flex items-start gap-3",style:{backgroundColor:"rgba(245, 158, 11, 0.1)",borderColor:"#f59e0b"},children:[e.jsx(h,{size:20,style:{color:"#f59e0b",marginTop:"2px",flexShrink:0}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm mb-1",style:{color:"#f59e0b"},children:"Importante"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"No compartas tu token. Es como una contrase√±a que da acceso total a tu bot."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsxs("button",{type:"submit",disabled:i,className:"flex-1 py-3 px-4 rounded-xl font-medium transition-all hover:opacity-90 disabled:opacity-50 flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},children:[i&&e.jsx(F,{size:18,className:"animate-spin"}),i?"Conectando...":e.jsxs(e.Fragment,{children:[e.jsx(f,{size:18}),"Conectar bot"]})]}),e.jsx("button",{type:"button",onClick:b,disabled:i,className:"px-6 py-3 rounded-xl font-medium border transition-all hover:opacity-90 disabled:opacity-50",style:{borderColor:"var(--color-border)",color:"var(--color-text-secondary)"},children:"Cancelar"})]})]})}function P(){const{user:o}=C(),{toast:m}=j(),b=k(),[c,i]=n.useState([]),[u,p]=n.useState(!0),[s,x]=n.useState(!1);n.useEffect(()=>{console.log("[TelegramSettings] üîç DEBUG User:",{hasUser:!!o,userId:o==null?void 0:o.id,userEmail:o==null?void 0:o.email,userKeys:o?Object.keys(o):[]})},[o]),n.useEffect(()=>{d()},[o]);async function d(){if(o)try{p(!0);const r=await w(o.id);i(r||[])}catch(r){console.error("Error cargando bots:",r),m({variant:"destructive",title:"Error",description:r.message||"No se pudieron cargar los bots de Telegram"})}finally{p(!1)}}function y(){d(),x(!1)}async function t(r,a){try{await S(r,{auto_send_enabled:!a}),m({title:a?"Auto-send desactivado":"Auto-send activado",description:a?"‚úì AL-E solicitar√° tu aprobaci√≥n antes de enviar mensajes":"‚úì AL-E podr√° enviar mensajes autom√°ticamente por Telegram"}),d()}catch(l){console.error("Error actualizando configuraci√≥n:",l),m({variant:"destructive",title:"Error",description:l.message||"No se pudo actualizar la configuraci√≥n"})}}return e.jsx("div",{className:"h-screen overflow-y-auto",style:{backgroundColor:"var(--color-bg-primary)"},children:e.jsxs("div",{className:"max-w-4xl mx-auto p-6 pb-32",children:[e.jsxs("button",{onClick:()=>b(-1),className:"flex items-center gap-2 mb-6 px-4 py-2 rounded-lg transition-all hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)",border:"1px solid var(--color-border)"},children:[e.jsx(A,{size:18}),e.jsx("span",{className:"font-medium",children:"Volver"})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",style:{color:"var(--color-text-primary)"},children:"Configuraci√≥n de Telegram"}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"Conecta tu bot personal para recibir notificaciones y gestionar mensajes"})]}),u?e.jsx("div",{className:"text-center py-12",style:{color:"var(--color-text-secondary)"},children:"Cargando..."}):e.jsxs(e.Fragment,{children:[c.length>0&&e.jsx("div",{className:"space-y-4 mb-6",children:c.map(r=>{const a=r.chat_id||r.has_started,l=r.isConnected&&a?"connected":r.isConnected&&!a?"waiting":"error";return e.jsxs("div",{className:"p-5 rounded-xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:[e.jsxs("div",{className:"flex items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(f,{size:24,style:{color:"var(--color-accent)"}}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-lg",style:{color:"var(--color-text-primary)"},children:["@",r.botUsername||r.bot_username]}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[l==="connected"&&e.jsxs(e.Fragment,{children:[e.jsx(_,{size:16,style:{color:"#10b981"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"#10b981"},children:"‚úÖ Conectado"})]}),l==="waiting"&&e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16,style:{color:"#f59e0b"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"#f59e0b"},children:"‚ö†Ô∏è Falta presionar Start"})]}),l==="error"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{size:16,style:{color:"#ef4444"}}),e.jsx("span",{className:"text-sm font-medium",style:{color:"#ef4444"},children:"‚ùå Error de conexi√≥n"})]})]})]})]}),e.jsx(T,{to:"/telegram",className:"py-2 px-4 rounded-lg font-medium border transition-all hover:opacity-80",style:{borderColor:"var(--color-border)",color:"var(--color-text-primary)"},children:"Ver mensajes"})]}),e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-1",style:{color:"var(--color-text-primary)"},children:"Auto-send permitido"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.auto_send_enabled?"AL-E puede enviar mensajes autom√°ticamente":"AL-E pedir√° tu aprobaci√≥n antes de enviar"})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:r.auto_send_enabled||!1,onChange:()=>{const v=r.id||r.bot_id;console.log("[TelegramSettings] Toggling auto-send for bot:",v),t(v,r.auto_send_enabled)}}),e.jsx("div",{className:"w-11 h-6 bg-gray-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#0078d4]"})]})]}),l==="waiting"&&e.jsx("div",{className:"mt-3 p-3 rounded-lg border-l-4",style:{backgroundColor:"rgba(245, 158, 11, 0.1)",borderLeftColor:"#f59e0b"},children:e.jsxs("p",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:["üì± ",e.jsx("strong",{children:"√öltimo paso:"})," Abre Telegram, busca tu bot ",e.jsxs("span",{className:"font-mono",children:["@",r.botUsername||r.bot_username]})," y presiona ",e.jsx("strong",{children:"INICIAR"})]})})]},r.id)})}),s?e.jsx("div",{className:"p-6 rounded-xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:!o||!o.id?e.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-tertiary)"},children:[e.jsx(h,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"font-medium mb-2",children:"No se pudo obtener informaci√≥n del usuario"}),e.jsx("p",{className:"text-sm",children:"Por favor recarga la p√°gina o inicia sesi√≥n nuevamente"}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-4 px-4 py-2 rounded-lg font-medium",style:{backgroundColor:"var(--color-primary)",color:"white"},children:"Recargar p√°gina"})]}):e.jsx(U,{userId:o.id,onSuccess:y,onCancel:()=>x(!1)})}):e.jsxs(e.Fragment,{children:[c.length===0&&e.jsxs("div",{className:"text-center py-12 rounded-xl border mb-6",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:[e.jsx(f,{size:64,className:"mx-auto mb-4",style:{color:"var(--color-text-tertiary)"}}),e.jsx("h3",{className:"text-xl font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"No hay bots conectados"}),e.jsx("p",{className:"mb-6",style:{color:"var(--color-text-secondary)"},children:"Conecta tu bot de Telegram para comenzar"})]}),e.jsx("button",{onClick:()=>x(!0),className:"w-full py-4 px-6 rounded-xl border-2 border-dashed transition-all hover:border-solid",style:{borderColor:"var(--color-border)",color:"var(--color-text-secondary)"},children:e.jsx("span",{className:"font-medium",children:"+ Conectar bot de Telegram"})})]}),e.jsx("div",{className:"mt-8 p-5 rounded-xl border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(h,{size:20,style:{color:"var(--color-accent)",marginTop:"2px"}}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"C√≥mo obtener un bot de Telegram"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-sm",style:{color:"var(--color-text-secondary)"},children:[e.jsx("li",{children:"Abre Telegram y busca @BotFather"}),e.jsx("li",{children:"Env√≠a el comando /newbot y sigue las instrucciones"}),e.jsx("li",{children:"Copia el token que te proporciona"}),e.jsx("li",{children:"Pega el token en el formulario de arriba"}),e.jsx("li",{children:"Una vez conectado, abre tu bot en Telegram y presiona INICIAR"})]})]})]})})]})]})})}export{P as default};
