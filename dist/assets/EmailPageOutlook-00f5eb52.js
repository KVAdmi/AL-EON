import{c as X,a as ne,r as n,j as e,X as $,e as _e,u as Se}from"./index-e4e1323c.js";import{A as Ee,p as ze,E as Fe,I as ae}from"./EmailComposer-037afb78.js";import{s as B,g as Me,a as ie,b as Ie,c as Te,i as Le,e as Re,f as $e}from"./emailService-c4da49df.js";import{E as te}from"./EmailAccountForm-543e3b3c.js";import{U as Ae}from"./user-15a3f646.js";import{M as w}from"./mail-1aad0795.js";import{A as le}from"./arrow-left-1a8dd8e5.js";import{M as De,S as Pe}from"./settings-4f3ac8dd.js";import{R as O}from"./refresh-cw-3a330f0d.js";import{U as V}from"./users-d80d56b5.js";import{P as Ue}from"./pen-line-7665e45d.js";import{F as q}from"./file-text-dbc5a523.js";import{C as Be}from"./chevron-left-64bd04f0.js";import{T as H}from"./trash-2-720af3a0.js";import{U as Oe}from"./upload-d0cbcdb1.js";import{S as ce}from"./send-1877c269.js";import{A as Ve}from"./alert-circle-55dbc938.js";import{C as qe}from"./chevron-right-8a01d50b.js";import"./loader-2-b4ab27ec.js";import"./save-8c42dcad.js";import"./paperclip-ea40dd47.js";import"./requestId-b38e007e.js";import"./eye-off-ed9c0be4.js";import"./eye-3ec80a3c.js";import"./check-circle-2-1ec1591c.js";import"./x-circle-14dea691.js";const He=X("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]),Xe=X("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]),Ge=X("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);function Je({isOpen:t,onClose:f,onSave:E,initialContact:a=null}){const{toast:m}=ne(),[d,s]=n.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",phone:(a==null?void 0:a.phone)||"",company:(a==null?void 0:a.company)||"",notes:(a==null?void 0:a.notes)||""}),[h,p]=n.useState(!1),C=async l=>{if(l.preventDefault(),!d.name.trim()){m({variant:"destructive",title:"Error",description:"El nombre es requerido"});return}if(!d.email.trim()){m({variant:"destructive",title:"Error",description:"El email es requerido"});return}try{p(!0),await E(d),m({title:"Contacto guardado",description:`${d.name} ha sido ${a?"actualizado":"creado"} exitosamente`}),f()}catch(g){m({variant:"destructive",title:"Error",description:g.message||"No se pudo guardar el contacto"})}finally{p(!1)}};return t?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"max-w-md w-full rounded-2xl shadow-2xl",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsx("div",{className:"p-6 border-b",style:{borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text-primary)"},children:a?"Editar contacto":"Nuevo contacto"}),e.jsx("button",{onClick:f,className:"p-2 hover:opacity-80 rounded-xl transition-all",style:{color:"var(--color-text-secondary)"},children:e.jsx($,{className:"w-5 h-5"})})]})}),e.jsxs("form",{onSubmit:C,className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:[e.jsx(Ae,{size:16}),"Nombre completo *"]}),e.jsx("input",{type:"text",value:d.name,onChange:l=>s({...d,name:l.target.value}),placeholder:"Ej: Juan PÃ©rez",className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-[#0078d4]",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:[e.jsx(w,{size:16}),"Email *"]}),e.jsx("input",{type:"email",value:d.email,onChange:l=>s({...d,email:l.target.value}),placeholder:"Ej: juan@empresa.com",className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-[#0078d4]",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:[e.jsx(Xe,{size:16}),"TelÃ©fono"]}),e.jsx("input",{type:"tel",value:d.phone,onChange:l=>s({...d,phone:l.target.value}),placeholder:"Ej: +52 55 1234 5678",className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-[#0078d4]",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:[e.jsx(He,{size:16}),"Empresa"]}),e.jsx("input",{type:"text",value:d.company,onChange:l=>s({...d,company:l.target.value}),placeholder:"Ej: ACME Corp",className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-[#0078d4]",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:[e.jsx(Ge,{size:16}),"Notas"]}),e.jsx("textarea",{value:d.notes,onChange:l=>s({...d,notes:l.target.value}),placeholder:"Notas adicionales...",rows:3,className:"w-full px-4 py-3 rounded-xl border focus:outline-none focus:ring-2 focus:ring-[#0078d4]",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"}})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:f,disabled:h,className:"flex-1 py-3 px-4 rounded-xl font-medium hover:opacity-80 transition-all",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)",border:"1px solid var(--color-border)"},children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"flex-1 py-3 px-4 rounded-xl font-medium hover:opacity-90 transition-all disabled:opacity-50",style:{backgroundColor:"var(--color-primary)",color:"#fff"},children:h?"Guardando...":a?"Actualizar":"Crear contacto"})]})]})]})}):null}function wr(){const{user:t,accessToken:f}=_e(),E=Se(),{toast:a}=ne(),[m,d]=n.useState([]),[s,h]=n.useState(null),[p,C]=n.useState([]),[l,g]=n.useState(null),[T,z]=n.useState([]),[c,j]=n.useState(null),[u,x]=n.useState(!0),[A,k]=n.useState(!1),[G,J]=n.useState(!1),[D,_]=n.useState(!1),[Z,P]=n.useState("list"),[K,N]=n.useState(!1),[de,S]=n.useState(!1),[me,F]=n.useState("new"),[xe,M]=n.useState(null),[fe,Q]=n.useState(!1),[ue,W]=n.useState(!1),[Ke,he]=n.useState([]),[L,Y]=n.useState("prioritarios");n.useEffect(()=>{t!=null&&t.id&&U()},[t]),n.useEffect(()=>{s&&t&&pe()},[s,t]),n.useEffect(()=>{l&&s&&R()},[l,s]),n.useEffect(()=>{if(!s||!l)return;const r=setInterval(async()=>{console.log("ðŸ”„ Auto-sincronizando emails...");try{const o=s.id||s.account_id;await B(o),await R(),console.log("âœ… Auto-sincronizaciÃ³n completada")}catch(o){console.error("âŒ Error en auto-sincronizaciÃ³n:",o)}},5*60*1e3);return()=>clearInterval(r)},[s,l]);async function U(){try{const r=await Me(t.id,f);console.log("ðŸ“§ Cuentas cargadas:",r),d(r||[]),r&&r.length>0&&h(r[0])}catch(r){console.error("Error cargando cuentas:",r)}finally{x(!1)}}async function pe(){try{const r=await ie(s.id||s.account_id,t.id,f);console.log("ðŸ“ Folders cargados:",r),C(r||[]);const o=r==null?void 0:r.find(i=>i.folder_name==="INBOX"||i.folder_name==="Bandeja de entrada");o?g(o):r&&r.length>0&&g(r[0])}catch(r){console.error("Error cargando folders:",r)}}async function R(){if(!s||!l||!t){console.warn("âš ï¸ Faltan datos para cargar emails");return}try{k(!0);const r=s.id||s.account_id;console.log("ðŸ“§ Cargando emails...",{accountId:r,userId:t.id,folder:l.folder_name});const o=await Ie(r,{ownerUserId:t.id,folder:l.folder_name,limit:50});console.log("âœ‰ï¸ Emails cargados:",o),o.messages&&o.messages.length>0&&console.log("ðŸ” Estructura del primer correo:",{keys:Object.keys(o.messages[0]),from_address:o.messages[0].from_address,from_name:o.messages[0].from_name,from_email:o.messages[0].from_email,subject:o.messages[0].subject}),z(o.messages||o.emails||[])}catch(r){console.error("âŒ Error cargando emails:",r),z([])}finally{k(!1)}}function ye(r){console.log("ðŸ“§ Reply a:",r),M(r),F("reply"),S(!0)}function ve(r){console.log("ðŸ“§ Reply All a:",r),M(r),F("replyAll"),S(!0)}function be(r){console.log("ðŸ“§ Forward:",r),M(r),F("forward"),S(!0)}async function ee(){if(s){J(!0);try{const r=s.id||s.account_id;console.log("ðŸ”„ Sincronizando cuenta:",r),await B(r),await R(),a({title:"Correos sincronizados",description:"Tus correos estÃ¡n actualizados"})}catch(r){console.error("âŒ Error al sincronizar:",r),a({variant:"destructive",title:"Error al sincronizar",description:r.message||"No se pudieron sincronizar los correos"})}finally{setTimeout(()=>J(!1),500)}}}async function re(){try{const r=await $e(t.id);he(r||[])}catch(r){console.error("Error cargando contactos:",r)}}async function ge(r){try{await Te(t.id,r),a({title:"Contacto creado",description:`${r.name} ha sido agregado a tus contactos`}),await re()}catch(o){throw o}}async function je(r){try{a({title:"Importando contactos...",description:"Por favor espera mientras procesamos el archivo"});const o=await Le(r,t.id);a({title:"ImportaciÃ³n completada",description:`${o.success} contactos importados${o.errors>0?`, ${o.errors} errores`:""}`}),await re()}catch(o){a({variant:"destructive",title:"Error",description:o.message||"No se pudo importar el archivo vCard"})}}const Ne={INBOX:ae,"Bandeja de entrada":ae,Sent:ce,Enviados:ce,Drafts:q,Borradores:q,Spam:Ve,Trash:H,Papelera:H};function oe(r){if(!r)return"?";const o=r.trim().split(" ");return o.length>=2?(o[0][0]+o[1][0]).toUpperCase():r[0].toUpperCase()}function se(r){const o=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#06b6d4"],i=((r==null?void 0:r.charCodeAt(0))||0)%o.length;return o[i]}function we(r){if(!r)return"";const o=new Date(r),y=new Date-o,v=Math.floor(y/(1e3*60*60));return v<24?o.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}):v<48?"Ayer":v<168?o.toLocaleDateString("es-ES",{weekday:"long"}):o.toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit"})}async function Ce(r){var o,i;try{console.log("ðŸ“§ Cargando contenido completo del correo:",{id:r.id,message_id:r.message_id,account_id:r.account_id,selectedAccount:(s==null?void 0:s.id)||(s==null?void 0:s.account_id)});const y=r.account_id||(s==null?void 0:s.id)||(s==null?void 0:s.account_id),v=r.id||r.message_id;console.log("ðŸ“ž Llamando getMessage con:",{accountId:y,messageId:v});const b=await Re(y,v);console.log("âœ… Contenido completo cargado:",{has_body_html:!!b.body_html,has_body_text:!!b.body_text,body_html_length:(o=b.body_html)==null?void 0:o.length,body_text_length:(i=b.body_text)==null?void 0:i.length}),j({...r,...b}),P("detail")}catch(y){console.error("âŒ Error cargando contenido del correo:",y),a({variant:"destructive",title:"Error",description:"No se pudo cargar el contenido del correo"}),j(r),P("detail")}}function ke(){P("list"),j(null)}return u?e.jsx("div",{className:"min-h-screen flex items-center justify-center",style:{backgroundColor:"var(--color-bg-primary)"},children:e.jsx("div",{style:{color:"var(--color-text-secondary)"},children:"Cargando..."})}):!t||m.length===0?e.jsxs("div",{className:"min-h-screen flex items-center justify-center p-4",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("div",{className:"text-center max-w-md",children:[e.jsx(w,{className:"w-16 h-16 mx-auto mb-4 opacity-20",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},className:"mb-4",children:"No tienes cuentas de email configuradas"}),e.jsx("button",{onClick:()=>N(!0),className:"px-6 py-3 rounded-xl w-full sm:w-auto font-medium hover:opacity-90",style:{backgroundColor:"var(--color-accent)",color:"#fff"},children:"+ Agregar cuenta de correo"})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsx("div",{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto rounded-2xl p-6",style:{backgroundColor:"var(--color-bg-primary)"},children:e.jsx(te,{onSave:()=>{N(!1),U()},onCancel:()=>N(!1)})})})]}):e.jsxs("div",{className:"h-screen flex flex-col",style:{backgroundColor:"#1c1c1e"},children:[e.jsxs("div",{className:"flex items-center justify-between px-3 sm:px-4 py-3 border-b shrink-0",style:{borderColor:"#2c2c2e",backgroundColor:"#1c1c1e"},children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4",children:[e.jsx("button",{onClick:()=>E(-1),className:"p-2 hover:bg-white/5 rounded-xl shrink-0 transition-all",style:{color:"#ffffff"},children:e.jsx(le,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_(!D),className:"p-2 hover:bg-white/5 rounded-xl lg:hidden shrink-0 transition-all",style:{color:"#ffffff"},children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-lg sm:text-xl font-semibold truncate",style:{color:"#ffffff"},children:"AL-E Mail"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:ee,disabled:G,className:"p-2 hover:bg-white/5 rounded-xl shrink-0 transition-all",style:{color:"#ffffff"},title:"Refrescar",children:e.jsx(O,{className:`w-5 h-5 ${G?"animate-spin":""}`})}),e.jsx("button",{onClick:()=>Q(!0),className:"p-2 hover:bg-white/5 rounded-xl shrink-0 transition-all",style:{color:"#ffffff"},title:"Contactos",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>N(!0),className:"p-2 hover:bg-white/5 rounded-xl shrink-0 transition-all",style:{color:"#ffffff"},title:"Configurar cuentas",children:e.jsx(Pe,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:`
            fixed lg:static inset-0 z-50 lg:z-auto
            w-64 lg:border-r flex flex-col
            transition-transform duration-300
            ${D?"translate-x-0":"-translate-x-full lg:translate-x-0"}
          `,style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-secondary)"},children:[D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 lg:hidden -z-10",onClick:()=>_(!1)}),e.jsxs("div",{className:"flex items-center justify-between p-4 lg:hidden border-b",style:{borderColor:"var(--color-border)"},children:[e.jsx("span",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:"Carpetas"}),e.jsx("button",{onClick:()=>_(!1),className:"p-1",children:e.jsx($,{className:"w-5 h-5",style:{color:"var(--color-text-primary)"}})})]}),e.jsx("div",{className:"p-3 sm:p-4",children:e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 py-2.5 sm:py-3 rounded-xl font-medium text-sm sm:text-base hover:opacity-90 transition-all shadow-lg",style:{backgroundColor:"var(--color-primary)",color:"#fff"},onClick:()=>{_(!1),S(!0)},children:[e.jsx(Ue,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{children:"Nuevo correo"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-2",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-xs font-semibold mb-2 px-2 uppercase",style:{color:"var(--color-text-tertiary)"},children:"Favoritos"}),e.jsxs("button",{className:"w-full flex items-center gap-3 px-3 py-2.5 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-primary)"},onClick:()=>_(!1),children:[e.jsx(q,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm",children:"Borradores"})]})]}),m.length===0?e.jsx("div",{className:"px-3 py-8 text-center text-sm",style:{color:"var(--color-text-tertiary)"},children:"No hay cuentas configuradas"}):m.map(r=>e.jsx(Ze,{account:r,user:t,accessToken:f,selectedAccount:s,selectedFolder:l,onSelectAccount:h,onSelectFolder:o=>{g(o),_(!1),j(null)},FOLDER_ICONS:Ne},r.id||r.account_id))]})]}),e.jsxs("div",{className:`
            ${Z==="detail"?"hidden lg:flex":"flex"}
            w-full lg:w-96 border-r flex-col
          `,style:{borderColor:"var(--color-border)"},children:[e.jsxs("div",{className:"p-3 sm:p-4 border-b shrink-0",style:{borderColor:"var(--color-border)"},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(w,{size:16,style:{color:"#0078d4"}}),e.jsx("h2",{className:"text-lg font-bold truncate",style:{color:"var(--color-text-primary)"},children:(s==null?void 0:s.email)||"Selecciona una cuenta"})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 ml-6",children:[e.jsxs("span",{className:"text-sm font-medium truncate",style:{color:"var(--color-text-secondary)"},children:["ðŸ“ ",l.folder_name]}),l.unread_count>0&&e.jsxs("span",{className:"text-xs px-2 py-0.5 rounded-full font-bold",style:{backgroundColor:"var(--color-accent)",color:"#fff"},children:[l.unread_count," sin leer"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto",children:[e.jsx("button",{onClick:()=>Y("prioritarios"),className:"px-3 py-1.5 text-sm rounded-xl whitespace-nowrap hover:opacity-80",style:{backgroundColor:L==="prioritarios"?"var(--color-accent)":"transparent",color:L==="prioritarios"?"#fff":"var(--color-text-secondary)"},children:"Prioritarios"}),e.jsx("button",{onClick:()=>Y("otro"),className:"px-3 py-1.5 text-sm rounded-xl whitespace-nowrap hover:opacity-80",style:{backgroundColor:L==="otro"?"var(--color-accent)":"transparent",color:L==="otro"?"#fff":"var(--color-text-secondary)"},children:"Otro"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:A?e.jsx("div",{className:"flex items-center justify-center h-full",style:{color:"var(--color-text-tertiary)"},children:e.jsx(O,{className:"w-6 h-6 animate-spin"})}):T.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8",style:{color:"var(--color-text-tertiary)"},children:[e.jsx(w,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-base font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"No hay mensajes en esta carpeta"}),e.jsx("p",{className:"text-sm text-center mb-4",children:"Los correos de tu cuenta se sincronizarÃ¡n automÃ¡ticamente"}),s&&e.jsxs("button",{onClick:async()=>{try{a({title:"Sincronizando...",description:"Descargando correos del servidor"}),await B(s.id||s.account_id),await R(),a({title:"SincronizaciÃ³n completada",description:"Los correos se han actualizado"})}catch(r){a({variant:"destructive",title:"Error",description:r.message||"No se pudo sincronizar"})}},className:"px-4 py-2 rounded-xl font-medium hover:opacity-90 transition-all",style:{backgroundColor:"#0078d4",color:"#fff"},children:[e.jsx(O,{className:"w-4 h-4 inline mr-2"}),"Sincronizar ahora"]})]}):e.jsx("div",{children:T.map(r=>{let o=r.from_name||r.from_display_name;if(!o&&r.from_address){const I=r.from_address.match(/^"?([^"<]+)"?\s*<?([^>]+)>?$/);I?o=I[1].trim():o=r.from_address.split("@")[0]}o||(o=r.from_email||r.sender||r.from||"Remitente desconocido");let i=r.from_email;if(!i&&r.from_address){const I=r.from_address.match(/<([^>]+)>/);i=I?I[1]:r.from_address}i||(i=r.sender||r.from||"");const y=oe(o),v=se(i),b=!r.is_read;return e.jsx("button",{onClick:()=>Ce(r),className:"w-full p-3 sm:p-4 border-b text-left hover:opacity-80 transition-colors",style:{borderColor:"var(--color-border)",backgroundColor:(c==null?void 0:c.message_id)===r.message_id?"var(--color-bg-secondary)":"transparent"},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 shrink-0 rounded-full flex items-center justify-center font-semibold text-sm",style:{backgroundColor:v,color:"#FFFFFF"},children:y}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 gap-2",children:[e.jsxs("div",{className:"flex flex-col flex-1 min-w-0",children:[e.jsx("span",{className:`font-medium text-sm truncate ${b?"font-bold":""}`,style:{color:"var(--color-text-primary)"},children:o}),i&&i!==o&&e.jsx("span",{className:"text-xs truncate",style:{color:"var(--color-text-tertiary)"},children:i})]}),e.jsx("span",{className:"text-xs shrink-0",style:{color:"var(--color-text-tertiary)"},children:we(r.received_at||r.date)})]}),e.jsx("div",{className:`text-sm mb-1 truncate ${b?"font-semibold":""}`,style:{color:"var(--color-text-primary)"},children:r.subject||"(Sin asunto)"}),e.jsx("div",{className:"text-xs truncate",style:{color:"var(--color-text-secondary)"},children:r.preview||r.text_preview||""})]})]})},r.message_id||r.id)})})})]}),e.jsx("div",{className:`
            ${Z==="list"?"hidden lg:flex":"flex"}
            flex-1 flex-col
          `,style:{backgroundColor:"var(--color-bg-secondary)"},children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 sm:p-6 border-b shrink-0",style:{borderColor:"var(--color-border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("button",{onClick:ke,className:"lg:hidden p-2 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-primary)"},children:e.jsx(Be,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>ye(c),className:"px-3 py-2 rounded-xl hover:opacity-80 flex items-center gap-2",style:{backgroundColor:"var(--color-primary)",color:"white"},children:[e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Responder"})]}),e.jsxs("button",{onClick:()=>ve(c),className:"px-3 py-2 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-primary)"},children:[e.jsx("span",{className:"hidden sm:inline",children:"Responder a todos"}),e.jsx("span",{className:"sm:hidden",children:"Todos"})]}),e.jsxs("button",{onClick:()=>be(c),className:"px-3 py-2 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-primary)"},children:[e.jsx("span",{className:"hidden sm:inline",children:"Reenviar"}),e.jsx("span",{className:"sm:hidden",children:"â†’"})]}),e.jsx("button",{className:"p-2 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)"},children:e.jsx(Ee,{className:"w-4 h-4",style:{color:"var(--color-text-primary)"}})}),e.jsx("button",{className:"p-2 rounded-xl hover:opacity-80",style:{backgroundColor:"var(--color-bg-tertiary)"},children:e.jsx(H,{className:"w-4 h-4",style:{color:"var(--color-text-primary)"}})})]})]}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-4",style:{color:"var(--color-text-primary)"},children:c.subject||"(Sin asunto)"}),e.jsx("div",{className:"flex items-center gap-3",children:(()=>{let r=c.from_name||c.from_display_name,o=c.from_email;if(!r&&c.from_address){const i=c.from_address.match(/^"?([^"<]+)"?\s*<?([^>]+)>?$/);i?(r=i[1].trim(),o=i[2].trim()):(r=c.from_address.split("@")[0],o=c.from_address)}return r||(r=o||c.from||"Remitente desconocido"),e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-10 h-10 sm:w-12 sm:h-12 shrink-0 rounded-full flex items-center justify-center font-semibold text-base sm:text-lg",style:{backgroundColor:se(o||r),color:"#FFFFFF"},children:oe(r)}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"font-semibold truncate",style:{color:"var(--color-text-primary)"},children:r}),e.jsxs("div",{className:"text-sm truncate",style:{color:"var(--color-text-secondary)"},children:["Para: ",(s==null?void 0:s.from_email)||"ti"]})]})]})})()})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:e.jsx("div",{style:{color:"var(--color-text-primary)"},children:(()=>{const r=c.body_html&&c.body_html!=="false"&&c.body_html.trim().length>0,o=c.body_text&&c.body_text!=="false"&&c.body_text.trim().length>0;if(r){const i=ze.sanitize(c.body_html);return e.jsx("div",{className:"email-html-content",dangerouslySetInnerHTML:{__html:i}})}else return o?e.jsx("pre",{className:"email-text-content whitespace-pre-wrap font-sans",children:c.body_text}):c.preview||c.body_preview?e.jsxs("div",{className:"text-gray-500 italic",children:[e.jsx("p",{className:"mb-2",children:"Vista previa:"}),e.jsx("p",{children:c.preview||c.body_preview}),e.jsx("p",{className:"mt-4 text-sm",children:"âš ï¸ Contenido completo no disponible en este correo"})]}):e.jsx("p",{className:"text-gray-500 italic",children:"Sin contenido"})})()})})]}):e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4",style:{color:"var(--color-text-tertiary)"},children:[e.jsx(w,{className:"w-16 sm:w-24 h-16 sm:h-24 mb-4 opacity-20"}),e.jsx("p",{className:"text-base sm:text-lg text-center",children:"No hay ninguna conversaciÃ³n seleccionada"}),e.jsx("p",{className:"text-sm text-center mt-2",children:"Selecciona una conversaciÃ³n para leer."})]})})]}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"max-w-2xl w-full max-h-[90vh] overflow-y-auto rounded-2xl p-6",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",style:{color:"var(--color-text-primary)"},children:"ConfiguraciÃ³n de correo"}),e.jsx("button",{onClick:()=>N(!1),className:"p-2 hover:opacity-80 rounded-xl",style:{color:"var(--color-text-secondary)"},children:e.jsx($,{className:"w-5 h-5"})})]}),m.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"font-semibold mb-3",style:{color:"var(--color-text-primary)"},children:"Cuentas configuradas"}),e.jsx("div",{className:"space-y-2",children:m.map(r=>e.jsxs("div",{className:"p-3 rounded-xl border flex items-center justify-between",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-secondary)"},children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",style:{color:"var(--color-text-primary)"},children:r.from_name||"Sin nombre"}),e.jsx("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:r.from_email})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded-full",style:{backgroundColor:r.is_active?"rgba(16, 185, 129, 0.2)":"rgba(239, 68, 68, 0.2)",color:r.is_active?"#10b981":"#ef4444"},children:r.is_active?"Activa":"Inactiva"})})]},r.id||r.account_id))})]}),e.jsx(te,{onSave:()=>{N(!1),U()},onCancel:()=>N(!1)})]})}),de&&e.jsx(Fe,{mode:me,replyTo:xe,account:s,onClose:()=>{S(!1),F("new"),M(null)},onSent:()=>{S(!1),F("new"),M(null),ee()}}),fe&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"max-w-4xl w-full max-h-[90vh] overflow-y-auto rounded-2xl shadow-2xl",style:{backgroundColor:"var(--color-bg-primary)"},children:[e.jsx("div",{className:"sticky top-0 z-10 p-6 border-b",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",style:{color:"var(--color-text-primary)"},children:"Contactos"}),e.jsx("button",{onClick:()=>Q(!1),className:"p-2 hover:opacity-80 rounded-xl transition-all",style:{color:"var(--color-text-secondary)"},children:e.jsx($,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{onClick:()=>{const r=document.createElement("input");r.type="file",r.accept=".vcf,.vcard",r.onchange=o=>{const i=o.target.files[0];i&&je(i)},r.click()},className:"p-6 rounded-2xl border-2 border-dashed hover:opacity-80 transition-all text-center",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-secondary)"},children:[e.jsx(Oe,{className:"w-12 h-12 mx-auto mb-3",style:{color:"var(--color-accent)"}}),e.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--color-text-primary)"},children:"Importar vCard"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Importa contactos desde archivos .vcf o .vcard"})]}),e.jsxs("button",{onClick:()=>{W(!0)},className:"p-6 rounded-2xl border-2 hover:opacity-80 transition-all text-center",style:{borderColor:"#0078d4",backgroundColor:"rgba(0, 120, 212, 0.1)"},children:[e.jsx(V,{className:"w-12 h-12 mx-auto mb-3",style:{color:"#0078d4"}}),e.jsx("h3",{className:"font-semibold text-lg mb-2",style:{color:"var(--color-text-primary)"},children:"Crear contacto"}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Agrega un nuevo contacto manualmente"})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"font-semibold text-lg mb-4",style:{color:"var(--color-text-primary)"},children:"Mis contactos"}),e.jsxs("div",{className:"text-center py-12 rounded-xl",style:{backgroundColor:"var(--color-bg-secondary)"},children:[e.jsx(V,{className:"w-16 h-16 mx-auto mb-4 opacity-20",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{style:{color:"var(--color-text-secondary)"},children:"No tienes contactos guardados aÃºn"}),e.jsx("p",{className:"text-sm mt-2",style:{color:"var(--color-text-tertiary)"},children:"Importa o crea tu primer contacto"})]})]})]})]})}),e.jsx(Je,{isOpen:ue,onClose:()=>W(!1),onSave:ge})]})}function Ze({account:t,user:f,accessToken:E,selectedAccount:a,selectedFolder:m,onSelectAccount:d,onSelectFolder:s,FOLDER_ICONS:h}){const[p,C]=n.useState([]),[l,g]=n.useState(!0),[T,z]=n.useState(!1);n.useEffect(()=>{l&&c()},[l,t]);async function c(){try{z(!0);const x=await ie(t.id||t.account_id,f.id,E);console.log(`ðŸ“ Folders de ${t.email}:`,x),C(x||[])}catch(x){console.error("Error cargando folders:",x),C([])}finally{z(!1)}}const j=t.id||t.account_id,u=(a==null?void 0:a.id)===j||(a==null?void 0:a.account_id)===j;return e.jsxs("div",{className:"mb-4",children:[e.jsxs("button",{onClick:()=>{g(!l),u||d(t)},className:"w-full flex items-center gap-2 px-3 py-3 rounded-xl hover:opacity-90 transition-all shadow-sm",style:{backgroundColor:u?"var(--color-primary)":"var(--color-bg-tertiary)",color:u?"#fff":"var(--color-text-primary)",border:`2px solid ${u?"var(--color-primary)":"var(--color-border)"}`},children:[e.jsx(qe,{size:16,className:`transition-transform shrink-0 ${l?"rotate-90":""}`}),e.jsx(w,{size:18,className:"shrink-0"}),e.jsxs("div",{className:"flex-1 text-left min-w-0",children:[e.jsx("div",{className:"text-sm font-bold truncate",children:t.email||"Cuenta de correo"}),e.jsx("div",{className:"text-xs truncate opacity-80",children:t.display_name||t.from_name||""})]}),p.length>0&&e.jsxs("span",{className:"text-xs px-2 py-1 rounded-full shrink-0 font-medium",style:{backgroundColor:u?"rgba(255,255,255,0.2)":"var(--color-bg-primary)",color:u?"#fff":"var(--color-text-tertiary)"},children:[p.length," carpetas"]})]}),l&&e.jsx("div",{className:"ml-6 mt-2 space-y-1 pl-2 border-l-2",style:{borderColor:u?"var(--color-primary)":"var(--color-border)"},children:T?e.jsx("div",{className:"px-3 py-2 text-xs",style:{color:"var(--color-text-tertiary)"},children:"Cargando..."}):p.length===0?e.jsx("div",{className:"px-3 py-2 text-xs",style:{color:"var(--color-text-tertiary)"},children:"Sin carpetas"}):p.map(x=>{const A=h[x.folder_name]||w,k=(m==null?void 0:m.folder_id)===x.folder_id;return e.jsxs("button",{onClick:()=>{d(t),s(x)},className:"w-full flex items-center justify-between px-3 py-2 rounded-lg hover:opacity-90 transition-all",style:{backgroundColor:k?"var(--color-accent)":"transparent",color:k?"#fff":"var(--color-text-primary)"},children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx(A,{className:"w-4 h-4 shrink-0"}),e.jsx("span",{className:"text-sm font-medium truncate",children:x.folder_name})]}),x.unread_count>0&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full shrink-0 font-bold",style:{backgroundColor:k?"rgba(255,255,255,0.3)":"var(--color-accent)",color:"#fff"},children:x.unread_count})]},x.folder_id)})})]})}export{wr as default};
