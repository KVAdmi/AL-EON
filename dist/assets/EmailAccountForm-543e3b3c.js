import{e as D,a as H,r as m,j as e,X as O}from"./index-e4e1323c.js";import{u as J,h as B,t as X}from"./emailService-c4da49df.js";import{U as K}from"./upload-d0cbcdb1.js";import{E as I}from"./eye-off-ed9c0be4.js";import{E as F}from"./eye-3ec80a3c.js";import{C as Y}from"./check-circle-2-1ec1591c.js";import{X as Q}from"./x-circle-14dea691.js";import{L as _}from"./loader-2-b4ab27ec.js";const y="ale_email_form_draft";function se({account:r=null,onSave:T,onCancel:M}){const{user:h}=D(),{toast:t}=H(),[g,f]=m.useState(!1),[v,j]=m.useState(!1),[c,N]=m.useState(null),z=()=>{var o,s,i,d,x,w,E,S,P;if(r)return console.log("üîµ [EmailAccountForm] Cargando cuenta para editar:",r),{fromName:r.from_name||r.fromName||"",fromEmail:r.from_email||r.fromEmail||"",signature:r.signature||"",signatureImage:null,enableFlags:r.enable_flags!==void 0?r.enable_flags:!0,enableSpamFilter:r.enable_spam_filter!==void 0?r.enable_spam_filter:!0,smtp:{host:r.smtp_host||((o=r.smtp)==null?void 0:o.host)||"",port:r.smtp_port||((s=r.smtp)==null?void 0:s.port)||587,secure:r.smtp_secure!==void 0?r.smtp_secure:((i=r.smtp)==null?void 0:i.secure)||!1,user:r.smtp_user||((d=r.smtp)==null?void 0:d.user)||"",password:""},imap:{enabled:r.imap_host?!0:((x=r.imap)==null?void 0:x.enabled)||!1,host:r.imap_host||((w=r.imap)==null?void 0:w.host)||"",port:r.imap_port||((E=r.imap)==null?void 0:E.port)||993,secure:r.imap_secure!==void 0?r.imap_secure:((S=r.imap)==null?void 0:S.secure)||!0,user:r.imap_user||((P=r.imap)==null?void 0:P.user)||"",password:""}};try{const b=localStorage.getItem(y);if(b)return JSON.parse(b)}catch(b){console.error("Error recuperando draft:",b)}return{fromName:"",fromEmail:"",signature:"",signatureImage:null,enableFlags:!0,enableSpamFilter:!0,smtp:{host:"",port:587,secure:!1,user:"",password:""},imap:{enabled:!1,host:"",port:993,secure:!0,user:"",password:""}}},[a,n]=m.useState(z),[C,k]=m.useState((r==null?void 0:r.signatureImageUrl)||null),[p,A]=m.useState(!1),[u,U]=m.useState(!1);m.useEffect(()=>{if(!r)try{localStorage.setItem(y,JSON.stringify(a))}catch(o){console.error("Error guardando draft:",o)}},[a,r]);function l(o,s,i){n(o?d=>({...d,[o]:{...d[o],[s]:i}}):d=>({...d,[s]:i})),N(null)}function G(o){var d;const s=(d=o.target.files)==null?void 0:d[0];if(!s)return;if(!["image/jpeg","image/jpg","image/png"].includes(s.type)){t({variant:"destructive",title:"Formato no v√°lido",description:"Solo se permiten archivos JPG y PNG"});return}if(s.size>2*1024*1024){t({variant:"destructive",title:"Archivo muy grande",description:"La imagen no debe superar 2MB"});return}const i=new FileReader;i.onloadend=()=>{k(i.result),n(x=>({...x,signatureImage:i.result}))},i.readAsDataURL(s)}function L(){k(null),n(o=>({...o,signatureImage:null}))}async function q(o){if(o.preventDefault(),!h){t({variant:"destructive",title:"Error",description:"Usuario no autenticado"});return}if(!a.fromName||!a.fromName.trim()){t({variant:"destructive",title:"Campos requeridos",description:"El nombre del remitente es obligatorio"});return}if(r!=null&&r.id&&!a.smtp.password&&!a.imap.password){t({variant:"destructive",title:"Contrase√±as requeridas",description:"Debes reingresar las contrase√±as SMTP e IMAP para actualizar la cuenta"});return}try{f(!0);const s={ownerUserId:h.id,fromName:a.fromName.trim(),fromEmail:a.fromEmail,signature:a.signature,signatureImage:a.signatureImage,enableFlags:a.enableFlags,enableSpamFilter:a.enableSpamFilter,smtpHost:a.smtp.host,smtpPort:parseInt(a.smtp.port),smtpSecure:a.smtp.secure,smtpUser:a.smtp.user,imapEnabled:a.imap.enabled,imapHost:a.imap.host,imapPort:parseInt(a.imap.port),imapSecure:a.imap.secure,imapUser:a.imap.user};if(a.smtp.password&&(s.smtpPass=a.smtp.password),a.imap.password&&(s.imapPass=a.imap.password),console.log("üîµ [EmailAccountForm] Guardando cuenta...",{isUpdate:!!(r!=null&&r.id),accountId:r==null?void 0:r.id,payload:{...s,smtpPass:"***",imapPass:"***"}}),r!=null&&r.id)await J(r.id,s),t({title:"Cuenta actualizada",description:"‚úì Los cambios se guardaron correctamente"});else{await B(s),t({title:"Cuenta creada",description:"‚úì La cuenta de email se cre√≥ correctamente"});try{localStorage.removeItem(y)}catch(i){console.error("Error limpiando draft:",i)}}T()}catch(s){console.error("‚ùå [EmailAccountForm] Error guardando:",s),t({variant:"destructive",title:"Error al guardar",description:s.message||"No se pudo guardar la cuenta"})}finally{f(!1)}}async function R(){if(!(r!=null&&r.id)){t({variant:"destructive",title:"Error",description:"Guarda la cuenta primero antes de probar la conexi√≥n"});return}try{j(!0);const o=await X(r.id);N(o),o.success?t({title:"Conexi√≥n exitosa",description:o.message}):t({variant:"destructive",title:"Error de conexi√≥n",description:o.message})}catch(o){t({variant:"destructive",title:"Error",description:o.message||"No se pudo probar la conexi√≥n"})}finally{j(!1)}}return e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",style:{color:"var(--color-text-primary)"},children:r?"Editar cuenta":"Nueva cuenta de correo"}),r&&e.jsxs("div",{className:"p-4 rounded-lg border-l-4 mb-4",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",borderLeftColor:"var(--color-primary)"},children:[e.jsx("p",{className:"text-sm font-medium mb-1",style:{color:"var(--color-primary)"},children:"üîê Modo Edici√≥n"}),e.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:["Los datos se cargar√°n autom√°ticamente. Por seguridad, debes ",e.jsx("strong",{children:"reingresar las contrase√±as"})," SMTP e IMAP para actualizar."]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Nombre del remitente"}),e.jsx("input",{type:"text",value:a.fromName,onChange:o=>l(null,"fromName",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"Tu Nombre",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Email del remitente"}),e.jsx("input",{type:"email",value:a.fromEmail,onChange:o=>l(null,"fromEmail",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"tu@email.com",required:!0})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[e.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text-primary)"},children:"Firma de correo"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Texto de firma"}),e.jsx("textarea",{value:a.signature,onChange:o=>l(null,"signature",o.target.value),rows:3,className:"w-full px-4 py-2.5 rounded-lg border resize-none",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:`Saludos,
Tu nombre
Tu empresa`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Imagen de firma (JPG/PNG, m√°x 2MB)"}),C?e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:C,alt:"Firma",className:"max-h-32 rounded border",style:{borderColor:"var(--color-border)"}}),e.jsx("button",{type:"button",onClick:L,className:"absolute -top-2 -right-2 p-1 rounded-full",style:{backgroundColor:"var(--color-error, #ef4444)",color:"white"},children:e.jsx(O,{size:16})})]}):e.jsxs("label",{className:"cursor-pointer",children:[e.jsxs("div",{className:"border-2 border-dashed rounded-lg p-6 text-center hover:opacity-80 transition-opacity",style:{borderColor:"var(--color-border)"},children:[e.jsx(K,{size:32,className:"mx-auto mb-2",style:{color:"var(--color-text-tertiary)"}}),e.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"Click para subir imagen"}),e.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:"JPG o PNG, m√°ximo 2MB"})]}),e.jsx("input",{type:"file",accept:"image/jpeg,image/jpg,image/png",onChange:G,className:"hidden"})]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[e.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text-primary)"},children:"Clasificaci√≥n de correos"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.enableFlags,onChange:o=>l(null,"enableFlags",o.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-accent)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--color-text-primary)"},children:"Habilitar banderas"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Permitir clasificar correos: Urgente, Importante, Pendiente, etc."})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:a.enableSpamFilter,onChange:o=>l(null,"enableSpamFilter",o.target.checked),className:"w-5 h-5 rounded",style:{accentColor:"var(--color-accent)"}}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",style:{color:"var(--color-text-primary)"},children:"Filtro anti-spam"}),e.jsx("p",{className:"text-xs",style:{color:"var(--color-text-secondary)"},children:"Clasificar autom√°ticamente correos como spam"})]})]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[e.jsx("h4",{className:"font-semibold mb-3",style:{color:"var(--color-text-primary)"},children:"Configuraci√≥n SMTP (Env√≠o)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Host"}),e.jsx("input",{type:"text",value:a.smtp.host,onChange:o=>l("smtp","host",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"smtp.gmail.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Puerto"}),e.jsx("input",{type:"number",value:a.smtp.port,onChange:o=>l("smtp","port",parseInt(o.target.value)),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"587",required:!0})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.smtp.secure,onChange:o=>l("smtp","secure",o.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Usar conexi√≥n segura (SSL/TLS)"})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Usuario SMTP"}),e.jsx("input",{type:"text",value:a.smtp.user,onChange:o=>l("smtp","user",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"usuario@email.com",required:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Contrase√±a SMTP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:p?"text":"password",value:a.smtp.password,onChange:o=>l("smtp","password",o.target.value),className:"w-full px-4 py-2.5 pr-12 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0}),e.jsx("button",{type:"button",onClick:()=>A(!p),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-[var(--color-bg-hover)]",style:{color:"var(--color-text-secondary)"},title:p?"Ocultar contrase√±a":"Mostrar contrase√±a",children:p?e.jsx(I,{size:18}):e.jsx(F,{size:18})})]})]}),"quired /"]})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold",style:{color:"var(--color-text-primary)"},children:"Configuraci√≥n IMAP (Recepci√≥n)"}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.imap.enabled,onChange:o=>l("imap","enabled",o.target.checked),className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",style:{color:"var(--color-text-primary)"},children:"Habilitar"})]})]}),a.imap.enabled&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Host"}),e.jsx("input",{type:"text",value:a.imap.host,onChange:o=>l("imap","host",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"imap.gmail.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Puerto"}),e.jsx("input",{type:"number",value:a.imap.port,onChange:o=>l("imap","port",parseInt(o.target.value)),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"993"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Usuario IMAP"}),e.jsx("input",{type:"text",value:a.imap.user,onChange:o=>l("imap","user",o.target.value),className:"w-full px-4 py-2.5 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"usuario@email.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",style:{color:"var(--color-text-primary)"},children:"Contrase√±a IMAP"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:u?"text":"password",value:a.imap.password,onChange:o=>l("imap","password",o.target.value),className:"w-full px-4 py-2.5 pr-12 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"}),e.jsx("button",{type:"button",onClick:()=>U(!u),className:"absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded hover:bg-[var(--color-bg-hover)]",style:{color:"var(--color-text-secondary)"},title:u?"Ocultar contrase√±a":"Mostrar contrase√±a",children:u?e.jsx(I,{size:18}):e.jsx(F,{size:18})})]})]})]})]}),c&&e.jsxs("div",{className:"p-4 rounded-lg border flex items-start gap-3",style:{backgroundColor:c.success?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",borderColor:c.success?"var(--color-success, #10b981)":"var(--color-error, #ef4444)"},children:[c.success?e.jsx(Y,{size:20,style:{color:"var(--color-success, #10b981)",marginTop:"2px"}}):e.jsx(Q,{size:20,style:{color:"var(--color-error, #ef4444)",marginTop:"2px"}}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",style:{color:c.success?"var(--color-success, #10b981)":"var(--color-error, #ef4444)"},children:c.success?"Conexi√≥n exitosa":"Error de conexi√≥n"}),e.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:c.message})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{type:"submit",disabled:g,className:"flex-1 py-2.5 px-4 rounded-xl font-medium transition-all hover:opacity-90 disabled:opacity-50 flex items-center justify-center gap-2",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},children:[g&&e.jsx(_,{size:16,className:"animate-spin"}),g?"Guardando...":"Guardar"]}),(r==null?void 0:r.id)&&e.jsxs("button",{type:"button",onClick:R,disabled:v,className:"px-4 py-2.5 rounded-xl font-medium border transition-all hover:opacity-90 disabled:opacity-50 flex items-center gap-2",style:{borderColor:"var(--color-border)",color:"var(--color-text-primary)"},children:[v&&e.jsx(_,{size:16,className:"animate-spin"}),v?"Probando...":"Probar conexi√≥n"]}),e.jsx("button",{type:"button",onClick:M,className:"px-4 py-2.5 rounded-xl font-medium border transition-all hover:opacity-90",style:{borderColor:"var(--color-border)",color:"var(--color-text-secondary)"},children:"Cancelar"})]})]})}export{se as E};
