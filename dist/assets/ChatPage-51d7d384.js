import{c as ee,r as v,j as o,R as ir,X as Ne,s as O,u as gt,a as ar,b as Gs,d as Tn,S as Pn,e as Ke,f as kn,g as nt,h as En,i as An}from"./index-e4e1323c.js";import{A as Ve}from"./alert-circle-55dbc938.js";import{S as qs}from"./save-8c42dcad.js";import{F as Se}from"./file-text-dbc5a523.js";import{C as Ks,W as Dn,a as lr,S as Mn,M as Vn,b as Rn,g as Ln,n as Fn}from"./notifications-f9b68795.js";import{I as Xs}from"./image-2a707bef.js";import{L as Ys}from"./loader-2-b4ab27ec.js";import{C as Fr}from"./check-circle-2-1ec1591c.js";import{X as Ut}from"./x-circle-14dea691.js";import{C as In}from"./check-circle-3feff249.js";import{S as Js,M as On}from"./settings-4f3ac8dd.js";import{C as Xe,s as _n,a as Bn}from"./tts-d42754de.js";import{M as Ir}from"./mic-5fe6cbf6.js";import{V as zn}from"./volume-2-8c08ca19.js";import{M as cr}from"./message-square-ee262869.js";import{R as Un}from"./refresh-cw-3a330f0d.js";import{P as Or}from"./paperclip-ea40dd47.js";import{S as Zs}from"./send-1877c269.js";import{P as dr}from"./pen-line-7665e45d.js";import{T as ur}from"./trash-2-720af3a0.js";import{E as $n}from"./eye-3ec80a3c.js";import{U as Wn}from"./upload-d0cbcdb1.js";import{D as Hn}from"./download-d08d90ee.js";import{B as $t}from"./bell-a4a3aff2.js";import{C as Wt}from"./calendar-e8089789.js";import{U as hr}from"./users-d80d56b5.js";import{u as Qs}from"./CapabilitiesGate-5a062803.js";import{P as eo}from"./plus-b374ad1c.js";import{M as Gn}from"./mail-1aad0795.js";import{C as fr}from"./chevron-right-8a01d50b.js";import{U as _r}from"./user-15a3f646.js";import{g as Nt,l as Fe,a as Tt}from"./requestId-b38e007e.js";const qn=ee("BookmarkPlus",[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}],["line",{x1:"12",x2:"12",y1:"7",y2:"13",key:"1cppfj"}],["line",{x1:"15",x2:"9",y1:"10",y2:"10",key:"1gty7f"}]]),Kn=ee("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]),Xn=ee("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Yn=ee("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]),to=ee("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Jn=ee("Folder",[["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Zn=ee("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]),Qn=ee("MoreVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),ei=ee("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),ti=ee("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),ri=ee("StopCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{width:"6",height:"6",x:"9",y:"9",key:"1wrtvo"}]]),si=ee("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),Br=ee("Waves",[["path",{d:"M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"knzxuh"}],["path",{d:"M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"2jd2cc"}],["path",{d:"M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"rd2r6e"}]]);function oi(e){if(!e)return null;if(typeof e=="object"&&e!==null){console.error("❌ CRÍTICO: Se intentó renderizar JSON en el chat:",e);const t=e.answer||e.message||e.text||e.content||e.reply;return t&&typeof t=="string"?(console.warn("✅ Extrayendo texto del objeto (ESTO NO DEBERÍA PASAR):",t),o.jsx("div",{className:"whitespace-pre-wrap",children:t})):(console.error("❌ No se pudo extraer texto del objeto. Keys:",Object.keys(e)),o.jsx("div",{className:"whitespace-pre-wrap",style:{color:"var(--color-text-secondary)"},children:"[Error: respuesta inválida]"}))}if(typeof e=="string"&&e.trim().startsWith("{"))try{const t=JSON.parse(e);console.error("❌ CRÍTICO: String JSON detectado en el chat:",t);const r=t.answer||t.message||t.text||t.content||t.reply;if(r&&typeof r=="string")return console.warn("✅ Extrayendo texto del JSON parseado:",r),o.jsx("div",{className:"whitespace-pre-wrap",children:r})}catch{}return o.jsx("div",{className:"whitespace-pre-wrap",children:e})}function ni({content:e}){const t=v.useMemo(()=>oi(e),[e]);return o.jsx("div",{className:"markdown-content",children:t})}const ro=v.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),xt=v.createContext({}),mr=v.createContext(null),yt=typeof document<"u",ii=yt?v.useLayoutEffect:v.useEffect,so=v.createContext({strict:!1}),pr=e=>e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),ai="framerAppearId",oo="data-"+pr(ai);function li(e,t,r,s){const{visualElement:n}=v.useContext(xt),i=v.useContext(so),a=v.useContext(mr),l=v.useContext(ro).reducedMotion,c=v.useRef();s=s||i.renderer,!c.current&&s&&(c.current=s(e,{visualState:t,parent:n,props:r,presenceContext:a,blockInitialAnimation:a?a.initial===!1:!1,reducedMotionConfig:l}));const d=c.current;v.useInsertionEffect(()=>{d&&d.update(r,a)});const u=v.useRef(!!(r[oo]&&!window.HandoffComplete));return ii(()=>{d&&(d.render(),u.current&&d.animationState&&d.animationState.animateChanges())}),v.useEffect(()=>{d&&(d.updateFeatures(),!u.current&&d.animationState&&d.animationState.animateChanges(),u.current&&(u.current=!1,window.HandoffComplete=!0))}),d}function Ee(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function ci(e,t,r){return v.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),r&&(typeof r=="function"?r(s):Ee(r)&&(r.current=s))},[t])}function He(e){return typeof e=="string"||Array.isArray(e)}function vt(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const gr=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],xr=["initial",...gr];function bt(e){return vt(e.animate)||xr.some(t=>He(e[t]))}function no(e){return!!(bt(e)||e.variants)}function di(e,t){if(bt(e)){const{initial:r,animate:s}=e;return{initial:r===!1||He(r)?r:void 0,animate:He(s)?s:void 0}}return e.inherit!==!1?t:{}}function ui(e){const{initial:t,animate:r}=di(e,v.useContext(xt));return v.useMemo(()=>({initial:t,animate:r}),[zr(t),zr(r)])}function zr(e){return Array.isArray(e)?e.join(" "):e}const Ur={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},Ge={};for(const e in Ur)Ge[e]={isEnabled:t=>Ur[e].some(r=>!!t[r])};function hi(e){for(const t in e)Ge[t]={...Ge[t],...e[t]}}const io=v.createContext({}),ao=v.createContext({}),fi=Symbol.for("motionComponentSymbol");function mi({preloadedFeatures:e,createVisualElement:t,useRender:r,useVisualState:s,Component:n}){e&&hi(e);function i(l,c){let d;const u={...v.useContext(ro),...l,layoutId:pi(l)},{isStatic:h}=u,f=ui(l),m=s(l,h);if(!h&&yt){f.visualElement=li(n,m,u,t);const g=v.useContext(ao),x=v.useContext(so).strict;f.visualElement&&(d=f.visualElement.loadFeatures(u,x,e,g))}return v.createElement(xt.Provider,{value:f},d&&f.visualElement?v.createElement(d,{visualElement:f.visualElement,...u}):null,r(n,l,ci(m,f.visualElement,c),m,h,f.visualElement))}const a=v.forwardRef(i);return a[fi]=n,a}function pi({layoutId:e}){const t=v.useContext(io).id;return t&&e!==void 0?t+"-"+e:e}function gi(e){function t(s,n={}){return mi(e(s,n))}if(typeof Proxy>"u")return t;const r=new Map;return new Proxy(t,{get:(s,n)=>(r.has(n)||r.set(n,t(n)),r.get(n))})}const xi=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function yr(e){return typeof e!="string"||e.includes("-")?!1:!!(xi.indexOf(e)>-1||/[A-Z]/.test(e))}const lt={};function yi(e){Object.assign(lt,e)}const Ye=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Te=new Set(Ye);function lo(e,{layout:t,layoutId:r}){return Te.has(e)||e.startsWith("origin")||(t||r!==void 0)&&(!!lt[e]||e==="opacity")}const J=e=>!!(e&&e.getVelocity),vi={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},bi=Ye.length;function wi(e,{enableHardwareAcceleration:t=!0,allowTransformNone:r=!0},s,n){let i="";for(let a=0;a<bi;a++){const l=Ye[a];if(e[l]!==void 0){const c=vi[l]||l;i+=`${c}(${e[l]}) `}}return t&&!e.z&&(i+="translateZ(0)"),i=i.trim(),n?i=n(e,s?"":i):r&&s&&(i="none"),i}const co=e=>t=>typeof t=="string"&&t.startsWith(e),uo=co("--"),Ht=co("var(--"),ji=/var\s*\(\s*--[\w-]+(\s*,\s*(?:(?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)+)?\s*\)/g,Ci=(e,t)=>t&&typeof e=="number"?t.transform(e):e,ge=(e,t,r)=>Math.min(Math.max(r,e),t),Pe={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},ze={...Pe,transform:e=>ge(0,1,e)},tt={...Pe,default:1},Ue=e=>Math.round(e*1e5)/1e5,wt=/(-)?([\d]*\.?[\d])+/g,ho=/(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,Si=/^(#[0-9a-f]{3,8}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function Je(e){return typeof e=="string"}const Ze=e=>({test:t=>Je(t)&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),he=Ze("deg"),ie=Ze("%"),V=Ze("px"),Ni=Ze("vh"),Ti=Ze("vw"),$r={...ie,parse:e=>ie.parse(e)/100,transform:e=>ie.transform(e*100)},Wr={...Pe,transform:Math.round},fo={borderWidth:V,borderTopWidth:V,borderRightWidth:V,borderBottomWidth:V,borderLeftWidth:V,borderRadius:V,radius:V,borderTopLeftRadius:V,borderTopRightRadius:V,borderBottomRightRadius:V,borderBottomLeftRadius:V,width:V,maxWidth:V,height:V,maxHeight:V,size:V,top:V,right:V,bottom:V,left:V,padding:V,paddingTop:V,paddingRight:V,paddingBottom:V,paddingLeft:V,margin:V,marginTop:V,marginRight:V,marginBottom:V,marginLeft:V,rotate:he,rotateX:he,rotateY:he,rotateZ:he,scale:tt,scaleX:tt,scaleY:tt,scaleZ:tt,skew:he,skewX:he,skewY:he,distance:V,translateX:V,translateY:V,translateZ:V,x:V,y:V,z:V,perspective:V,transformPerspective:V,opacity:ze,originX:$r,originY:$r,originZ:V,zIndex:Wr,fillOpacity:ze,strokeOpacity:ze,numOctaves:Wr};function vr(e,t,r,s){const{style:n,vars:i,transform:a,transformOrigin:l}=e;let c=!1,d=!1,u=!0;for(const h in t){const f=t[h];if(uo(h)){i[h]=f;continue}const m=fo[h],g=Ci(f,m);if(Te.has(h)){if(c=!0,a[h]=g,!u)continue;f!==(m.default||0)&&(u=!1)}else h.startsWith("origin")?(d=!0,l[h]=g):n[h]=g}if(t.transform||(c||s?n.transform=wi(e.transform,r,u,s):n.transform&&(n.transform="none")),d){const{originX:h="50%",originY:f="50%",originZ:m=0}=l;n.transformOrigin=`${h} ${f} ${m}`}}const br=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function mo(e,t,r){for(const s in t)!J(t[s])&&!lo(s,r)&&(e[s]=t[s])}function Pi({transformTemplate:e},t,r){return v.useMemo(()=>{const s=br();return vr(s,t,{enableHardwareAcceleration:!r},e),Object.assign({},s.vars,s.style)},[t])}function ki(e,t,r){const s=e.style||{},n={};return mo(n,s,e),Object.assign(n,Pi(e,t,r)),e.transformValues?e.transformValues(n):n}function Ei(e,t,r){const s={},n=ki(e,t,r);return e.drag&&e.dragListener!==!1&&(s.draggable=!1,n.userSelect=n.WebkitUserSelect=n.WebkitTouchCallout="none",n.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(s.tabIndex=0),s.style=n,s}const Ai=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","transformValues","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function ct(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Ai.has(e)}let po=e=>!ct(e);function Di(e){e&&(po=t=>t.startsWith("on")?!ct(t):e(t))}try{Di(require("@emotion/is-prop-valid").default)}catch{}function Mi(e,t,r){const s={};for(const n in e)n==="values"&&typeof e.values=="object"||(po(n)||r===!0&&ct(n)||!t&&!ct(n)||e.draggable&&n.startsWith("onDrag"))&&(s[n]=e[n]);return s}function Hr(e,t,r){return typeof e=="string"?e:V.transform(t+r*e)}function Vi(e,t,r){const s=Hr(t,e.x,e.width),n=Hr(r,e.y,e.height);return`${s} ${n}`}const Ri={offset:"stroke-dashoffset",array:"stroke-dasharray"},Li={offset:"strokeDashoffset",array:"strokeDasharray"};function Fi(e,t,r=1,s=0,n=!0){e.pathLength=1;const i=n?Ri:Li;e[i.offset]=V.transform(-s);const a=V.transform(t),l=V.transform(r);e[i.array]=`${a} ${l}`}function wr(e,{attrX:t,attrY:r,attrScale:s,originX:n,originY:i,pathLength:a,pathSpacing:l=1,pathOffset:c=0,...d},u,h,f){if(vr(e,d,u,f),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:m,style:g,dimensions:x}=e;m.transform&&(x&&(g.transform=m.transform),delete m.transform),x&&(n!==void 0||i!==void 0||g.transform)&&(g.transformOrigin=Vi(x,n!==void 0?n:.5,i!==void 0?i:.5)),t!==void 0&&(m.x=t),r!==void 0&&(m.y=r),s!==void 0&&(m.scale=s),a!==void 0&&Fi(m,a,l,c,!1)}const go=()=>({...br(),attrs:{}}),jr=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Ii(e,t,r,s){const n=v.useMemo(()=>{const i=go();return wr(i,t,{enableHardwareAcceleration:!1},jr(s),e.transformTemplate),{...i.attrs,style:{...i.style}}},[t]);if(e.style){const i={};mo(i,e.style,e),n.style={...i,...n.style}}return n}function Oi(e=!1){return(r,s,n,{latestValues:i},a)=>{const c=(yr(r)?Ii:Ei)(s,i,a,r),u={...Mi(s,typeof r=="string",e),...c,ref:n},{children:h}=s,f=v.useMemo(()=>J(h)?h.get():h,[h]);return v.createElement(r,{...u,children:f})}}function xo(e,{style:t,vars:r},s,n){Object.assign(e.style,t,n&&n.getProjectionStyles(s));for(const i in r)e.style.setProperty(i,r[i])}const yo=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function vo(e,t,r,s){xo(e,t,void 0,s);for(const n in t.attrs)e.setAttribute(yo.has(n)?n:pr(n),t.attrs[n])}function Cr(e,t){const{style:r}=e,s={};for(const n in r)(J(r[n])||t.style&&J(t.style[n])||lo(n,e))&&(s[n]=r[n]);return s}function bo(e,t){const r=Cr(e,t);for(const s in e)if(J(e[s])||J(t[s])){const n=Ye.indexOf(s)!==-1?"attr"+s.charAt(0).toUpperCase()+s.substring(1):s;r[n]=e[s]}return r}function Sr(e,t,r,s={},n={}){return typeof t=="function"&&(t=t(r!==void 0?r:e.custom,s,n)),typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"&&(t=t(r!==void 0?r:e.custom,s,n)),t}function _i(e){const t=v.useRef(null);return t.current===null&&(t.current=e()),t.current}const dt=e=>Array.isArray(e),Bi=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),zi=e=>dt(e)?e[e.length-1]||0:e;function it(e){const t=J(e)?e.get():e;return Bi(t)?t.toValue():t}function Ui({scrapeMotionValuesFromProps:e,createRenderState:t,onMount:r},s,n,i){const a={latestValues:$i(s,n,i,e),renderState:t()};return r&&(a.mount=l=>r(s,l,a)),a}const wo=e=>(t,r)=>{const s=v.useContext(xt),n=v.useContext(mr),i=()=>Ui(e,t,s,n);return r?i():_i(i)};function $i(e,t,r,s){const n={},i=s(e,{});for(const f in i)n[f]=it(i[f]);let{initial:a,animate:l}=e;const c=bt(e),d=no(e);t&&d&&!c&&e.inherit!==!1&&(a===void 0&&(a=t.initial),l===void 0&&(l=t.animate));let u=r?r.initial===!1:!1;u=u||a===!1;const h=u?l:a;return h&&typeof h!="boolean"&&!vt(h)&&(Array.isArray(h)?h:[h]).forEach(m=>{const g=Sr(e,m);if(!g)return;const{transitionEnd:x,transition:y,...b}=g;for(const p in b){let j=b[p];if(Array.isArray(j)){const w=u?j.length-1:0;j=j[w]}j!==null&&(n[p]=j)}for(const p in x)n[p]=x[p]}),n}const H=e=>e;class Gr{constructor(){this.order=[],this.scheduled=new Set}add(t){if(!this.scheduled.has(t))return this.scheduled.add(t),this.order.push(t),!0}remove(t){const r=this.order.indexOf(t);r!==-1&&(this.order.splice(r,1),this.scheduled.delete(t))}clear(){this.order.length=0,this.scheduled.clear()}}function Wi(e){let t=new Gr,r=new Gr,s=0,n=!1,i=!1;const a=new WeakSet,l={schedule:(c,d=!1,u=!1)=>{const h=u&&n,f=h?t:r;return d&&a.add(c),f.add(c)&&h&&n&&(s=t.order.length),c},cancel:c=>{r.remove(c),a.delete(c)},process:c=>{if(n){i=!0;return}if(n=!0,[t,r]=[r,t],r.clear(),s=t.order.length,s)for(let d=0;d<s;d++){const u=t.order[d];u(c),a.has(u)&&(l.schedule(u),e())}n=!1,i&&(i=!1,l.process(c))}};return l}const rt=["prepare","read","update","preRender","render","postRender"],Hi=40;function Gi(e,t){let r=!1,s=!0;const n={delta:0,timestamp:0,isProcessing:!1},i=rt.reduce((h,f)=>(h[f]=Wi(()=>r=!0),h),{}),a=h=>i[h].process(n),l=()=>{const h=performance.now();r=!1,n.delta=s?1e3/60:Math.max(Math.min(h-n.timestamp,Hi),1),n.timestamp=h,n.isProcessing=!0,rt.forEach(a),n.isProcessing=!1,r&&t&&(s=!1,e(l))},c=()=>{r=!0,s=!0,n.isProcessing||e(l)};return{schedule:rt.reduce((h,f)=>{const m=i[f];return h[f]=(g,x=!1,y=!1)=>(r||c(),m.schedule(g,x,y)),h},{}),cancel:h=>rt.forEach(f=>i[f].cancel(h)),state:n,steps:i}}const{schedule:U,cancel:de,state:X,steps:Pt}=Gi(typeof requestAnimationFrame<"u"?requestAnimationFrame:H,!0),qi={useVisualState:wo({scrapeMotionValuesFromProps:bo,createRenderState:go,onMount:(e,t,{renderState:r,latestValues:s})=>{U.read(()=>{try{r.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{r.dimensions={x:0,y:0,width:0,height:0}}}),U.render(()=>{wr(r,s,{enableHardwareAcceleration:!1},jr(t.tagName),e.transformTemplate),vo(t,r)})}})},Ki={useVisualState:wo({scrapeMotionValuesFromProps:Cr,createRenderState:br})};function Xi(e,{forwardMotionProps:t=!1},r,s){return{...yr(e)?qi:Ki,preloadedFeatures:r,useRender:Oi(t),createVisualElement:s,Component:e}}function ae(e,t,r,s={passive:!0}){return e.addEventListener(t,r,s),()=>e.removeEventListener(t,r)}const jo=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function jt(e,t="page"){return{point:{x:e[t+"X"],y:e[t+"Y"]}}}const Yi=e=>t=>jo(t)&&e(t,jt(t));function le(e,t,r,s){return ae(e,t,Yi(r),s)}const Ji=(e,t)=>r=>t(e(r)),me=(...e)=>e.reduce(Ji);function Co(e){let t=null;return()=>{const r=()=>{t=null};return t===null?(t=e,r):!1}}const qr=Co("dragHorizontal"),Kr=Co("dragVertical");function So(e){let t=!1;if(e==="y")t=Kr();else if(e==="x")t=qr();else{const r=qr(),s=Kr();r&&s?t=()=>{r(),s()}:(r&&r(),s&&s())}return t}function No(){const e=So(!0);return e?(e(),!1):!0}class ye{constructor(t){this.isMounted=!1,this.node=t}update(){}}function Xr(e,t){const r="pointer"+(t?"enter":"leave"),s="onHover"+(t?"Start":"End"),n=(i,a)=>{if(i.pointerType==="touch"||No())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t),l[s]&&U.update(()=>l[s](i,a))};return le(e.current,r,n,{passive:!e.getProps()[s]})}class Zi extends ye{mount(){this.unmount=me(Xr(this.node,!0),Xr(this.node,!1))}unmount(){}}class Qi extends ye{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=me(ae(this.node.current,"focus",()=>this.onFocus()),ae(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const To=(e,t)=>t?e===t?!0:To(e,t.parentElement):!1;function kt(e,t){if(!t)return;const r=new PointerEvent("pointer"+e);t(r,jt(r))}class ea extends ye{constructor(){super(...arguments),this.removeStartListeners=H,this.removeEndListeners=H,this.removeAccessibleListeners=H,this.startPointerPress=(t,r)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),i=le(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:u,globalTapTarget:h}=this.node.getProps();U.update(()=>{!h&&!To(this.node.current,l.target)?u&&u(l,c):d&&d(l,c)})},{passive:!(s.onTap||s.onPointerUp)}),a=le(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=me(i,a),this.startPress(t,r)},this.startAccessiblePress=()=>{const t=i=>{if(i.key!=="Enter"||this.isPressing)return;const a=l=>{l.key!=="Enter"||!this.checkPressEnd()||kt("up",(c,d)=>{const{onTap:u}=this.node.getProps();u&&U.update(()=>u(c,d))})};this.removeEndListeners(),this.removeEndListeners=ae(this.node.current,"keyup",a),kt("down",(l,c)=>{this.startPress(l,c)})},r=ae(this.node.current,"keydown",t),s=()=>{this.isPressing&&kt("cancel",(i,a)=>this.cancelPress(i,a))},n=ae(this.node.current,"blur",s);this.removeAccessibleListeners=me(r,n)}}startPress(t,r){this.isPressing=!0;const{onTapStart:s,whileTap:n}=this.node.getProps();n&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&U.update(()=>s(t,r))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!No()}cancelPress(t,r){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&U.update(()=>s(t,r))}mount(){const t=this.node.getProps(),r=le(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=ae(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=me(r,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const Gt=new WeakMap,Et=new WeakMap,ta=e=>{const t=Gt.get(e.target);t&&t(e)},ra=e=>{e.forEach(ta)};function sa({root:e,...t}){const r=e||document;Et.has(r)||Et.set(r,{});const s=Et.get(r),n=JSON.stringify(t);return s[n]||(s[n]=new IntersectionObserver(ra,{root:e,...t})),s[n]}function oa(e,t,r){const s=sa(t);return Gt.set(e,r),s.observe(e),()=>{Gt.delete(e),s.unobserve(e)}}const na={some:0,all:1};class ia extends ye{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:r,margin:s,amount:n="some",once:i}=t,a={root:r?r.current:void 0,rootMargin:s,threshold:typeof n=="number"?n:na[n]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,i&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:u,onViewportLeave:h}=this.node.getProps(),f=d?u:h;f&&f(c)};return oa(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:r}=this.node;["amount","margin","root"].some(aa(t,r))&&this.startObserver()}unmount(){}}function aa({viewport:e={}},{viewport:t={}}={}){return r=>e[r]!==t[r]}const la={inView:{Feature:ia},tap:{Feature:ea},focus:{Feature:Qi},hover:{Feature:Zi}};function Po(e,t){if(!Array.isArray(t))return!1;const r=t.length;if(r!==e.length)return!1;for(let s=0;s<r;s++)if(t[s]!==e[s])return!1;return!0}function ca(e){const t={};return e.values.forEach((r,s)=>t[s]=r.get()),t}function da(e){const t={};return e.values.forEach((r,s)=>t[s]=r.getVelocity()),t}function Ct(e,t,r){const s=e.getProps();return Sr(s,t,r!==void 0?r:s.custom,ca(e),da(e))}let ua=H,Nr=H;const pe=e=>e*1e3,ce=e=>e/1e3,ha={current:!1},ko=e=>Array.isArray(e)&&typeof e[0]=="number";function Eo(e){return!!(!e||typeof e=="string"&&Ao[e]||ko(e)||Array.isArray(e)&&e.every(Eo))}const Be=([e,t,r,s])=>`cubic-bezier(${e}, ${t}, ${r}, ${s})`,Ao={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Be([0,.65,.55,1]),circOut:Be([.55,0,1,.45]),backIn:Be([.31,.01,.66,-.59]),backOut:Be([.33,1.53,.69,.99])};function Do(e){if(e)return ko(e)?Be(e):Array.isArray(e)?e.map(Do):Ao[e]}function fa(e,t,r,{delay:s=0,duration:n,repeat:i=0,repeatType:a="loop",ease:l,times:c}={}){const d={[t]:r};c&&(d.offset=c);const u=Do(l);return Array.isArray(u)&&(d.easing=u),e.animate(d,{delay:s,duration:n,easing:Array.isArray(u)?"linear":u,fill:"both",iterations:i+1,direction:a==="reverse"?"alternate":"normal"})}function ma(e,{repeat:t,repeatType:r="loop"}){const s=t&&r!=="loop"&&t%2===1?0:e.length-1;return e[s]}const Mo=(e,t,r)=>(((1-3*r+3*t)*e+(3*r-6*t))*e+3*t)*e,pa=1e-7,ga=12;function xa(e,t,r,s,n){let i,a,l=0;do a=t+(r-t)/2,i=Mo(a,s,n)-e,i>0?r=a:t=a;while(Math.abs(i)>pa&&++l<ga);return a}function Qe(e,t,r,s){if(e===t&&r===s)return H;const n=i=>xa(i,0,1,e,r);return i=>i===0||i===1?i:Mo(n(i),t,s)}const ya=Qe(.42,0,1,1),va=Qe(0,0,.58,1),Vo=Qe(.42,0,.58,1),ba=e=>Array.isArray(e)&&typeof e[0]!="number",Ro=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,Lo=e=>t=>1-e(1-t),Tr=e=>1-Math.sin(Math.acos(e)),Fo=Lo(Tr),wa=Ro(Tr),Io=Qe(.33,1.53,.69,.99),Pr=Lo(Io),ja=Ro(Pr),Ca=e=>(e*=2)<1?.5*Pr(e):.5*(2-Math.pow(2,-10*(e-1))),Sa={linear:H,easeIn:ya,easeInOut:Vo,easeOut:va,circIn:Tr,circInOut:wa,circOut:Fo,backIn:Pr,backInOut:ja,backOut:Io,anticipate:Ca},Yr=e=>{if(Array.isArray(e)){Nr(e.length===4);const[t,r,s,n]=e;return Qe(t,r,s,n)}else if(typeof e=="string")return Sa[e];return e},kr=(e,t)=>r=>!!(Je(r)&&Si.test(r)&&r.startsWith(e)||t&&Object.prototype.hasOwnProperty.call(r,t)),Oo=(e,t,r)=>s=>{if(!Je(s))return s;const[n,i,a,l]=s.match(wt);return{[e]:parseFloat(n),[t]:parseFloat(i),[r]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},Na=e=>ge(0,255,e),At={...Pe,transform:e=>Math.round(Na(e))},Ce={test:kr("rgb","red"),parse:Oo("red","green","blue"),transform:({red:e,green:t,blue:r,alpha:s=1})=>"rgba("+At.transform(e)+", "+At.transform(t)+", "+At.transform(r)+", "+Ue(ze.transform(s))+")"};function Ta(e){let t="",r="",s="",n="";return e.length>5?(t=e.substring(1,3),r=e.substring(3,5),s=e.substring(5,7),n=e.substring(7,9)):(t=e.substring(1,2),r=e.substring(2,3),s=e.substring(3,4),n=e.substring(4,5),t+=t,r+=r,s+=s,n+=n),{red:parseInt(t,16),green:parseInt(r,16),blue:parseInt(s,16),alpha:n?parseInt(n,16)/255:1}}const qt={test:kr("#"),parse:Ta,transform:Ce.transform},Ae={test:kr("hsl","hue"),parse:Oo("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:r,alpha:s=1})=>"hsla("+Math.round(e)+", "+ie.transform(Ue(t))+", "+ie.transform(Ue(r))+", "+Ue(ze.transform(s))+")"},Y={test:e=>Ce.test(e)||qt.test(e)||Ae.test(e),parse:e=>Ce.test(e)?Ce.parse(e):Ae.test(e)?Ae.parse(e):qt.parse(e),transform:e=>Je(e)?e:e.hasOwnProperty("red")?Ce.transform(e):Ae.transform(e)},W=(e,t,r)=>-r*e+r*t+e;function Dt(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<1/2?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Pa({hue:e,saturation:t,lightness:r,alpha:s}){e/=360,t/=100,r/=100;let n=0,i=0,a=0;if(!t)n=i=a=r;else{const l=r<.5?r*(1+t):r+t-r*t,c=2*r-l;n=Dt(c,l,e+1/3),i=Dt(c,l,e),a=Dt(c,l,e-1/3)}return{red:Math.round(n*255),green:Math.round(i*255),blue:Math.round(a*255),alpha:s}}const Mt=(e,t,r)=>{const s=e*e;return Math.sqrt(Math.max(0,r*(t*t-s)+s))},ka=[qt,Ce,Ae],Ea=e=>ka.find(t=>t.test(e));function Jr(e){const t=Ea(e);let r=t.parse(e);return t===Ae&&(r=Pa(r)),r}const _o=(e,t)=>{const r=Jr(e),s=Jr(t),n={...r};return i=>(n.red=Mt(r.red,s.red,i),n.green=Mt(r.green,s.green,i),n.blue=Mt(r.blue,s.blue,i),n.alpha=W(r.alpha,s.alpha,i),Ce.transform(n))};function Aa(e){var t,r;return isNaN(e)&&Je(e)&&(((t=e.match(wt))===null||t===void 0?void 0:t.length)||0)+(((r=e.match(ho))===null||r===void 0?void 0:r.length)||0)>0}const Bo={regex:ji,countKey:"Vars",token:"${v}",parse:H},zo={regex:ho,countKey:"Colors",token:"${c}",parse:Y.parse},Uo={regex:wt,countKey:"Numbers",token:"${n}",parse:Pe.parse};function Vt(e,{regex:t,countKey:r,token:s,parse:n}){const i=e.tokenised.match(t);i&&(e["num"+r]=i.length,e.tokenised=e.tokenised.replace(t,s),e.values.push(...i.map(n)))}function ut(e){const t=e.toString(),r={value:t,tokenised:t,values:[],numVars:0,numColors:0,numNumbers:0};return r.value.includes("var(--")&&Vt(r,Bo),Vt(r,zo),Vt(r,Uo),r}function $o(e){return ut(e).values}function Wo(e){const{values:t,numColors:r,numVars:s,tokenised:n}=ut(e),i=t.length;return a=>{let l=n;for(let c=0;c<i;c++)c<s?l=l.replace(Bo.token,a[c]):c<s+r?l=l.replace(zo.token,Y.transform(a[c])):l=l.replace(Uo.token,Ue(a[c]));return l}}const Da=e=>typeof e=="number"?0:e;function Ma(e){const t=$o(e);return Wo(e)(t.map(Da))}const xe={test:Aa,parse:$o,createTransformer:Wo,getAnimatableNone:Ma},Ho=(e,t)=>r=>`${r>0?t:e}`;function Go(e,t){return typeof e=="number"?r=>W(e,t,r):Y.test(e)?_o(e,t):e.startsWith("var(")?Ho(e,t):Ko(e,t)}const qo=(e,t)=>{const r=[...e],s=r.length,n=e.map((i,a)=>Go(i,t[a]));return i=>{for(let a=0;a<s;a++)r[a]=n[a](i);return r}},Va=(e,t)=>{const r={...e,...t},s={};for(const n in r)e[n]!==void 0&&t[n]!==void 0&&(s[n]=Go(e[n],t[n]));return n=>{for(const i in s)r[i]=s[i](n);return r}},Ko=(e,t)=>{const r=xe.createTransformer(t),s=ut(e),n=ut(t);return s.numVars===n.numVars&&s.numColors===n.numColors&&s.numNumbers>=n.numNumbers?me(qo(s.values,n.values),r):Ho(e,t)},qe=(e,t,r)=>{const s=t-e;return s===0?1:(r-e)/s},Zr=(e,t)=>r=>W(e,t,r);function Ra(e){return typeof e=="number"?Zr:typeof e=="string"?Y.test(e)?_o:Ko:Array.isArray(e)?qo:typeof e=="object"?Va:Zr}function La(e,t,r){const s=[],n=r||Ra(e[0]),i=e.length-1;for(let a=0;a<i;a++){let l=n(e[a],e[a+1]);if(t){const c=Array.isArray(t)?t[a]||H:t;l=me(c,l)}s.push(l)}return s}function Xo(e,t,{clamp:r=!0,ease:s,mixer:n}={}){const i=e.length;if(Nr(i===t.length),i===1)return()=>t[0];e[0]>e[i-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=La(t,s,n),l=a.length,c=d=>{let u=0;if(l>1)for(;u<e.length-2&&!(d<e[u+1]);u++);const h=qe(e[u],e[u+1],d);return a[u](h)};return r?d=>c(ge(e[0],e[i-1],d)):c}function Fa(e,t){const r=e[e.length-1];for(let s=1;s<=t;s++){const n=qe(0,t,s);e.push(W(r,1,n))}}function Ia(e){const t=[0];return Fa(t,e.length-1),t}function Oa(e,t){return e.map(r=>r*t)}function _a(e,t){return e.map(()=>t||Vo).splice(0,e.length-1)}function ht({duration:e=300,keyframes:t,times:r,ease:s="easeInOut"}){const n=ba(s)?s.map(Yr):Yr(s),i={done:!1,value:t[0]},a=Oa(r&&r.length===t.length?r:Ia(t),e),l=Xo(a,t,{ease:Array.isArray(n)?n:_a(t,n)});return{calculatedDuration:e,next:c=>(i.value=l(c),i.done=c>=e,i)}}function Yo(e,t){return t?e*(1e3/t):0}const Ba=5;function Jo(e,t,r){const s=Math.max(t-Ba,0);return Yo(r-e(s),t-s)}const Rt=.001,za=.01,Qr=10,Ua=.05,$a=1;function Wa({duration:e=800,bounce:t=.25,velocity:r=0,mass:s=1}){let n,i;ua(e<=pe(Qr));let a=1-t;a=ge(Ua,$a,a),e=ge(za,Qr,ce(e)),a<1?(n=d=>{const u=d*a,h=u*e,f=u-r,m=Kt(d,a),g=Math.exp(-h);return Rt-f/m*g},i=d=>{const h=d*a*e,f=h*r+r,m=Math.pow(a,2)*Math.pow(d,2)*e,g=Math.exp(-h),x=Kt(Math.pow(d,2),a);return(-n(d)+Rt>0?-1:1)*((f-m)*g)/x}):(n=d=>{const u=Math.exp(-d*e),h=(d-r)*e+1;return-Rt+u*h},i=d=>{const u=Math.exp(-d*e),h=(r-d)*(e*e);return u*h});const l=5/e,c=Ga(n,i,l);if(e=pe(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:e}}}const Ha=12;function Ga(e,t,r){let s=r;for(let n=1;n<Ha;n++)s=s-e(s)/t(s);return s}function Kt(e,t){return e*Math.sqrt(1-t*t)}const qa=["duration","bounce"],Ka=["stiffness","damping","mass"];function es(e,t){return t.some(r=>e[r]!==void 0)}function Xa(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!es(e,Ka)&&es(e,qa)){const r=Wa(e);t={...t,...r,mass:1},t.isResolvedFromDuration=!0}return t}function Zo({keyframes:e,restDelta:t,restSpeed:r,...s}){const n=e[0],i=e[e.length-1],a={done:!1,value:n},{stiffness:l,damping:c,mass:d,duration:u,velocity:h,isResolvedFromDuration:f}=Xa({...s,velocity:-ce(s.velocity||0)}),m=h||0,g=c/(2*Math.sqrt(l*d)),x=i-n,y=ce(Math.sqrt(l/d)),b=Math.abs(x)<5;r||(r=b?.01:2),t||(t=b?.005:.5);let p;if(g<1){const j=Kt(y,g);p=w=>{const C=Math.exp(-g*y*w);return i-C*((m+g*y*x)/j*Math.sin(j*w)+x*Math.cos(j*w))}}else if(g===1)p=j=>i-Math.exp(-y*j)*(x+(m+y*x)*j);else{const j=y*Math.sqrt(g*g-1);p=w=>{const C=Math.exp(-g*y*w),P=Math.min(j*w,300);return i-C*((m+g*y*x)*Math.sinh(P)+j*x*Math.cosh(P))/j}}return{calculatedDuration:f&&u||null,next:j=>{const w=p(j);if(f)a.done=j>=u;else{let C=m;j!==0&&(g<1?C=Jo(p,j,w):C=0);const P=Math.abs(C)<=r,T=Math.abs(i-w)<=t;a.done=P&&T}return a.value=a.done?i:w,a}}}function ts({keyframes:e,velocity:t=0,power:r=.8,timeConstant:s=325,bounceDamping:n=10,bounceStiffness:i=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:u}){const h=e[0],f={done:!1,value:h},m=N=>l!==void 0&&N<l||c!==void 0&&N>c,g=N=>l===void 0?c:c===void 0||Math.abs(l-N)<Math.abs(c-N)?l:c;let x=r*t;const y=h+x,b=a===void 0?y:a(y);b!==y&&(x=b-h);const p=N=>-x*Math.exp(-N/s),j=N=>b+p(N),w=N=>{const R=p(N),E=j(N);f.done=Math.abs(R)<=d,f.value=f.done?b:E};let C,P;const T=N=>{m(f.value)&&(C=N,P=Zo({keyframes:[f.value,g(f.value)],velocity:Jo(j,N,f.value),damping:n,stiffness:i,restDelta:d,restSpeed:u}))};return T(0),{calculatedDuration:null,next:N=>{let R=!1;return!P&&C===void 0&&(R=!0,w(N),T(N)),C!==void 0&&N>C?P.next(N-C):(!R&&w(N),f)}}}const Ya=e=>{const t=({timestamp:r})=>e(r);return{start:()=>U.update(t,!0),stop:()=>de(t),now:()=>X.isProcessing?X.timestamp:performance.now()}},rs=2e4;function ss(e){let t=0;const r=50;let s=e.next(t);for(;!s.done&&t<rs;)t+=r,s=e.next(t);return t>=rs?1/0:t}const Ja={decay:ts,inertia:ts,tween:ht,keyframes:ht,spring:Zo};function ft({autoplay:e=!0,delay:t=0,driver:r=Ya,keyframes:s,type:n="keyframes",repeat:i=0,repeatDelay:a=0,repeatType:l="loop",onPlay:c,onStop:d,onComplete:u,onUpdate:h,...f}){let m=1,g=!1,x,y;const b=()=>{y=new Promise(M=>{x=M})};b();let p;const j=Ja[n]||ht;let w;j!==ht&&typeof s[0]!="number"&&(w=Xo([0,100],s,{clamp:!1}),s=[0,100]);const C=j({...f,keyframes:s});let P;l==="mirror"&&(P=j({...f,keyframes:[...s].reverse(),velocity:-(f.velocity||0)}));let T="idle",N=null,R=null,E=null;C.calculatedDuration===null&&i&&(C.calculatedDuration=ss(C));const{calculatedDuration:I}=C;let L=1/0,B=1/0;I!==null&&(L=I+a,B=L*(i+1)-a);let S=0;const F=M=>{if(R===null)return;m>0&&(R=Math.min(R,M)),m<0&&(R=Math.min(M-B/m,R)),N!==null?S=N:S=Math.round(M-R)*m;const K=S-t*(m>=0?1:-1),oe=m>=0?K<0:K>B;S=Math.max(K,0),T==="finished"&&N===null&&(S=B);let Z=S,A=C;if(i){const St=Math.min(S,B)/L;let et=Math.floor(St),ve=St%1;!ve&&St>=1&&(ve=1),ve===1&&et--,et=Math.min(et,i+1),!!(et%2)&&(l==="reverse"?(ve=1-ve,a&&(ve-=a/L)):l==="mirror"&&(A=P)),Z=ge(0,1,ve)*L}const $=oe?{done:!1,value:s[0]}:A.next(Z);w&&($.value=w($.value));let{done:ke}=$;!oe&&I!==null&&(ke=m>=0?S>=B:S<=0);const ne=N===null&&(T==="finished"||T==="running"&&ke);return h&&h($.value),ne&&D(),$},k=()=>{p&&p.stop(),p=void 0},_=()=>{T="idle",k(),x(),b(),R=E=null},D=()=>{T="finished",u&&u(),k(),x()},z=()=>{if(g)return;p||(p=r(F));const M=p.now();c&&c(),N!==null?R=M-N:(!R||T==="finished")&&(R=M),T==="finished"&&b(),E=R,N=null,T="running",p.start()};e&&z();const G={then(M,K){return y.then(M,K)},get time(){return ce(S)},set time(M){M=pe(M),S=M,N!==null||!p||m===0?N=M:R=p.now()-M/m},get duration(){const M=C.calculatedDuration===null?ss(C):C.calculatedDuration;return ce(M)},get speed(){return m},set speed(M){M===m||!p||(m=M,G.time=ce(S))},get state(){return T},play:z,pause:()=>{T="paused",N=S},stop:()=>{g=!0,T!=="idle"&&(T="idle",d&&d(),_())},cancel:()=>{E!==null&&F(E),_()},complete:()=>{T="finished"},sample:M=>(R=0,F(M))};return G}function Za(e){let t;return()=>(t===void 0&&(t=e()),t)}const Qa=Za(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),el=new Set(["opacity","clipPath","filter","transform","backgroundColor"]),st=10,tl=2e4,rl=(e,t)=>t.type==="spring"||e==="backgroundColor"||!Eo(t.ease);function sl(e,t,{onUpdate:r,onComplete:s,...n}){if(!(Qa()&&el.has(t)&&!n.repeatDelay&&n.repeatType!=="mirror"&&n.damping!==0&&n.type!=="inertia"))return!1;let a=!1,l,c,d=!1;const u=()=>{c=new Promise(j=>{l=j})};u();let{keyframes:h,duration:f=300,ease:m,times:g}=n;if(rl(t,n)){const j=ft({...n,repeat:0,delay:0});let w={done:!1,value:h[0]};const C=[];let P=0;for(;!w.done&&P<tl;)w=j.sample(P),C.push(w.value),P+=st;g=void 0,h=C,f=P-st,m="linear"}const x=fa(e.owner.current,t,h,{...n,duration:f,ease:m,times:g}),y=()=>{d=!1,x.cancel()},b=()=>{d=!0,U.update(y),l(),u()};return x.onfinish=()=>{d||(e.set(ma(h,n)),s&&s(),b())},{then(j,w){return c.then(j,w)},attachTimeline(j){return x.timeline=j,x.onfinish=null,H},get time(){return ce(x.currentTime||0)},set time(j){x.currentTime=pe(j)},get speed(){return x.playbackRate},set speed(j){x.playbackRate=j},get duration(){return ce(f)},play:()=>{a||(x.play(),de(y))},pause:()=>x.pause(),stop:()=>{if(a=!0,x.playState==="idle")return;const{currentTime:j}=x;if(j){const w=ft({...n,autoplay:!1});e.setWithVelocity(w.sample(j-st).value,w.sample(j).value,st)}b()},complete:()=>{d||x.finish()},cancel:b}}function ol({keyframes:e,delay:t,onUpdate:r,onComplete:s}){const n=()=>(r&&r(e[e.length-1]),s&&s(),{time:0,speed:1,duration:0,play:H,pause:H,stop:H,then:i=>(i(),Promise.resolve()),cancel:H,complete:H});return t?ft({keyframes:[0,1],duration:0,delay:t,onComplete:n}):n()}const nl={type:"spring",stiffness:500,damping:25,restSpeed:10},il=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),al={type:"keyframes",duration:.8},ll={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},cl=(e,{keyframes:t})=>t.length>2?al:Te.has(e)?e.startsWith("scale")?il(t[1]):nl:ll,Xt=(e,t)=>e==="zIndex"?!1:!!(typeof t=="number"||Array.isArray(t)||typeof t=="string"&&(xe.test(t)||t==="0")&&!t.startsWith("url(")),dl=new Set(["brightness","contrast","saturate","opacity"]);function ul(e){const[t,r]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=r.match(wt)||[];if(!s)return e;const n=r.replace(s,"");let i=dl.has(t)?1:0;return s!==r&&(i*=100),t+"("+i+n+")"}const hl=/([a-z-]*)\(.*?\)/g,Yt={...xe,getAnimatableNone:e=>{const t=e.match(hl);return t?t.map(ul).join(" "):e}},fl={...fo,color:Y,backgroundColor:Y,outlineColor:Y,fill:Y,stroke:Y,borderColor:Y,borderTopColor:Y,borderRightColor:Y,borderBottomColor:Y,borderLeftColor:Y,filter:Yt,WebkitFilter:Yt},Er=e=>fl[e];function Qo(e,t){let r=Er(e);return r!==Yt&&(r=xe),r.getAnimatableNone?r.getAnimatableNone(t):void 0}const en=e=>/^0[^.\s]+$/.test(e);function ml(e){if(typeof e=="number")return e===0;if(e!==null)return e==="none"||e==="0"||en(e)}function pl(e,t,r,s){const n=Xt(t,r);let i;Array.isArray(r)?i=[...r]:i=[null,r];const a=s.from!==void 0?s.from:e.get();let l;const c=[];for(let d=0;d<i.length;d++)i[d]===null&&(i[d]=d===0?a:i[d-1]),ml(i[d])&&c.push(d),typeof i[d]=="string"&&i[d]!=="none"&&i[d]!=="0"&&(l=i[d]);if(n&&c.length&&l)for(let d=0;d<c.length;d++){const u=c[d];i[u]=Qo(t,l)}return i}function gl({when:e,delay:t,delayChildren:r,staggerChildren:s,staggerDirection:n,repeat:i,repeatType:a,repeatDelay:l,from:c,elapsed:d,...u}){return!!Object.keys(u).length}function Ar(e,t){return e[t]||e.default||e}const xl={skipAnimations:!1},Dr=(e,t,r,s={})=>n=>{const i=Ar(s,e)||{},a=i.delay||s.delay||0;let{elapsed:l=0}=s;l=l-pe(a);const c=pl(t,e,r,i),d=c[0],u=c[c.length-1],h=Xt(e,d),f=Xt(e,u);let m={keyframes:c,velocity:t.getVelocity(),ease:"easeOut",...i,delay:-l,onUpdate:g=>{t.set(g),i.onUpdate&&i.onUpdate(g)},onComplete:()=>{n(),i.onComplete&&i.onComplete()}};if(gl(i)||(m={...m,...cl(e,m)}),m.duration&&(m.duration=pe(m.duration)),m.repeatDelay&&(m.repeatDelay=pe(m.repeatDelay)),!h||!f||ha.current||i.type===!1||xl.skipAnimations)return ol(m);if(!s.isHandoff&&t.owner&&t.owner.current instanceof HTMLElement&&!t.owner.getProps().onUpdate){const g=sl(t,e,m);if(g)return g}return ft(m)};function mt(e){return!!(J(e)&&e.add)}const tn=e=>/^\-?\d*\.?\d+$/.test(e);function Mr(e,t){e.indexOf(t)===-1&&e.push(t)}function Vr(e,t){const r=e.indexOf(t);r>-1&&e.splice(r,1)}class Rr{constructor(){this.subscriptions=[]}add(t){return Mr(this.subscriptions,t),()=>Vr(this.subscriptions,t)}notify(t,r,s){const n=this.subscriptions.length;if(n)if(n===1)this.subscriptions[0](t,r,s);else for(let i=0;i<n;i++){const a=this.subscriptions[i];a&&a(t,r,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const yl=e=>!isNaN(parseFloat(e));class vl{constructor(t,r={}){this.version="10.18.0",this.timeDelta=0,this.lastUpdated=0,this.canTrackVelocity=!1,this.events={},this.updateAndNotify=(s,n=!0)=>{this.prev=this.current,this.current=s;const{delta:i,timestamp:a}=X;this.lastUpdated!==a&&(this.timeDelta=i,this.lastUpdated=a,U.postRender(this.scheduleVelocityCheck)),this.prev!==this.current&&this.events.change&&this.events.change.notify(this.current),this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()),n&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.scheduleVelocityCheck=()=>U.postRender(this.velocityCheck),this.velocityCheck=({timestamp:s})=>{s!==this.lastUpdated&&(this.prev=this.current,this.events.velocityChange&&this.events.velocityChange.notify(this.getVelocity()))},this.hasAnimated=!1,this.prev=this.current=t,this.canTrackVelocity=yl(this.current),this.owner=r.owner}onChange(t){return this.on("change",t)}on(t,r){this.events[t]||(this.events[t]=new Rr);const s=this.events[t].add(r);return t==="change"?()=>{s(),U.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,r){this.passiveEffect=t,this.stopPassiveEffect=r}set(t,r=!0){!r||!this.passiveEffect?this.updateAndNotify(t,r):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,r,s){this.set(r),this.prev=t,this.timeDelta=s}jump(t){this.updateAndNotify(t),this.prev=t,this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?Yo(parseFloat(this.current)-parseFloat(this.prev),this.timeDelta):0}start(t){return this.stop(),new Promise(r=>{this.hasAnimated=!0,this.animation=t(r),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function Re(e,t){return new vl(e,t)}const rn=e=>t=>t.test(e),bl={test:e=>e==="auto",parse:e=>e},sn=[Pe,V,ie,he,Ti,Ni,bl],Ie=e=>sn.find(rn(e)),wl=[...sn,Y,xe],jl=e=>wl.find(rn(e));function Cl(e,t,r){e.hasValue(t)?e.getValue(t).set(r):e.addValue(t,Re(r))}function Sl(e,t){const r=Ct(e,t);let{transitionEnd:s={},transition:n={},...i}=r?e.makeTargetAnimatable(r,!1):{};i={...i,...s};for(const a in i){const l=zi(i[a]);Cl(e,a,l)}}function Nl(e,t,r){var s,n;const i=Object.keys(t).filter(l=>!e.hasValue(l)),a=i.length;if(a)for(let l=0;l<a;l++){const c=i[l],d=t[c];let u=null;Array.isArray(d)&&(u=d[0]),u===null&&(u=(n=(s=r[c])!==null&&s!==void 0?s:e.readValue(c))!==null&&n!==void 0?n:t[c]),u!=null&&(typeof u=="string"&&(tn(u)||en(u))?u=parseFloat(u):!jl(u)&&xe.test(d)&&(u=Qo(c,d)),e.addValue(c,Re(u,{owner:e})),r[c]===void 0&&(r[c]=u),u!==null&&e.setBaseTarget(c,u))}}function Tl(e,t){return t?(t[e]||t.default||t).from:void 0}function Pl(e,t,r){const s={};for(const n in e){const i=Tl(n,t);if(i!==void 0)s[n]=i;else{const a=r.getValue(n);a&&(s[n]=a.get())}}return s}function kl({protectedKeys:e,needsAnimating:t},r){const s=e.hasOwnProperty(r)&&t[r]!==!0;return t[r]=!1,s}function El(e,t){const r=e.get();if(Array.isArray(t)){for(let s=0;s<t.length;s++)if(t[s]!==r)return!0}else return r!==t}function on(e,t,{delay:r=0,transitionOverride:s,type:n}={}){let{transition:i=e.getDefaultTransition(),transitionEnd:a,...l}=e.makeTargetAnimatable(t);const c=e.getValue("willChange");s&&(i=s);const d=[],u=n&&e.animationState&&e.animationState.getState()[n];for(const h in l){const f=e.getValue(h),m=l[h];if(!f||m===void 0||u&&kl(u,h))continue;const g={delay:r,elapsed:0,...Ar(i||{},h)};if(window.HandoffAppearAnimations){const b=e.getProps()[oo];if(b){const p=window.HandoffAppearAnimations(b,h,f,U);p!==null&&(g.elapsed=p,g.isHandoff=!0)}}let x=!g.isHandoff&&!El(f,m);if(g.type==="spring"&&(f.getVelocity()||g.velocity)&&(x=!1),f.animation&&(x=!1),x)continue;f.start(Dr(h,f,m,e.shouldReduceMotion&&Te.has(h)?{type:!1}:g));const y=f.animation;mt(c)&&(c.add(h),y.then(()=>c.remove(h))),d.push(y)}return a&&Promise.all(d).then(()=>{a&&Sl(e,a)}),d}function Jt(e,t,r={}){const s=Ct(e,t,r.custom);let{transition:n=e.getDefaultTransition()||{}}=s||{};r.transitionOverride&&(n=r.transitionOverride);const i=s?()=>Promise.all(on(e,s,r)):()=>Promise.resolve(),a=e.variantChildren&&e.variantChildren.size?(c=0)=>{const{delayChildren:d=0,staggerChildren:u,staggerDirection:h}=n;return Al(e,t,d+c,u,h,r)}:()=>Promise.resolve(),{when:l}=n;if(l){const[c,d]=l==="beforeChildren"?[i,a]:[a,i];return c().then(()=>d())}else return Promise.all([i(),a(r.delay)])}function Al(e,t,r=0,s=0,n=1,i){const a=[],l=(e.variantChildren.size-1)*s,c=n===1?(d=0)=>d*s:(d=0)=>l-d*s;return Array.from(e.variantChildren).sort(Dl).forEach((d,u)=>{d.notify("AnimationStart",t),a.push(Jt(d,t,{...i,delay:r+c(u)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(a)}function Dl(e,t){return e.sortNodePosition(t)}function Ml(e,t,r={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const n=t.map(i=>Jt(e,i,r));s=Promise.all(n)}else if(typeof t=="string")s=Jt(e,t,r);else{const n=typeof t=="function"?Ct(e,t,r.custom):t;s=Promise.all(on(e,n,r))}return s.then(()=>e.notify("AnimationComplete",t))}const Vl=[...gr].reverse(),Rl=gr.length;function Ll(e){return t=>Promise.all(t.map(({animation:r,options:s})=>Ml(e,r,s)))}function Fl(e){let t=Ll(e);const r=Ol();let s=!0;const n=(c,d)=>{const u=Ct(e,d);if(u){const{transition:h,transitionEnd:f,...m}=u;c={...c,...m,...f}}return c};function i(c){t=c(e)}function a(c,d){const u=e.getProps(),h=e.getVariantContext(!0)||{},f=[],m=new Set;let g={},x=1/0;for(let b=0;b<Rl;b++){const p=Vl[b],j=r[p],w=u[p]!==void 0?u[p]:h[p],C=He(w),P=p===d?j.isActive:null;P===!1&&(x=b);let T=w===h[p]&&w!==u[p]&&C;if(T&&s&&e.manuallyAnimateOnMount&&(T=!1),j.protectedKeys={...g},!j.isActive&&P===null||!w&&!j.prevProp||vt(w)||typeof w=="boolean")continue;let R=Il(j.prevProp,w)||p===d&&j.isActive&&!T&&C||b>x&&C,E=!1;const I=Array.isArray(w)?w:[w];let L=I.reduce(n,{});P===!1&&(L={});const{prevResolvedValues:B={}}=j,S={...B,...L},F=k=>{R=!0,m.has(k)&&(E=!0,m.delete(k)),j.needsAnimating[k]=!0};for(const k in S){const _=L[k],D=B[k];if(g.hasOwnProperty(k))continue;let z=!1;dt(_)&&dt(D)?z=!Po(_,D):z=_!==D,z?_!==void 0?F(k):m.add(k):_!==void 0&&m.has(k)?F(k):j.protectedKeys[k]=!0}j.prevProp=w,j.prevResolvedValues=L,j.isActive&&(g={...g,...L}),s&&e.blockInitialAnimation&&(R=!1),R&&(!T||E)&&f.push(...I.map(k=>({animation:k,options:{type:p,...c}})))}if(m.size){const b={};m.forEach(p=>{const j=e.getBaseTarget(p);j!==void 0&&(b[p]=j)}),f.push({animation:b})}let y=!!f.length;return s&&(u.initial===!1||u.initial===u.animate)&&!e.manuallyAnimateOnMount&&(y=!1),s=!1,y?t(f):Promise.resolve()}function l(c,d,u){var h;if(r[c].isActive===d)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(m=>{var g;return(g=m.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),r[c].isActive=d;const f=a(u,c);for(const m in r)r[m].protectedKeys={};return f}return{animateChanges:a,setActive:l,setAnimateFunction:i,getState:()=>r}}function Il(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!Po(t,e):!1}function be(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function Ol(){return{animate:be(!0),whileInView:be(),whileHover:be(),whileTap:be(),whileDrag:be(),whileFocus:be(),exit:be()}}class _l extends ye{constructor(t){super(t),t.animationState||(t.animationState=Fl(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();this.unmount(),vt(t)&&(this.unmount=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:r}=this.node.prevProps||{};t!==r&&this.updateAnimationControlsSubscription()}unmount(){}}let Bl=0;class zl extends ye{constructor(){super(...arguments),this.id=Bl++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:r,custom:s}=this.node.presenceContext,{isPresent:n}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===n)return;const i=this.node.animationState.setActive("exit",!t,{custom:s??this.node.getProps().custom});r&&!t&&i.then(()=>r(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Ul={animation:{Feature:_l},exit:{Feature:zl}},os=(e,t)=>Math.abs(e-t);function $l(e,t){const r=os(e.x,t.x),s=os(e.y,t.y);return Math.sqrt(r**2+s**2)}class nn{constructor(t,r,{transformPagePoint:s,contextWindow:n,dragSnapToOrigin:i=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const h=Ft(this.lastMoveEventInfo,this.history),f=this.startEvent!==null,m=$l(h.offset,{x:0,y:0})>=3;if(!f&&!m)return;const{point:g}=h,{timestamp:x}=X;this.history.push({...g,timestamp:x});const{onStart:y,onMove:b}=this.handlers;f||(y&&y(this.lastMoveEvent,h),this.startEvent=this.lastMoveEvent),b&&b(this.lastMoveEvent,h)},this.handlePointerMove=(h,f)=>{this.lastMoveEvent=h,this.lastMoveEventInfo=Lt(f,this.transformPagePoint),U.update(this.updatePoint,!0)},this.handlePointerUp=(h,f)=>{this.end();const{onEnd:m,onSessionEnd:g,resumeAnimation:x}=this.handlers;if(this.dragSnapToOrigin&&x&&x(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const y=Ft(h.type==="pointercancel"?this.lastMoveEventInfo:Lt(f,this.transformPagePoint),this.history);this.startEvent&&m&&m(h,y),g&&g(h,y)},!jo(t))return;this.dragSnapToOrigin=i,this.handlers=r,this.transformPagePoint=s,this.contextWindow=n||window;const a=jt(t),l=Lt(a,this.transformPagePoint),{point:c}=l,{timestamp:d}=X;this.history=[{...c,timestamp:d}];const{onSessionStart:u}=r;u&&u(t,Ft(l,this.history)),this.removeListeners=me(le(this.contextWindow,"pointermove",this.handlePointerMove),le(this.contextWindow,"pointerup",this.handlePointerUp),le(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),de(this.updatePoint)}}function Lt(e,t){return t?{point:t(e.point)}:e}function ns(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Ft({point:e},t){return{point:e,delta:ns(e,an(t)),offset:ns(e,Wl(t)),velocity:Hl(t,.1)}}function Wl(e){return e[0]}function an(e){return e[e.length-1]}function Hl(e,t){if(e.length<2)return{x:0,y:0};let r=e.length-1,s=null;const n=an(e);for(;r>=0&&(s=e[r],!(n.timestamp-s.timestamp>pe(t)));)r--;if(!s)return{x:0,y:0};const i=ce(n.timestamp-s.timestamp);if(i===0)return{x:0,y:0};const a={x:(n.x-s.x)/i,y:(n.y-s.y)/i};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function Q(e){return e.max-e.min}function Zt(e,t=0,r=.01){return Math.abs(e-t)<=r}function is(e,t,r,s=.5){e.origin=s,e.originPoint=W(t.min,t.max,e.origin),e.scale=Q(r)/Q(t),(Zt(e.scale,1,1e-4)||isNaN(e.scale))&&(e.scale=1),e.translate=W(r.min,r.max,e.origin)-e.originPoint,(Zt(e.translate)||isNaN(e.translate))&&(e.translate=0)}function $e(e,t,r,s){is(e.x,t.x,r.x,s?s.originX:void 0),is(e.y,t.y,r.y,s?s.originY:void 0)}function as(e,t,r){e.min=r.min+t.min,e.max=e.min+Q(t)}function Gl(e,t,r){as(e.x,t.x,r.x),as(e.y,t.y,r.y)}function ls(e,t,r){e.min=t.min-r.min,e.max=e.min+Q(t)}function We(e,t,r){ls(e.x,t.x,r.x),ls(e.y,t.y,r.y)}function ql(e,{min:t,max:r},s){return t!==void 0&&e<t?e=s?W(t,e,s.min):Math.max(e,t):r!==void 0&&e>r&&(e=s?W(r,e,s.max):Math.min(e,r)),e}function cs(e,t,r){return{min:t!==void 0?e.min+t:void 0,max:r!==void 0?e.max+r-(e.max-e.min):void 0}}function Kl(e,{top:t,left:r,bottom:s,right:n}){return{x:cs(e.x,r,n),y:cs(e.y,t,s)}}function ds(e,t){let r=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([r,s]=[s,r]),{min:r,max:s}}function Xl(e,t){return{x:ds(e.x,t.x),y:ds(e.y,t.y)}}function Yl(e,t){let r=.5;const s=Q(e),n=Q(t);return n>s?r=qe(t.min,t.max-s,e.min):s>n&&(r=qe(e.min,e.max-n,t.min)),ge(0,1,r)}function Jl(e,t){const r={};return t.min!==void 0&&(r.min=t.min-e.min),t.max!==void 0&&(r.max=t.max-e.min),r}const Qt=.35;function Zl(e=Qt){return e===!1?e=0:e===!0&&(e=Qt),{x:us(e,"left","right"),y:us(e,"top","bottom")}}function us(e,t,r){return{min:hs(e,t),max:hs(e,r)}}function hs(e,t){return typeof e=="number"?e:e[t]||0}const fs=()=>({translate:0,scale:1,origin:0,originPoint:0}),De=()=>({x:fs(),y:fs()}),ms=()=>({min:0,max:0}),q=()=>({x:ms(),y:ms()});function se(e){return[e("x"),e("y")]}function ln({top:e,left:t,right:r,bottom:s}){return{x:{min:t,max:r},y:{min:e,max:s}}}function Ql({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function ec(e,t){if(!t)return e;const r=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:r.y,left:r.x,bottom:s.y,right:s.x}}function It(e){return e===void 0||e===1}function er({scale:e,scaleX:t,scaleY:r}){return!It(e)||!It(t)||!It(r)}function we(e){return er(e)||cn(e)||e.z||e.rotate||e.rotateX||e.rotateY}function cn(e){return ps(e.x)||ps(e.y)}function ps(e){return e&&e!=="0%"}function pt(e,t,r){const s=e-r,n=t*s;return r+n}function gs(e,t,r,s,n){return n!==void 0&&(e=pt(e,n,s)),pt(e,r,s)+t}function tr(e,t=0,r=1,s,n){e.min=gs(e.min,t,r,s,n),e.max=gs(e.max,t,r,s,n)}function dn(e,{x:t,y:r}){tr(e.x,t.translate,t.scale,t.originPoint),tr(e.y,r.translate,r.scale,r.originPoint)}function tc(e,t,r,s=!1){const n=r.length;if(!n)return;t.x=t.y=1;let i,a;for(let l=0;l<n;l++){i=r[l],a=i.projectionDelta;const c=i.instance;c&&c.style&&c.style.display==="contents"||(s&&i.options.layoutScroll&&i.scroll&&i!==i.root&&Me(e,{x:-i.scroll.offset.x,y:-i.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,dn(e,a)),s&&we(i.latestValues)&&Me(e,i.latestValues))}t.x=xs(t.x),t.y=xs(t.y)}function xs(e){return Number.isInteger(e)||e>1.0000000000001||e<.999999999999?e:1}function fe(e,t){e.min=e.min+t,e.max=e.max+t}function ys(e,t,[r,s,n]){const i=t[n]!==void 0?t[n]:.5,a=W(e.min,e.max,i);tr(e,t[r],t[s],a,t.scale)}const rc=["x","scaleX","originX"],sc=["y","scaleY","originY"];function Me(e,t){ys(e.x,t,rc),ys(e.y,t,sc)}function un(e,t){return ln(ec(e.getBoundingClientRect(),t))}function oc(e,t,r){const s=un(e,r),{scroll:n}=t;return n&&(fe(s.x,n.offset.x),fe(s.y,n.offset.y)),s}const hn=({current:e})=>e?e.ownerDocument.defaultView:null,nc=new WeakMap;class ic{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=q(),this.visualElement=t}start(t,{snapToCursor:r=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const n=u=>{const{dragSnapToOrigin:h}=this.getProps();h?this.pauseAnimation():this.stopAnimation(),r&&this.snapToCursor(jt(u,"page").point)},i=(u,h)=>{const{drag:f,dragPropagation:m,onDragStart:g}=this.getProps();if(f&&!m&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=So(f),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),se(y=>{let b=this.getAxisMotionValue(y).get()||0;if(ie.test(b)){const{projection:p}=this.visualElement;if(p&&p.layout){const j=p.layout.layoutBox[y];j&&(b=Q(j)*(parseFloat(b)/100))}}this.originPoint[y]=b}),g&&U.update(()=>g(u,h),!1,!0);const{animationState:x}=this.visualElement;x&&x.setActive("whileDrag",!0)},a=(u,h)=>{const{dragPropagation:f,dragDirectionLock:m,onDirectionLock:g,onDrag:x}=this.getProps();if(!f&&!this.openGlobalLock)return;const{offset:y}=h;if(m&&this.currentDirection===null){this.currentDirection=ac(y),this.currentDirection!==null&&g&&g(this.currentDirection);return}this.updateAxis("x",h.point,y),this.updateAxis("y",h.point,y),this.visualElement.render(),x&&x(u,h)},l=(u,h)=>this.stop(u,h),c=()=>se(u=>{var h;return this.getAnimationState(u)==="paused"&&((h=this.getAxisMotionValue(u).animation)===null||h===void 0?void 0:h.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new nn(t,{onSessionStart:n,onStart:i,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:hn(this.visualElement)})}stop(t,r){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:n}=r;this.startAnimation(n);const{onDragEnd:i}=this.getProps();i&&U.update(()=>i(t,r))}cancel(){this.isDragging=!1;const{projection:t,animationState:r}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),r&&r.setActive("whileDrag",!1)}updateAxis(t,r,s){const{drag:n}=this.getProps();if(!s||!ot(t,n,this.currentDirection))return;const i=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=ql(a,this.constraints[t],this.elastic[t])),i.set(a)}resolveConstraints(){var t;const{dragConstraints:r,dragElastic:s}=this.getProps(),n=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,i=this.constraints;r&&Ee(r)?this.constraints||(this.constraints=this.resolveRefConstraints()):r&&n?this.constraints=Kl(n.layoutBox,r):this.constraints=!1,this.elastic=Zl(s),i!==this.constraints&&n&&this.constraints&&!this.hasMutatedConstraints&&se(a=>{this.getAxisMotionValue(a)&&(this.constraints[a]=Jl(n.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:r}=this.getProps();if(!t||!Ee(t))return!1;const s=t.current,{projection:n}=this.visualElement;if(!n||!n.layout)return!1;const i=oc(s,n.root,this.visualElement.getTransformPagePoint());let a=Xl(n.layout.layoutBox,i);if(r){const l=r(Ql(a));this.hasMutatedConstraints=!!l,l&&(a=ln(l))}return a}startAnimation(t){const{drag:r,dragMomentum:s,dragElastic:n,dragTransition:i,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=se(u=>{if(!ot(u,r,this.currentDirection))return;let h=c&&c[u]||{};a&&(h={min:0,max:0});const f=n?200:1e6,m=n?40:1e7,g={type:"inertia",velocity:s?t[u]:0,bounceStiffness:f,bounceDamping:m,timeConstant:750,restDelta:1,restSpeed:10,...i,...h};return this.startAxisValueAnimation(u,g)});return Promise.all(d).then(l)}startAxisValueAnimation(t,r){const s=this.getAxisMotionValue(t);return s.start(Dr(t,s,0,r))}stopAnimation(){se(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){se(t=>{var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.pause()})}getAnimationState(t){var r;return(r=this.getAxisMotionValue(t).animation)===null||r===void 0?void 0:r.state}getAxisMotionValue(t){const r="_drag"+t.toUpperCase(),s=this.visualElement.getProps(),n=s[r];return n||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){se(r=>{const{drag:s}=this.getProps();if(!ot(r,s,this.currentDirection))return;const{projection:n}=this.visualElement,i=this.getAxisMotionValue(r);if(n&&n.layout){const{min:a,max:l}=n.layout.layoutBox[r];i.set(t[r]-W(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:r}=this.getProps(),{projection:s}=this.visualElement;if(!Ee(r)||!s||!this.constraints)return;this.stopAnimation();const n={x:0,y:0};se(a=>{const l=this.getAxisMotionValue(a);if(l){const c=l.get();n[a]=Yl({min:c,max:c},this.constraints[a])}});const{transformTemplate:i}=this.visualElement.getProps();this.visualElement.current.style.transform=i?i({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),se(a=>{if(!ot(a,t,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(W(c,d,n[a]))})}addListeners(){if(!this.visualElement.current)return;nc.set(this.visualElement,this);const t=this.visualElement.current,r=le(t,"pointerdown",c=>{const{drag:d,dragListener:u=!0}=this.getProps();d&&u&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();Ee(c)&&(this.constraints=this.resolveRefConstraints())},{projection:n}=this.visualElement,i=n.addEventListener("measure",s);n&&!n.layout&&(n.root&&n.root.updateScroll(),n.updateLayout()),s();const a=ae(window,"resize",()=>this.scalePositionWithinConstraints()),l=n.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(se(u=>{const h=this.getAxisMotionValue(u);h&&(this.originPoint[u]+=c[u].translate,h.set(h.get()+c[u].translate))}),this.visualElement.render())});return()=>{a(),r(),i(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:r=!1,dragDirectionLock:s=!1,dragPropagation:n=!1,dragConstraints:i=!1,dragElastic:a=Qt,dragMomentum:l=!0}=t;return{...t,drag:r,dragDirectionLock:s,dragPropagation:n,dragConstraints:i,dragElastic:a,dragMomentum:l}}}function ot(e,t,r){return(t===!0||t===e)&&(r===null||r===e)}function ac(e,t=10){let r=null;return Math.abs(e.y)>t?r="y":Math.abs(e.x)>t&&(r="x"),r}class lc extends ye{constructor(t){super(t),this.removeGroupControls=H,this.removeListeners=H,this.controls=new ic(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||H}unmount(){this.removeGroupControls(),this.removeListeners()}}const vs=e=>(t,r)=>{e&&U.update(()=>e(t,r))};class cc extends ye{constructor(){super(...arguments),this.removePointerDownListener=H}onPointerDown(t){this.session=new nn(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:hn(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:r,onPan:s,onPanEnd:n}=this.node.getProps();return{onSessionStart:vs(t),onStart:vs(r),onMove:s,onEnd:(i,a)=>{delete this.session,n&&U.update(()=>n(i,a))}}}mount(){this.removePointerDownListener=le(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}function dc(){const e=v.useContext(mr);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:r,register:s}=e,n=v.useId();return v.useEffect(()=>s(n),[]),!t&&r?[!1,()=>r&&r(n)]:[!0]}const at={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function bs(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const Oe={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(V.test(e))e=parseFloat(e);else return e;const r=bs(e,t.target.x),s=bs(e,t.target.y);return`${r}% ${s}%`}},uc={correct:(e,{treeScale:t,projectionDelta:r})=>{const s=e,n=xe.parse(e);if(n.length>5)return s;const i=xe.createTransformer(e),a=typeof n[0]!="number"?1:0,l=r.x.scale*t.x,c=r.y.scale*t.y;n[0+a]/=l,n[1+a]/=c;const d=W(l,c,.5);return typeof n[2+a]=="number"&&(n[2+a]/=d),typeof n[3+a]=="number"&&(n[3+a]/=d),i(n)}};class hc extends ir.Component{componentDidMount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:s,layoutId:n}=this.props,{projection:i}=t;yi(fc),i&&(r.group&&r.group.add(i),s&&s.register&&n&&s.register(i),i.root.didUpdate(),i.addEventListener("animationComplete",()=>{this.safeToRemove()}),i.setOptions({...i.options,onExitComplete:()=>this.safeToRemove()})),at.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:r,visualElement:s,drag:n,isPresent:i}=this.props,a=s.projection;return a&&(a.isPresent=i,n||t.layoutDependency!==r||r===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==i&&(i?a.promote():a.relegate()||U.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),queueMicrotask(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:r,switchLayoutGroup:s}=this.props,{projection:n}=t;n&&(n.scheduleCheckAfterUnmount(),r&&r.group&&r.group.remove(n),s&&s.deregister&&s.deregister(n))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function fn(e){const[t,r]=dc(),s=v.useContext(io);return ir.createElement(hc,{...e,layoutGroup:s,switchLayoutGroup:v.useContext(ao),isPresent:t,safeToRemove:r})}const fc={borderRadius:{...Oe,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Oe,borderTopRightRadius:Oe,borderBottomLeftRadius:Oe,borderBottomRightRadius:Oe,boxShadow:uc},mn=["TopLeft","TopRight","BottomLeft","BottomRight"],mc=mn.length,ws=e=>typeof e=="string"?parseFloat(e):e,js=e=>typeof e=="number"||V.test(e);function pc(e,t,r,s,n,i){n?(e.opacity=W(0,r.opacity!==void 0?r.opacity:1,gc(s)),e.opacityExit=W(t.opacity!==void 0?t.opacity:1,0,xc(s))):i&&(e.opacity=W(t.opacity!==void 0?t.opacity:1,r.opacity!==void 0?r.opacity:1,s));for(let a=0;a<mc;a++){const l=`border${mn[a]}Radius`;let c=Cs(t,l),d=Cs(r,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||js(c)===js(d)?(e[l]=Math.max(W(ws(c),ws(d),s),0),(ie.test(d)||ie.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||r.rotate)&&(e.rotate=W(t.rotate||0,r.rotate||0,s))}function Cs(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const gc=pn(0,.5,Fo),xc=pn(.5,.95,H);function pn(e,t,r){return s=>s<e?0:s>t?1:r(qe(e,t,s))}function Ss(e,t){e.min=t.min,e.max=t.max}function te(e,t){Ss(e.x,t.x),Ss(e.y,t.y)}function Ns(e,t,r,s,n){return e-=t,e=pt(e,1/r,s),n!==void 0&&(e=pt(e,1/n,s)),e}function yc(e,t=0,r=1,s=.5,n,i=e,a=e){if(ie.test(t)&&(t=parseFloat(t),t=W(a.min,a.max,t/100)-a.min),typeof t!="number")return;let l=W(i.min,i.max,s);e===i&&(l-=t),e.min=Ns(e.min,t,r,l,n),e.max=Ns(e.max,t,r,l,n)}function Ts(e,t,[r,s,n],i,a){yc(e,t[r],t[s],t[n],t.scale,i,a)}const vc=["x","scaleX","originX"],bc=["y","scaleY","originY"];function Ps(e,t,r,s){Ts(e.x,t,vc,r?r.x:void 0,s?s.x:void 0),Ts(e.y,t,bc,r?r.y:void 0,s?s.y:void 0)}function ks(e){return e.translate===0&&e.scale===1}function gn(e){return ks(e.x)&&ks(e.y)}function wc(e,t){return e.x.min===t.x.min&&e.x.max===t.x.max&&e.y.min===t.y.min&&e.y.max===t.y.max}function xn(e,t){return Math.round(e.x.min)===Math.round(t.x.min)&&Math.round(e.x.max)===Math.round(t.x.max)&&Math.round(e.y.min)===Math.round(t.y.min)&&Math.round(e.y.max)===Math.round(t.y.max)}function Es(e){return Q(e.x)/Q(e.y)}class jc{constructor(){this.members=[]}add(t){Mr(this.members,t),t.scheduleRender()}remove(t){if(Vr(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const r=this.members[this.members.length-1];r&&this.promote(r)}}relegate(t){const r=this.members.findIndex(n=>t===n);if(r===0)return!1;let s;for(let n=r;n>=0;n--){const i=this.members[n];if(i.isPresent!==!1){s=i;break}}return s?(this.promote(s),!0):!1}promote(t,r){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,r&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:n}=t.options;n===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:r,resumingFrom:s}=t;r.onExitComplete&&r.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function As(e,t,r){let s="";const n=e.x.translate/t.x,i=e.y.translate/t.y;if((n||i)&&(s=`translate3d(${n}px, ${i}px, 0) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),r){const{rotate:c,rotateX:d,rotateY:u}=r;c&&(s+=`rotate(${c}deg) `),d&&(s+=`rotateX(${d}deg) `),u&&(s+=`rotateY(${u}deg) `)}const a=e.x.scale*t.x,l=e.y.scale*t.y;return(a!==1||l!==1)&&(s+=`scale(${a}, ${l})`),s||"none"}const Cc=(e,t)=>e.depth-t.depth;class Sc{constructor(){this.children=[],this.isDirty=!1}add(t){Mr(this.children,t),this.isDirty=!0}remove(t){Vr(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(Cc),this.isDirty=!1,this.children.forEach(t)}}function Nc(e,t){const r=performance.now(),s=({timestamp:n})=>{const i=n-r;i>=t&&(de(s),e(i-t))};return U.read(s,!0),()=>de(s)}function Tc(e){window.MotionDebug&&window.MotionDebug.record(e)}function Pc(e){return e instanceof SVGElement&&e.tagName!=="svg"}function kc(e,t,r){const s=J(e)?e:Re(e);return s.start(Dr("",s,t,r)),s.animation}const Ds=["","X","Y","Z"],Ec={visibility:"hidden"},Ms=1e3;let Ac=0;const je={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0};function yn({attachResizeListener:e,defaultParent:t,measureScroll:r,checkIsScrollRoot:s,resetTransform:n}){return class{constructor(a={},l=t==null?void 0:t()){this.id=Ac++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,je.totalNodes=je.resolvedTargetDeltas=je.recalculatedProjection=0,this.nodes.forEach(Vc),this.nodes.forEach(Oc),this.nodes.forEach(_c),this.nodes.forEach(Rc),Tc(je)},this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new Sc)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Rr),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Pc(a),this.instance=a;const{layoutId:c,layout:d,visualElement:u}=this.options;if(u&&!u.current&&u.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let h;const f=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,h&&h(),h=Nc(f,250),at.hasAnimatedSinceResize&&(at.hasAnimatedSinceResize=!1,this.nodes.forEach(Rs))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&u&&(c||d)&&this.addEventListener("didUpdate",({delta:h,hasLayoutChanged:f,hasRelativeTargetChanged:m,layout:g})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const x=this.options.transition||u.getDefaultTransition()||Wc,{onLayoutAnimationStart:y,onLayoutAnimationComplete:b}=u.getProps(),p=!this.targetLayout||!xn(this.targetLayout,g)||m,j=!f&&m;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||j||f&&(p||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(h,j);const w={...Ar(x,"layout"),onPlay:y,onComplete:b};(u.shouldReduceMotion||this.options.layoutRoot)&&(w.delay=0,w.type=!1),this.startAnimation(w)}else f||Rs(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=g})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,de(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Bc),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let u=0;u<this.path.length;u++){const h=this.path[u];h.shouldResetTransform=!0,h.updateScroll("snapshot"),h.options.layoutRoot&&h.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(Vs);return}this.isUpdating||this.nodes.forEach(Fc),this.isUpdating=!1,this.nodes.forEach(Ic),this.nodes.forEach(Dc),this.nodes.forEach(Mc),this.clearAllSnapshots();const l=performance.now();X.delta=ge(0,1e3/60,l-X.timestamp),X.timestamp=l,X.isProcessing=!0,Pt.update.process(X),Pt.preRender.process(X),Pt.render.process(X),X.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,queueMicrotask(()=>this.update()))}clearAllSnapshots(){this.nodes.forEach(Lc),this.sharedNodes.forEach(zc)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,U.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){U.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=q(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l&&(this.scroll={animationId:this.root.animationId,phase:a,isRoot:s(this.instance),offset:r(this.instance)})}resetTransform(){if(!n)return;const a=this.isLayoutDirty||this.shouldResetTransform,l=this.projectionDelta&&!gn(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,u=d!==this.prevTransformTemplateValue;a&&(l||we(this.latestValues)||u)&&(n(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),Hc(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:a}=this.options;if(!a)return q();const l=a.measureViewportBox(),{scroll:c}=this.root;return c&&(fe(l.x,c.offset.x),fe(l.y,c.offset.y)),l}removeElementScroll(a){const l=q();te(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c],{scroll:u,options:h}=d;if(d!==this.root&&u&&h.layoutScroll){if(u.isRoot){te(l,a);const{scroll:f}=this.root;f&&(fe(l.x,-f.offset.x),fe(l.y,-f.offset.y))}fe(l.x,u.offset.x),fe(l.y,u.offset.y)}}return l}applyTransform(a,l=!1){const c=q();te(c,a);for(let d=0;d<this.path.length;d++){const u=this.path[d];!l&&u.options.layoutScroll&&u.scroll&&u!==u.root&&Me(c,{x:-u.scroll.offset.x,y:-u.scroll.offset.y}),we(u.latestValues)&&Me(c,u.latestValues)}return we(this.latestValues)&&Me(c,this.latestValues),c}removeTransform(a){const l=q();te(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!we(d.latestValues))continue;er(d.latestValues)&&d.updateSnapshot();const u=q(),h=d.measurePageBox();te(u,h),Ps(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,u)}return we(this.latestValues)&&Ps(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==X.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget))return;const{layout:h,layoutId:f}=this.options;if(!(!this.layout||!(h||f))){if(this.resolvedRelativeTargetAt=X.timestamp,!this.targetDelta&&!this.relativeTarget){const m=this.getClosestProjectingParent();m&&m.layout&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=q(),this.relativeTargetOrigin=q(),We(this.relativeTargetOrigin,this.layout.layoutBox,m.layout.layoutBox),te(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=q(),this.targetWithTransforms=q()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Gl(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):te(this.target,this.layout.layoutBox),dn(this.target,this.targetDelta)):te(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const m=this.getClosestProjectingParent();m&&!!m.resumingFrom==!!this.resumingFrom&&!m.options.layoutScroll&&m.target&&this.animationProgress!==1?(this.relativeParent=m,this.forceRelativeParentToResolveTarget(),this.relativeTarget=q(),this.relativeTargetOrigin=q(),We(this.relativeTargetOrigin,this.target,m.target),te(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}je.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||er(this.parent.latestValues)||cn(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===X.timestamp&&(d=!1),d)return;const{layout:u,layoutId:h}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(u||h))return;te(this.layoutCorrected,this.layout.layoutBox);const f=this.treeScale.x,m=this.treeScale.y;tc(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox);const{target:g}=l;if(!g){this.projectionTransform&&(this.projectionDelta=De(),this.projectionTransform="none",this.scheduleRender());return}this.projectionDelta||(this.projectionDelta=De(),this.projectionDeltaWithTransform=De());const x=this.projectionTransform;$e(this.projectionDelta,this.layoutCorrected,g,this.latestValues),this.projectionTransform=As(this.projectionDelta,this.treeScale),(this.projectionTransform!==x||this.treeScale.x!==f||this.treeScale.y!==m)&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",g)),je.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){if(this.options.scheduleRender&&this.options.scheduleRender(),a){const l=this.getStack();l&&l.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},u={...this.latestValues},h=De();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const f=q(),m=c?c.source:void 0,g=this.layout?this.layout.source:void 0,x=m!==g,y=this.getStack(),b=!y||y.members.length<=1,p=!!(x&&!b&&this.options.crossfade===!0&&!this.path.some($c));this.animationProgress=0;let j;this.mixTargetDelta=w=>{const C=w/1e3;Ls(h.x,a.x,C),Ls(h.y,a.y,C),this.setTargetDelta(h),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(We(f,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Uc(this.relativeTarget,this.relativeTargetOrigin,f,C),j&&wc(this.relativeTarget,j)&&(this.isProjectionDirty=!1),j||(j=q()),te(j,this.relativeTarget)),x&&(this.animationValues=u,pc(u,d,this.latestValues,C,p,b)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=C},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(de(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=U.update(()=>{at.hasAnimatedSinceResize=!0,this.currentAnimation=kc(0,Ms,{...a,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(Ms),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:u}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&vn(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||q();const h=Q(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+h;const f=Q(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+f}te(l,c),Me(l,u),$e(this.projectionDeltaWithTransform,this.layoutCorrected,l,u)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new jc),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:l}=this.options;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:l}=this.options;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.rotate||c.rotateX||c.rotateY||c.rotateZ)&&(l=!0),!l)return;const d={};for(let u=0;u<Ds.length;u++){const h="rotate"+Ds[u];c[h]&&(d[h]=c[h],a.setStaticValue(h,0))}a.render();for(const u in d)a.setStaticValue(u,d[u]);a.scheduleRender()}getProjectionStyles(a){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return Ec;const d={visibility:""},u=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=it(a==null?void 0:a.pointerEvents)||"",d.transform=u?u(this.latestValues,""):"none",d;const h=this.getLead();if(!this.projectionDelta||!this.layout||!h.target){const x={};return this.options.layoutId&&(x.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,x.pointerEvents=it(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!we(this.latestValues)&&(x.transform=u?u({},""):"none",this.hasProjected=!1),x}const f=h.animationValues||h.latestValues;this.applyTransformsToTarget(),d.transform=As(this.projectionDeltaWithTransform,this.treeScale,f),u&&(d.transform=u(f,d.transform));const{x:m,y:g}=this.projectionDelta;d.transformOrigin=`${m.origin*100}% ${g.origin*100}% 0`,h.animationValues?d.opacity=h===this?(c=(l=f.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:f.opacityExit:d.opacity=h===this?f.opacity!==void 0?f.opacity:"":f.opacityExit!==void 0?f.opacityExit:0;for(const x in lt){if(f[x]===void 0)continue;const{correct:y,applyTo:b}=lt[x],p=d.transform==="none"?f[x]:y(f[x],h);if(b){const j=b.length;for(let w=0;w<j;w++)d[b[w]]=p}else d[x]=p}return this.options.layoutId&&(d.pointerEvents=h===this?it(a==null?void 0:a.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(Vs),this.root.sharedNodes.clear()}}}function Dc(e){e.updateLayout()}function Mc(e){var t;const r=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&r&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:n}=e.layout,{animationType:i}=e.options,a=r.source!==e.layout.source;i==="size"?se(h=>{const f=a?r.measuredBox[h]:r.layoutBox[h],m=Q(f);f.min=s[h].min,f.max=f.min+m}):vn(i,r.layoutBox,s)&&se(h=>{const f=a?r.measuredBox[h]:r.layoutBox[h],m=Q(s[h]);f.max=f.min+m,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[h].max=e.relativeTarget[h].min+m)});const l=De();$e(l,s,r.layoutBox);const c=De();a?$e(c,e.applyTransform(n,!0),r.measuredBox):$e(c,s,r.layoutBox);const d=!gn(l);let u=!1;if(!e.resumeFrom){const h=e.getClosestProjectingParent();if(h&&!h.resumeFrom){const{snapshot:f,layout:m}=h;if(f&&m){const g=q();We(g,r.layoutBox,f.layoutBox);const x=q();We(x,s,m.layoutBox),xn(g,x)||(u=!0),h.options.layoutRoot&&(e.relativeTarget=x,e.relativeTargetOrigin=g,e.relativeParent=h)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:r,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:u})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function Vc(e){je.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Rc(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Lc(e){e.clearSnapshot()}function Vs(e){e.clearMeasurements()}function Fc(e){e.isLayoutDirty=!1}function Ic(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function Rs(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Oc(e){e.resolveTargetDelta()}function _c(e){e.calcProjection()}function Bc(e){e.resetRotation()}function zc(e){e.removeLeadSnapshot()}function Ls(e,t,r){e.translate=W(t.translate,0,r),e.scale=W(t.scale,1,r),e.origin=t.origin,e.originPoint=t.originPoint}function Fs(e,t,r,s){e.min=W(t.min,r.min,s),e.max=W(t.max,r.max,s)}function Uc(e,t,r,s){Fs(e.x,t.x,r.x,s),Fs(e.y,t.y,r.y,s)}function $c(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Wc={duration:.45,ease:[.4,0,.1,1]},Is=e=>typeof navigator<"u"&&navigator.userAgent.toLowerCase().includes(e),Os=Is("applewebkit/")&&!Is("chrome/")?Math.round:H;function _s(e){e.min=Os(e.min),e.max=Os(e.max)}function Hc(e){_s(e.x),_s(e.y)}function vn(e,t,r){return e==="position"||e==="preserve-aspect"&&!Zt(Es(t),Es(r),.2)}const Gc=yn({attachResizeListener:(e,t)=>ae(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Ot={current:void 0},bn=yn({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Ot.current){const e=new Gc({});e.mount(window),e.setOptions({layoutScroll:!0}),Ot.current=e}return Ot.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),qc={pan:{Feature:cc},drag:{Feature:lc,ProjectionNode:bn,MeasureLayout:fn}},Kc=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/;function Xc(e){const t=Kc.exec(e);if(!t)return[,];const[,r,s]=t;return[r,s]}function rr(e,t,r=1){const[s,n]=Xc(e);if(!s)return;const i=window.getComputedStyle(t).getPropertyValue(s);if(i){const a=i.trim();return tn(a)?parseFloat(a):a}else return Ht(n)?rr(n,t,r+1):n}function Yc(e,{...t},r){const s=e.current;if(!(s instanceof Element))return{target:t,transitionEnd:r};r&&(r={...r}),e.values.forEach(n=>{const i=n.get();if(!Ht(i))return;const a=rr(i,s);a&&n.set(a)});for(const n in t){const i=t[n];if(!Ht(i))continue;const a=rr(i,s);a&&(t[n]=a,r||(r={}),r[n]===void 0&&(r[n]=i))}return{target:t,transitionEnd:r}}const Jc=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),wn=e=>Jc.has(e),Zc=e=>Object.keys(e).some(wn),Bs=e=>e===Pe||e===V,zs=(e,t)=>parseFloat(e.split(", ")[t]),Us=(e,t)=>(r,{transform:s})=>{if(s==="none"||!s)return 0;const n=s.match(/^matrix3d\((.+)\)$/);if(n)return zs(n[1],t);{const i=s.match(/^matrix\((.+)\)$/);return i?zs(i[1],e):0}},Qc=new Set(["x","y","z"]),ed=Ye.filter(e=>!Qc.has(e));function td(e){const t=[];return ed.forEach(r=>{const s=e.getValue(r);s!==void 0&&(t.push([r,s.get()]),s.set(r.startsWith("scale")?1:0))}),t.length&&e.render(),t}const Le={width:({x:e},{paddingLeft:t="0",paddingRight:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),height:({y:e},{paddingTop:t="0",paddingBottom:r="0"})=>e.max-e.min-parseFloat(t)-parseFloat(r),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:Us(4,13),y:Us(5,14)};Le.translateX=Le.x;Le.translateY=Le.y;const rd=(e,t,r)=>{const s=t.measureViewportBox(),n=t.current,i=getComputedStyle(n),{display:a}=i,l={};a==="none"&&t.setStaticValue("display",e.display||"block"),r.forEach(d=>{l[d]=Le[d](s,i)}),t.render();const c=t.measureViewportBox();return r.forEach(d=>{const u=t.getValue(d);u&&u.jump(l[d]),e[d]=Le[d](c,i)}),e},sd=(e,t,r={},s={})=>{t={...t},s={...s};const n=Object.keys(t).filter(wn);let i=[],a=!1;const l=[];if(n.forEach(c=>{const d=e.getValue(c);if(!e.hasValue(c))return;let u=r[c],h=Ie(u);const f=t[c];let m;if(dt(f)){const g=f.length,x=f[0]===null?1:0;u=f[x],h=Ie(u);for(let y=x;y<g&&f[y]!==null;y++)m?Nr(Ie(f[y])===m):m=Ie(f[y])}else m=Ie(f);if(h!==m)if(Bs(h)&&Bs(m)){const g=d.get();typeof g=="string"&&d.set(parseFloat(g)),typeof f=="string"?t[c]=parseFloat(f):Array.isArray(f)&&m===V&&(t[c]=f.map(parseFloat))}else h!=null&&h.transform&&(m!=null&&m.transform)&&(u===0||f===0)?u===0?d.set(m.transform(u)):t[c]=h.transform(f):(a||(i=td(e),a=!0),l.push(c),s[c]=s[c]!==void 0?s[c]:t[c],d.jump(f))}),l.length){const c=l.indexOf("height")>=0?window.pageYOffset:null,d=rd(t,e,l);return i.length&&i.forEach(([u,h])=>{e.getValue(u).set(h)}),e.render(),yt&&c!==null&&window.scrollTo({top:c}),{target:d,transitionEnd:s}}else return{target:t,transitionEnd:s}};function od(e,t,r,s){return Zc(t)?sd(e,t,r,s):{target:t,transitionEnd:s}}const nd=(e,t,r,s)=>{const n=Yc(e,t,s);return t=n.target,s=n.transitionEnd,od(e,t,r,s)},sr={current:null},jn={current:!1};function id(){if(jn.current=!0,!!yt)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>sr.current=e.matches;e.addListener(t),t()}else sr.current=!1}function ad(e,t,r){const{willChange:s}=t;for(const n in t){const i=t[n],a=r[n];if(J(i))e.addValue(n,i),mt(s)&&s.add(n);else if(J(a))e.addValue(n,Re(i,{owner:e})),mt(s)&&s.remove(n);else if(a!==i)if(e.hasValue(n)){const l=e.getValue(n);!l.hasAnimated&&l.set(i)}else{const l=e.getStaticValue(n);e.addValue(n,Re(l!==void 0?l:i,{owner:e}))}}for(const n in r)t[n]===void 0&&e.removeValue(n);return t}const $s=new WeakMap,Cn=Object.keys(Ge),ld=Cn.length,Ws=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"],cd=xr.length;class dd{constructor({parent:t,props:r,presenceContext:s,reducedMotionConfig:n,visualState:i},a={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.scheduleRender=()=>U.render(this.render,!1,!0);const{latestValues:l,renderState:c}=i;this.latestValues=l,this.baseTarget={...l},this.initialValues=r.initial?{...l}:{},this.renderState=c,this.parent=t,this.props=r,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=n,this.options=a,this.isControllingVariants=bt(r),this.isVariantNode=no(r),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:d,...u}=this.scrapeMotionValuesFromProps(r,{});for(const h in u){const f=u[h];l[h]!==void 0&&J(f)&&(f.set(l[h],!1),mt(d)&&d.add(h))}}scrapeMotionValuesFromProps(t,r){return{}}mount(t){this.current=t,$s.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((r,s)=>this.bindToMotionValue(s,r)),jn.current||id(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:sr.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){$s.delete(this.current),this.projection&&this.projection.unmount(),de(this.notifyUpdate),de(this.render),this.valueSubscriptions.forEach(t=>t()),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features)this.features[t].unmount();this.current=null}bindToMotionValue(t,r){const s=Te.has(t),n=r.on("change",a=>{this.latestValues[t]=a,this.props.onUpdate&&U.update(this.notifyUpdate,!1,!0),s&&this.projection&&(this.projection.isTransformDirty=!0)}),i=r.on("renderRequest",this.scheduleRender);this.valueSubscriptions.set(t,()=>{n(),i()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}loadFeatures({children:t,...r},s,n,i){let a,l;for(let c=0;c<ld;c++){const d=Cn[c],{isEnabled:u,Feature:h,ProjectionNode:f,MeasureLayout:m}=Ge[d];f&&(a=f),u(r)&&(!this.features[d]&&h&&(this.features[d]=new h(this)),m&&(l=m))}if((this.type==="html"||this.type==="svg")&&!this.projection&&a){this.projection=new a(this.latestValues,this.parent&&this.parent.projection);const{layoutId:c,layout:d,drag:u,dragConstraints:h,layoutScroll:f,layoutRoot:m}=r;this.projection.setOptions({layoutId:c,layout:d,alwaysMeasureLayout:!!u||h&&Ee(h),visualElement:this,scheduleRender:()=>this.scheduleRender(),animationType:typeof d=="string"?d:"both",initialPromotionConfig:i,layoutScroll:f,layoutRoot:m})}return l}updateFeatures(){for(const t in this.features){const r=this.features[t];r.isMounted?r.update():(r.mount(),r.isMounted=!0)}}triggerBuild(){this.build(this.renderState,this.latestValues,this.options,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):q()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,r){this.latestValues[t]=r}makeTargetAnimatable(t,r=!0){return this.makeTargetAnimatableFromInstance(t,this.props,r)}update(t,r){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=r;for(let s=0;s<Ws.length;s++){const n=Ws[s];this.propEventSubscriptions[n]&&(this.propEventSubscriptions[n](),delete this.propEventSubscriptions[n]);const i=t["on"+n];i&&(this.propEventSubscriptions[n]=this.on(n,i))}this.prevMotionValues=ad(this,this.scrapeMotionValuesFromProps(t,this.prevProps),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}getVariantContext(t=!1){if(t)return this.parent?this.parent.getVariantContext():void 0;if(!this.isControllingVariants){const s=this.parent?this.parent.getVariantContext()||{}:{};return this.props.initial!==void 0&&(s.initial=this.props.initial),s}const r={};for(let s=0;s<cd;s++){const n=xr[s],i=this.props[n];(He(i)||i===!1)&&(r[n]=i)}return r}addVariantChild(t){const r=this.getClosestVariantNode();if(r)return r.variantChildren&&r.variantChildren.add(t),()=>r.variantChildren.delete(t)}addValue(t,r){r!==this.values.get(t)&&(this.removeValue(t),this.bindToMotionValue(t,r)),this.values.set(t,r),this.latestValues[t]=r.get()}removeValue(t){this.values.delete(t);const r=this.valueSubscriptions.get(t);r&&(r(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,r){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&r!==void 0&&(s=Re(r,{owner:this}),this.addValue(t,s)),s}readValue(t){var r;return this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(r=this.getBaseTargetFromProps(this.props,t))!==null&&r!==void 0?r:this.readValueFromInstance(this.current,t,this.options)}setBaseTarget(t,r){this.baseTarget[t]=r}getBaseTarget(t){var r;const{initial:s}=this.props,n=typeof s=="string"||typeof s=="object"?(r=Sr(this.props,s))===null||r===void 0?void 0:r[t]:void 0;if(s&&n!==void 0)return n;const i=this.getBaseTargetFromProps(this.props,t);return i!==void 0&&!J(i)?i:this.initialValues[t]!==void 0&&n===void 0?void 0:this.baseTarget[t]}on(t,r){return this.events[t]||(this.events[t]=new Rr),this.events[t].add(r)}notify(t,...r){this.events[t]&&this.events[t].notify(...r)}}class Sn extends dd{sortInstanceNodePosition(t,r){return t.compareDocumentPosition(r)&2?1:-1}getBaseTargetFromProps(t,r){return t.style?t.style[r]:void 0}removeValueFromRenderState(t,{vars:r,style:s}){delete r[t],delete s[t]}makeTargetAnimatableFromInstance({transition:t,transitionEnd:r,...s},{transformValues:n},i){let a=Pl(s,t||{},this);if(n&&(r&&(r=n(r)),s&&(s=n(s)),a&&(a=n(a))),i){Nl(this,s,a);const l=nd(this,s,a,r);r=l.transitionEnd,s=l.target}return{transition:t,transitionEnd:r,...s}}}function ud(e){return window.getComputedStyle(e)}class hd extends Sn{constructor(){super(...arguments),this.type="html"}readValueFromInstance(t,r){if(Te.has(r)){const s=Er(r);return s&&s.default||0}else{const s=ud(t),n=(uo(r)?s.getPropertyValue(r):s[r])||0;return typeof n=="string"?n.trim():n}}measureInstanceViewportBox(t,{transformPagePoint:r}){return un(t,r)}build(t,r,s,n){vr(t,r,s,n.transformTemplate)}scrapeMotionValuesFromProps(t,r){return Cr(t,r)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;J(t)&&(this.childSubscription=t.on("change",r=>{this.current&&(this.current.textContent=`${r}`)}))}renderInstance(t,r,s,n){xo(t,r,s,n)}}class fd extends Sn{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1}getBaseTargetFromProps(t,r){return t[r]}readValueFromInstance(t,r){if(Te.has(r)){const s=Er(r);return s&&s.default||0}return r=yo.has(r)?r:pr(r),t.getAttribute(r)}measureInstanceViewportBox(){return q()}scrapeMotionValuesFromProps(t,r){return bo(t,r)}build(t,r,s,n){wr(t,r,s,this.isSVGTag,n.transformTemplate)}renderInstance(t,r,s,n){vo(t,r,s,n)}mount(t){this.isSVGTag=jr(t.tagName),super.mount(t)}}const md=(e,t)=>yr(e)?new fd(t,{enableHardwareAcceleration:!1}):new hd(t,{enableHardwareAcceleration:!0}),pd={layout:{ProjectionNode:bn,MeasureLayout:fn}},gd={...Ul,...la,...qc,...pd},xd=gi((e,t)=>Xi(e,t,gd,md));function yd(){return o.jsxs("div",{className:"flex gap-4",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-accent)"},children:o.jsx("span",{className:"text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:"AL"})}),o.jsxs("div",{className:"inline-flex items-center gap-1 p-4 rounded-lg",style:{backgroundColor:"var(--color-bg-secondary)"},children:[o.jsx("span",{className:"text-sm mr-2",style:{color:"var(--color-text-secondary)"},children:"AL-E is typing"}),[0,1,2].map(e=>o.jsx(xd.div,{className:"w-2 h-2 rounded-full",style:{backgroundColor:"var(--color-text-tertiary)"},animate:{scale:[1,1.2,1],opacity:[.5,1,.5]},transition:{duration:1,repeat:1/0,delay:e*.2}},e))]})]})}function vd({isOpen:e,onClose:t,initialContent:r,messageType:s,onSave:n}){const[i,a]=v.useState(r||""),[l,c]=v.useState("user"),[d,u]=v.useState(!1),[h,f]=v.useState(null),m=async()=>{if(!i.trim()){f("El contenido no puede estar vacío");return}u(!0),f(null);try{await n({content:i.trim(),type:s,scope:l}),t()}catch(y){f(y.message||"Error guardando memoria")}finally{u(!1)}};if(!e)return null;const g=s==="agreement"?"Acuerdo":"Hecho Importante",x=s==="agreement"?"Decisiones o compromisos que deben recordarse":"Información clave para el contexto del proyecto";return o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:o.jsxs("div",{className:"w-full max-w-2xl rounded-xl shadow-2xl",style:{backgroundColor:"var(--color-bg-primary)",border:"1px solid var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--color-border)"},children:[o.jsxs("div",{children:[o.jsxs("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:["Guardar como ",g]}),o.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:x})]}),o.jsx("button",{onClick:t,className:"p-2 rounded-lg transition-all",style:{color:"var(--color-text-secondary)"},onMouseEnter:y=>y.currentTarget.style.backgroundColor="var(--color-bg-hover)",onMouseLeave:y=>y.currentTarget.style.backgroundColor="transparent",children:o.jsx(Ne,{size:20})})]}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{className:"flex gap-3 p-3 rounded-lg",style:{backgroundColor:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.2)"},children:[o.jsx(Ve,{size:20,className:"flex-shrink-0 text-blue-400 mt-0.5"}),o.jsxs("div",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:[o.jsx("p",{className:"font-medium mb-1",style:{color:"var(--color-text-primary)"},children:"Esto permitirá que AL-E lo recuerde en el futuro"}),o.jsx("p",{children:"Solo se recordará lo que tú confirmes. Puedes editar el texto antes de guardar."})]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Contenido a recordar:"}),o.jsx("textarea",{value:i,onChange:y=>a(y.target.value),className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"120px"},placeholder:"Escribe o edita el contenido a recordar..."})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Alcance de la memoria:"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsxs("button",{onClick:()=>c("user"),className:`flex-1 p-3 rounded-lg border transition-all ${l==="user"?"ring-2":""}`,style:{backgroundColor:l==="user"?"var(--color-accent)":"var(--color-bg-secondary)",borderColor:l==="user"?"var(--color-accent)":"var(--color-border)",color:l==="user"?"#FFFFFF":"var(--color-text-primary)",ringColor:"var(--color-accent)"},children:[o.jsx("div",{className:"text-sm font-medium",children:"Personal"}),o.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Solo para ti en todos los proyectos"})]}),o.jsxs("button",{onClick:()=>c("project"),className:`flex-1 p-3 rounded-lg border transition-all ${l==="project"?"ring-2":""}`,style:{backgroundColor:l==="project"?"var(--color-accent)":"var(--color-bg-secondary)",borderColor:l==="project"?"var(--color-accent)":"var(--color-border)",color:l==="project"?"#FFFFFF":"var(--color-text-primary)",ringColor:"var(--color-accent)"},children:[o.jsx("div",{className:"text-sm font-medium",children:"Proyecto"}),o.jsx("div",{className:"text-xs mt-1 opacity-80",children:"Compartido con el equipo"})]})]})]}),h&&o.jsxs("div",{className:"flex items-center gap-2 p-3 rounded-lg",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)"},children:[o.jsx(Ve,{size:16,className:"text-red-400"}),o.jsx("p",{className:"text-sm text-red-400",children:h})]})]}),o.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t",style:{borderColor:"var(--color-border)"},children:[o.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg transition-all",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},disabled:d,children:"Cancelar"}),o.jsx("button",{onClick:m,className:"px-4 py-2 rounded-lg transition-all flex items-center gap-2",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},disabled:d||!i.trim(),children:d?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Guardando..."]}):o.jsxs(o.Fragment,{children:[o.jsx(qs,{size:16}),"Guardar Memoria"]})})]})]})})}const bd="https://api.al-eon.com";async function wd({content:e,type:t,scope:r="user",projectId:s,metadata:n={}}){try{const{data:{session:i}}=await O.auth.getSession();if(!(i!=null&&i.access_token))throw new Error("No hay sesión activa - Usuario no autenticado");const a=`${bd}/api/memory/save`,l={content:e,type:t,scope:r,...s&&{projectId:s},metadata:{...n,timestamp:new Date().toISOString(),source:"al-eon",userInitiated:!0}};console.log("💾 Guardando memoria:",{type:t,scope:r,content:e.substring(0,50)+"..."});const c=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.access_token}`},body:JSON.stringify(l)});if(!c.ok){const u=await c.text();throw new Error(`Error ${c.status}: ${u}`)}const d=await c.json();return console.log("✅ Memoria guardada:",d),d}catch(i){throw console.error("❌ Error guardando memoria:",i),i}}function jd({sources:e}){if(!e||e.length===0)return null;const t=s=>{switch(s){case"vision":return o.jsx(Xs,{size:14});case"pdf":case"docx":case"md":return o.jsx(Se,{size:14});case"code":return o.jsx(Ks,{size:14});default:return o.jsx(Se,{size:14})}},r=s=>s>=.8?"#10b981":s>=.6?"#f59e0b":"#ef4444";return o.jsxs("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("span",{className:"text-xs font-medium",style:{color:"var(--color-text-secondary)"},children:"Fuentes"}),o.jsx("span",{className:"text-xs px-2 py-0.5 rounded",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-tertiary)"},children:e.length})]}),o.jsx("div",{className:"space-y-2",children:e.map((s,n)=>o.jsxs("div",{className:"flex items-start gap-2 p-2 rounded text-xs",style:{backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)"},children:[o.jsx("div",{className:"flex-shrink-0 mt-0.5",style:{color:"var(--color-text-secondary)"},children:t(s.type)}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"font-mono truncate",style:{color:"var(--color-text-primary)"},children:[s.repo||"docs","/",s.path]}),s.type&&o.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[o.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] uppercase font-medium",style:{backgroundColor:"var(--color-bg-primary)",color:"var(--color-text-tertiary)"},children:s.type}),s.score!==void 0&&o.jsxs("span",{className:"text-[10px] font-medium",style:{color:r(s.score)},children:[Math.round(s.score*100),"% match"]})]})]})]},n))})]})}function Cd(){return o.jsx("div",{className:"mt-3 pt-3 border-t",style:{borderColor:"var(--color-border)"},children:o.jsxs("div",{className:"flex items-center gap-2 p-2 rounded text-xs",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[o.jsx(Ve,{size:14,className:"text-red-500 flex-shrink-0"}),o.jsx("span",{style:{color:"var(--color-text-primary)"},children:"Sin evidencia - Respuesta sin fuentes verificadas"})]})})}function Sd({attachment:e}){const{name:t,type:r,status:s,extractedText:n,processingStatus:i}=e,a=()=>r!=null&&r.startsWith("image/")?o.jsx(Xs,{size:14}):o.jsx(Se,{size:14}),c=(()=>s==="processing"||i==="processing"?{icon:o.jsx(Ys,{size:14,className:"animate-spin"}),text:"Procesando",color:"var(--color-text-secondary)",bg:"var(--color-bg-tertiary)"}:s==="indexed"||i==="indexed"?{icon:o.jsx(Fr,{size:14}),text:"Indexado en Knowledge Core",color:"#10b981",bg:"rgba(16, 185, 129, 0.1)"}:s==="vision_extracted"||i==="vision_extracted"?{icon:o.jsx(Fr,{size:14}),text:"Texto extraído",color:"#10b981",bg:"rgba(16, 185, 129, 0.1)"}:s==="error"||i==="error"?{icon:o.jsx(Ut,{size:14}),text:"Error al procesar",color:"#ef4444",bg:"rgba(239, 68, 68, 0.1)"}:null)();return o.jsxs("div",{className:"flex items-start gap-3 p-3 rounded text-xs",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:[o.jsx("div",{className:"flex-shrink-0 mt-0.5",style:{color:"var(--color-text-secondary)"},children:a()}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-medium truncate mb-1",style:{color:"var(--color-text-primary)"},children:t}),c&&o.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[o.jsx("div",{style:{color:c.color},children:c.icon}),o.jsx("span",{style:{color:c.color},children:c.text})]}),n&&o.jsxs("div",{className:"mt-2 p-2 rounded text-[11px] font-mono",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-secondary)",maxHeight:"120px",overflowY:"auto"},children:[o.jsx("div",{className:"font-semibold mb-1",style:{color:"var(--color-text-primary)"},children:"Texto detectado:"}),o.jsx("div",{className:"whitespace-pre-wrap",children:n})]}),(s==="indexed"||i==="indexed")&&o.jsx("button",{className:"mt-2 px-2 py-1 rounded text-[11px] font-medium transition-all",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},onClick:()=>{console.log("Usar documento como contexto:",t)},children:"Usar este documento como contexto"})]})]})}function Nd({attachments:e}){return!e||e.length===0?null:o.jsx("div",{className:"space-y-2 mb-3",children:e.map((t,r)=>o.jsx(Sd,{attachment:t},r))})}function Td({toolName:e}){const t=e.replace(/_/g," ");return o.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium",style:{backgroundColor:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"rgb(34, 197, 94)"},children:[o.jsx(In,{className:"w-3 h-3"}),o.jsx("span",{children:t})]})}function Pd(){return o.jsxs("div",{className:"inline-flex items-center gap-1 px-2 py-1 rounded-md text-xs font-medium",style:{backgroundColor:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)",color:"rgb(251, 191, 36)"},title:"AL-E ajustó automáticamente la respuesta para continuar",children:[o.jsx(Ve,{className:"w-3 h-3"}),o.jsx("span",{children:"Recuperación automática"})]})}function kd({toolsUsed:e,metadata:t}){const r=(t==null?void 0:t.tool_call_parsed)==="fail"||(t==null?void 0:t.fallback_invoked)===!0,s=e&&Array.isArray(e)&&e.length>0;return!s&&!r?null:o.jsxs("div",{className:"flex gap-1 flex-wrap mt-2",children:[s&&e.map((n,i)=>o.jsx(Td,{toolName:n},`${n}-${i}`)),r&&o.jsx(Pd,{})]})}function Ed({metadata:e,executionTime:t}){if(!e&&!t)return null;const r=e!=null&&e.model?e.model.replace(/^(groq|openai|fireworks)\//,""):null,s=t||(e==null?void 0:e.execution_time)||0;return o.jsxs("div",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:[r&&o.jsx("span",{children:r}),r&&s>0&&o.jsx("span",{children:" • "}),s>0&&o.jsxs("span",{children:[s,"ms"]})]})}function Ad({error:e,message:t}){const r=gt(),s=(t==null?void 0:t.includes("NO_EMAIL_ACCOUNTS"))||(t==null?void 0:t.includes("sin cuentas de correo"))||(t==null?void 0:t.includes("no tienes cuentas de correo configuradas")),n=(t==null?void 0:t.includes("NO_ACTIVE_ACCOUNTS"))||(t==null?void 0:t.includes("cuentas inactivas"))||(t==null?void 0:t.includes("ninguna está activa")),i=(t==null?void 0:t.includes("DATABASE_ERROR"))||(t==null?void 0:t.includes("Error de conexión"))||(t==null?void 0:t.includes("No pude conectar")),a=(t==null?void 0:t.includes("timeout"))||(t==null?void 0:t.includes("Tiempo de espera"));return s?o.jsxs("div",{className:"flex gap-3 p-4 rounded-lg",style:{backgroundColor:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[o.jsx(Js,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"rgb(251, 191, 36)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"rgb(251, 191, 36)"},children:"Sin cuentas de correo"}),o.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text-secondary)"},children:"Para usar esta función, configura una cuenta en Email Hub."}),o.jsx("button",{onClick:()=>r("/settings/email"),className:"text-sm font-medium underline hover:opacity-80 transition-opacity",style:{color:"rgb(251, 191, 36)"},children:"Configurar ahora →"})]})]}):n?o.jsxs("div",{className:"flex gap-3 p-4 rounded-lg",style:{backgroundColor:"rgba(251, 191, 36, 0.1)",border:"1px solid rgba(251, 191, 36, 0.3)"},children:[o.jsx(Ve,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"rgb(251, 191, 36)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"rgb(251, 191, 36)"},children:"Cuentas inactivas"}),o.jsx("p",{className:"text-sm mb-2",style:{color:"var(--color-text-secondary)"},children:"Tienes cuentas configuradas pero ninguna está activa. Reactívalas en configuración."}),o.jsx("button",{onClick:()=>r("/settings/email"),className:"text-sm font-medium underline hover:opacity-80 transition-opacity",style:{color:"rgb(251, 191, 36)"},children:"Ir a configuración →"})]})]}):a?o.jsxs("div",{className:"flex gap-3 p-4 rounded-lg",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[o.jsx(Dn,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"rgb(239, 68, 68)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"rgb(239, 68, 68)"},children:"Tiempo de espera agotado"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"La operación tardó demasiado tiempo. Por favor, intenta nuevamente."})]})]}):i?o.jsxs("div",{className:"flex gap-3 p-4 rounded-lg",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[o.jsx(Ut,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"rgb(239, 68, 68)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"rgb(239, 68, 68)"},children:"Error técnico"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:"No pude conectar con el servidor. Por favor, intenta nuevamente."})]})]}):o.jsxs("div",{className:"flex gap-3 p-4 rounded-lg",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[o.jsx(Ut,{className:"w-5 h-5 flex-shrink-0 mt-0.5",style:{color:"rgb(239, 68, 68)"}}),o.jsxs("div",{className:"flex-1",children:[o.jsx("h4",{className:"font-semibold text-sm mb-1",style:{color:"rgb(239, 68, 68)"},children:"Error"}),o.jsx("p",{className:"text-sm",style:{color:"var(--color-text-secondary)"},children:t||e||"Ocurrió un error inesperado"})]})]})}function Dd({message:e}){const[t,r]=v.useState(!1);if(!e.metadata&&!e.debug&&!e.toolsUsed)return null;const s={metadata:e.metadata||null,debug:e.debug||null,toolsUsed:e.toolsUsed||[],executionTime:e.executionTime||0};return o.jsxs("div",{className:"mt-2 border-t pt-2",style:{borderColor:"var(--color-border)"},children:[o.jsxs("button",{onClick:()=>r(!t),className:"flex items-center gap-1 text-xs hover:opacity-80 transition-opacity",style:{color:"var(--color-text-tertiary)"},children:[o.jsx(Ks,{className:"w-3 h-3"}),o.jsx("span",{children:"Ver logs técnicos"}),t?o.jsx(Kn,{className:"w-3 h-3"}):o.jsx(Xe,{className:"w-3 h-3"})]}),t&&o.jsxs("div",{className:"mt-2",children:[o.jsx("pre",{className:"text-xs p-2 rounded overflow-x-auto",style:{backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)",color:"var(--color-text-secondary)"},children:JSON.stringify(s,null,2)}),e.metadata&&o.jsxs("div",{className:"mt-2 space-y-1 text-xs",style:{color:"var(--color-text-tertiary)"},children:[o.jsxs("div",{children:["Request ID: ",e.metadata.request_id]}),o.jsxs("div",{children:["Timestamp: ",e.metadata.timestamp]}),o.jsxs("div",{children:["Tools executed: ",e.metadata.tools_executed]}),o.jsxs("div",{children:["Source: ",e.metadata.source]})]})]})]})}function Md({startTime:e}){const[t,r]=v.useState(0);v.useEffect(()=>{const n=setInterval(()=>{r(Math.floor((Date.now()-e)/1e3))},1e3);return()=>clearInterval(n)},[e]);const s=n=>{if(n<60)return`${n}s`;const i=Math.floor(n/60),a=n%60;return`${i}m ${a}s`};return o.jsxs("div",{className:"flex items-center gap-2 text-xs",style:{color:"var(--color-text-secondary)"},children:[o.jsxs("span",{children:["Procesando... ",s(t)]}),t>30&&o.jsx("span",{className:"text-yellow-600 dark:text-yellow-400",children:"(operación larga, puede tardar hasta 60s)"})]})}function Vd({conversation:e,isLoading:t,voiceMode:r,handsFree:s,onToggleHandsFree:n,onToggleSidebar:i,onStopResponse:a,onRegenerateResponse:l,currentUser:c,assistantName:d,assistantAvatar:u,userAvatar:h}){const f=v.useRef(null);gt();const[m,g]=v.useState(window.innerWidth<768),[x,y]=v.useState(null);v.useEffect(()=>{const p=()=>g(window.innerWidth<768);return window.addEventListener("resize",p),()=>window.removeEventListener("resize",p)},[]),v.useEffect(()=>{y(t?Date.now():null)},[t]),v.useEffect(()=>{f.current&&(f.current.scrollTop=f.current.scrollHeight)},[e==null?void 0:e.messages,t]);const b=()=>{i()};return o.jsxs("div",{className:"h-full flex flex-col",style:{maxWidth:"100vw",width:"100%",overflowX:"hidden"},children:[o.jsxs("div",{className:"p-3 md:p-4 border-b flex items-center justify-between gap-2 md:gap-3 flex-wrap",style:{borderColor:"var(--color-border)",maxWidth:"100%"},children:[o.jsxs("div",{className:"flex items-center gap-2 md:gap-3 min-w-0 flex-1",children:[o.jsx("button",{onClick:b,className:"p-2 rounded-lg transition-all flex-shrink-0",style:{color:"var(--color-text-secondary)"},onMouseEnter:p=>{p.currentTarget.style.backgroundColor="var(--color-bg-hover)"},onMouseLeave:p=>{p.currentTarget.style.backgroundColor="transparent"},title:"Abrir menú",children:o.jsx(On,{size:20})}),o.jsx("span",{className:"font-semibold text-base md:text-lg truncate",style:{color:"var(--color-text-primary)"},children:(e==null?void 0:e.title)||"AL-E Chat"})]}),r&&o.jsx("div",{className:"flex items-center gap-1.5 md:gap-2 flex-shrink-0",children:r&&o.jsxs(o.Fragment,{children:[r.status!=="idle"&&o.jsxs("div",{className:`flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5 rounded-full text-xs font-medium ${r.status==="listening"?"bg-green-900/30 text-green-400 border border-green-700":r.status==="processing"?"bg-blue-900/30 text-blue-400 border border-blue-700":"bg-gray-700 text-gray-300 border border-gray-600"}`,children:[r.status==="listening"&&o.jsxs(o.Fragment,{children:[o.jsx(Ir,{size:12,"md:size":14,className:"animate-pulse"})," ",o.jsx("span",{className:"hidden sm:inline",children:"Escuchando"})]}),r.status==="processing"&&o.jsxs(o.Fragment,{children:[o.jsx("span",{className:"hidden sm:inline",children:"Procesando..."}),o.jsx("span",{className:"sm:hidden",children:"..."})]}),r.status==="speaking"&&o.jsxs(o.Fragment,{children:[o.jsx(zn,{size:12,"md:size":14,className:"animate-pulse"})," ",o.jsx("span",{className:"hidden sm:inline",children:"AL-E habla"})]})]}),o.jsx("button",{onClick:()=>{if(console.log("🎯 [MessageThread] Click en botón modo voz/texto"),console.log("🎯 voiceMode:",r),console.log("🎯 voiceMode.mode:",r==null?void 0:r.mode),console.log("🎯 voiceMode.setMode:",typeof(r==null?void 0:r.setMode)),r!=null&&r.setMode){const p=r.mode==="text"?"voice":"text";console.log("🎯 Cambiando a modo:",p),r.setMode(p)}else console.error("❌ voiceMode.setMode no está disponible")},className:`flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1.5 rounded-full text-xs font-medium transition-all ${r.mode==="voice"?"bg-gray-700 text-white border border-gray-600":"bg-transparent text-gray-400 hover:bg-gray-800 border border-gray-700"}`,children:r.mode==="voice"?o.jsxs(o.Fragment,{children:[o.jsx(Br,{size:12,"md:size":14})," ",o.jsx("span",{className:"hidden sm:inline",children:"Voz"})]}):o.jsxs(o.Fragment,{children:[o.jsx(cr,{size:12,"md:size":14})," ",o.jsx("span",{className:"hidden sm:inline",children:"Texto"})]})}),r.mode==="voice"&&o.jsx("button",{onClick:()=>{console.log("🔥🔥🔥 [MessageThread] CLICK EN MICRÓFONO"),console.log("[VoiceUI] voiceMode:",r),console.log("[VoiceUI] voiceMode.startListening existe?",typeof r.startListening),console.log("[VoiceUI] isListening:",r==null?void 0:r.isListening),r.isListening?(console.log("🛑 Deteniendo grabación..."),r.stopAll()):(console.log("🎤 Iniciando grabación..."),r.startListening())},className:`p-2 rounded-full transition-all ${r.isListening?"bg-red-600 text-white animate-pulse":"bg-gray-700 text-white hover:bg-gray-600 border border-gray-600"}`,children:o.jsx(Ir,{size:14,"md:size":16})}),r.mode==="voice"&&o.jsxs("button",{onClick:n,className:`flex items-center gap-1.5 px-2 md:px-3 py-1.5 rounded-full text-xs font-medium transition-all ${s?"bg-blue-600 text-white border border-blue-500":"bg-transparent text-gray-400 hover:bg-gray-800 border border-gray-700"}`,title:s?"Desactivar manos libres":"Activar manos libres",children:[o.jsx(Br,{size:12,"md:size":14}),o.jsx("span",{className:"hidden sm:inline",children:"Manos Libres"})]})]})})]}),o.jsx("div",{ref:f,className:"flex-1 overflow-y-auto overflow-x-hidden p-3 md:p-4 scroll-smooth",style:{maxWidth:"100%"},children:!e||e.messages.length===0?o.jsx("div",{className:"h-full flex items-center justify-center px-4",children:o.jsxs("div",{className:"text-center max-w-md w-full",children:[o.jsx("img",{src:"/Logo AL-E sobre fondo negro.png",alt:"AL-E Logo",className:"w-32 md:w-48 h-auto mx-auto mb-4 md:mb-6"}),o.jsx("h2",{className:"text-xl md:text-2xl font-semibold mb-2",style:{color:"var(--color-text-primary)"},children:"¿Cómo puede ayudarte AL-E hoy?"}),o.jsx("p",{className:"text-sm md:text-base",style:{color:"var(--color-text-secondary)"},children:"Inicia una conversación para comenzar a chatear con AL-E"})]})}):o.jsxs("div",{className:"space-y-4 md:space-y-6 max-w-4xl mx-auto",children:[e.messages.map(p=>o.jsx(Rd,{message:p,currentUser:c,assistantName:d,assistantAvatar:u,userAvatar:h},p.id)),t&&o.jsxs("div",{className:"space-y-3",children:[o.jsx(yd,{}),x&&o.jsx(Md,{startTime:x}),o.jsx("div",{className:"flex justify-start",children:o.jsxs("button",{onClick:a,className:"flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg transition-all hover:opacity-80 text-sm",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-secondary)"},children:[o.jsx(ri,{size:14,"md:size":16}),o.jsx("span",{className:"font-medium",children:"Detener"})]})})]}),!t&&e.messages.length>0&&e.messages[e.messages.length-1].role==="assistant"&&o.jsx("div",{className:"flex justify-start",children:o.jsxs("button",{onClick:l,className:"flex items-center gap-2 px-3 md:px-4 py-2 rounded-lg transition-all hover:opacity-80 text-sm",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-secondary)"},children:[o.jsx(Un,{size:14,"md:size":16}),o.jsx("span",{className:"font-medium",children:"Regenerar"})]})})]})})]})}function Rd({message:e,currentUser:t,assistantName:r="Luma",assistantAvatar:s,userAvatar:n}){const i=e.role==="user",a=e.isError,[l,c]=v.useState(!1),[d,u]=v.useState(!1),[h,f]=v.useState(null),{toast:m}=ar(),[g,x]=v.useState(()=>localStorage.getItem("ale-debug-mode")==="true");console.log("🔍 [Message] assistantAvatar:",s),console.log("🔍 [Message] userAvatar:",n),console.log("🔍 [Message] assistantName:",r),console.log("🔍 [Message] isUser:",i);const y=()=>t?t.charAt(0).toUpperCase():"U",b=()=>{if(!r)return"AL";const C=r.trim().split(" ");return C.length>=2?(C[0].charAt(0)+C[1].charAt(0)).toUpperCase():r.substring(0,2).toUpperCase()},p=async()=>{try{await navigator.clipboard.writeText(e.content),c(!0),setTimeout(()=>c(!1),2e3)}catch(C){console.error("❌ Error copiando texto:",C)}},j=C=>{f(C),u(!0)},w=async({content:C,type:P,scope:T})=>{try{await wd({content:C,type:P,scope:T}),m({title:"Memoria guardada",description:`${P==="agreement"?"Acuerdo":"Hecho"} guardado exitosamente. AL-E lo recordará.`,duration:3e3}),u(!1)}catch(N){throw m({variant:"destructive",title:"Error",description:N.message||"No se pudo guardar la memoria",duration:5e3}),N}};return o.jsxs(o.Fragment,{children:[o.jsx(vd,{isOpen:d,onClose:()=>u(!1),initialContent:e.content,messageType:h,onSave:w}),o.jsxs("div",{className:`flex gap-2 md:gap-4 ${i?"justify-end":"justify-start"} group`,style:{maxWidth:"100%"},children:[!i&&o.jsx("div",{className:"w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",style:{backgroundColor:s?"transparent":"var(--color-accent)",border:s?"2px solid var(--color-accent)":"none"},children:s?o.jsx("img",{src:s,alt:r,className:"w-full h-full object-cover"}):o.jsx("span",{className:"text-xs md:text-sm font-semibold",style:{color:"#FFFFFF"},children:b()})}),o.jsxs("div",{className:`flex-1 max-w-[85%] md:max-w-3xl ${i?"text-right":""}`,style:{overflowWrap:"break-word",wordBreak:"break-word"},children:[o.jsxs("div",{className:`inline-block p-3 md:p-4 rounded-xl relative ${i?"text-left":""}`,style:{backgroundColor:i?"var(--color-accent)":a?"rgba(239, 68, 68, 0.1)":"var(--color-bg-secondary)",color:i?"#FFFFFF":"var(--color-text-primary)",maxWidth:"100%",overflowWrap:"break-word",wordBreak:"break-word"},children:[o.jsx("button",{onClick:p,className:"absolute top-2 right-2 p-1.5 rounded-md transition-all opacity-0 group-hover:opacity-100",style:{backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)"},title:l?"Copiado!":"Copiar mensaje",children:l?o.jsx(lr,{size:14,className:"text-green-500"}):o.jsx(Xn,{size:14,style:{color:"var(--color-text-secondary)"}})}),a&&o.jsx(Ad,{error:e.error,message:e.content}),!a&&e.attachments&&e.attachments.length>0&&o.jsx(Nd,{attachments:e.attachments}),!a&&o.jsx("div",{className:"text-sm md:text-base",children:o.jsx(ni,{content:e.content})}),!i&&!a&&e.toolsUsed&&o.jsx(kd,{toolsUsed:e.toolsUsed,metadata:e.metadata}),!i&&!a&&(e.metadata||e.executionTime)&&o.jsx(Ed,{metadata:e.metadata,executionTime:e.executionTime}),!i&&!a&&e.sources&&e.sources.length>0&&o.jsx(jd,{sources:e.sources}),!i&&!a&&e.noSources===!0&&o.jsx(Cd,{}),!i&&!a&&g&&o.jsx(Dd,{message:e})]}),!a&&o.jsxs("div",{className:`mt-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-all ${i?"justify-end":"justify-start"}`,children:[o.jsxs("button",{onClick:()=>j("agreement"),className:"flex items-center gap-1.5 px-2 py-1 rounded-md text-xs transition-all",style:{backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)",color:"var(--color-text-secondary)"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="var(--color-accent)",C.currentTarget.style.color="#FFFFFF"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="var(--color-bg-tertiary)",C.currentTarget.style.color="var(--color-text-secondary)"},title:"Guardar este acuerdo o decisión para recordarlo después",children:[o.jsx(qn,{size:12}),o.jsx("span",{children:"Guardar acuerdo"})]}),o.jsxs("button",{onClick:()=>j("fact"),className:"flex items-center gap-1.5 px-2 py-1 rounded-md text-xs transition-all",style:{backgroundColor:"var(--color-bg-tertiary)",border:"1px solid var(--color-border)",color:"var(--color-text-secondary)"},onMouseEnter:C=>{C.currentTarget.style.backgroundColor="var(--color-accent)",C.currentTarget.style.color="#FFFFFF"},onMouseLeave:C=>{C.currentTarget.style.backgroundColor="var(--color-bg-tertiary)",C.currentTarget.style.color="var(--color-text-secondary)"},title:"Guardar este hecho importante para el contexto del proyecto",children:[o.jsx(Se,{size:12}),o.jsx("span",{children:"Guardar hecho"})]})]}),o.jsx("div",{className:"mt-1 text-xs",style:{color:"var(--color-text-tertiary)"},children:new Date(e.timestamp).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})})]}),i&&o.jsx("div",{className:"w-7 h-7 md:w-8 md:h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden",style:{backgroundColor:n?"transparent":"var(--color-bg-secondary)",border:n?"2px solid var(--color-accent)":"none"},children:n?o.jsx("img",{src:n,alt:t,className:"w-full h-full object-cover"}):o.jsx("span",{className:"text-xs md:text-sm font-semibold",style:{color:"var(--color-text-primary)"},children:y()})})]})]})}const Ld=Tn("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-[var(--color-accent)] text-white hover:bg-[var(--color-accent-hover)]",destructive:"bg-[var(--color-error)] text-white hover:opacity-90",outline:"border border-[var(--color-border)] bg-transparent hover:bg-[var(--color-bg-hover)]",secondary:"bg-[var(--color-bg-secondary)] text-white hover:bg-[var(--color-bg-tertiary)]",ghost:"hover:bg-[var(--color-bg-hover)] hover:text-white",link:"text-[var(--color-accent)] underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),or=ir.forwardRef(({className:e,variant:t,size:r,asChild:s=!1,...n},i)=>{const a=s?Pn:"button";return o.jsx(a,{className:Gs(Ld({variant:t,size:r,className:e})),ref:i,...n})});or.displayName="Button";function Fd({onSendMessage:e,isLoading:t,isUploading:r,disabled:s,sessionId:n,onWebToggle:i,webEnabled:a}){const[l,c]=v.useState(""),[d,u]=v.useState([]);v.useState(!1);const[h,f]=v.useState(!1),m=v.useRef(null),g=v.useRef(null),{toast:x}=ar(),{user:y}=Ke(),b=E=>{if(E.preventDefault(),l.trim().startsWith("/image ")){const I=l.trim().substring(7);if(I){e(`/image ${I}`,d),c(""),u([]);return}}if(!(!l.trim()&&d.length===0)){if(s){x({title:"Sin conversación",description:"Por favor crea una nueva conversación primero",variant:"destructive"});return}console.log("📤 SENDING MESSAGE WITH ATTACHMENTS:",d),e(l,d),c(""),u([]),m.current&&(m.current.style.height="auto")}},p=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),b(E))},j=E=>{if(!(y!=null&&y.id)){x({title:"Error de sesión",description:"No se pueden subir archivos. Por favor recarga la página e inicia sesión nuevamente.",variant:"destructive"}),g.current&&(g.current.value="");return}const I=Array.from(E.target.files||[]);console.log("📎 FILES SELECTED:",I),u(L=>[...L,...I]),g.current&&(g.current.value="")},w=E=>{var B;const I=(B=E.clipboardData)==null?void 0:B.items;if(!I)return;const L=[];for(let S=0;S<I.length;S++){const F=I[S];if(F.type.indexOf("image")!==-1){E.preventDefault();const k=F.getAsFile();if(k){const _=k.name||`screenshot-${Date.now()}.png`,D=new File([k],_,{type:k.type});L.push(D)}}}L.length>0&&(console.log("📋 IMAGES PASTED:",L),u(S=>[...S,...L]),x({title:"✅ Imágenes pegadas",description:`${L.length} imagen(es) agregadas. Listas para enviar.`}))},C=E=>{u(I=>I.filter((L,B)=>B!==E))},P=E=>{c(E.target.value),m.current&&(m.current.style.height="auto",m.current.style.height=`${Math.min(m.current.scrollHeight,200)}px`)},T=E=>{E.preventDefault(),E.stopPropagation(),f(!0)},N=E=>{E.preventDefault(),E.stopPropagation(),f(!1)},R=E=>{var L;E.preventDefault(),E.stopPropagation(),f(!1);const I=Array.from(((L=E.dataTransfer)==null?void 0:L.files)||[]).filter(B=>B.type.startsWith("image/")||B.type.startsWith("application/pdf"));I.length>0&&(console.log("📎 FILES DROPPED:",I),u(B=>[...B,...I]),x({title:"✅ Archivos agregados",description:`${I.length} archivo(s) listos para enviar`}))};return o.jsx("div",{className:"p-3 md:p-4 border-t",style:{borderColor:"var(--color-border)",maxWidth:"100vw",overflowX:"hidden"},children:o.jsxs("form",{onSubmit:b,className:"max-w-4xl mx-auto",style:{maxWidth:"100%"},children:[r&&o.jsxs("div",{className:"mb-2 md:mb-3 px-3 md:px-4 py-2 rounded-2xl flex items-center gap-2 text-xs md:text-sm",style:{backgroundColor:"var(--color-bg-tertiary)",color:"var(--color-text-secondary)"},children:[o.jsx("div",{className:"animate-spin h-3 w-3 md:h-4 md:w-4 border-2 border-current border-t-transparent rounded-full"}),o.jsx("span",{children:"Procesando documentos..."})]}),d.length>0&&o.jsx("div",{className:"mb-2 md:mb-3 flex flex-wrap gap-1.5 md:gap-2",children:d.map((E,I)=>o.jsxs("div",{className:"inline-flex items-center gap-1.5 md:gap-2 px-2 md:px-3 py-1 md:py-1.5 rounded-full text-xs md:text-sm",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)"},children:[o.jsx(Or,{size:12,className:"md:w-3.5 md:h-3.5 flex-shrink-0"}),o.jsx("span",{className:"truncate max-w-[100px] md:max-w-[150px]",children:E.name}),o.jsx("button",{type:"button",onClick:()=>C(I),className:"hover:opacity-70 transition-opacity flex-shrink-0",children:o.jsx(Ne,{size:12,className:"md:w-3.5 md:h-3.5"})})]},I))}),o.jsxs("div",{className:"flex items-end gap-1.5 md:gap-2 p-1.5 md:p-2 rounded-2xl transition-all duration-200",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)"},children:[o.jsx("input",{ref:g,type:"file",multiple:!0,className:"hidden",onChange:j}),o.jsx(or,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var E;return(E=g.current)==null?void 0:E.click()},disabled:t||r||s,className:"flex-shrink-0 rounded-2xl h-9 w-9 md:h-10 md:w-10",children:o.jsx(Or,{size:18,className:"md:w-5 md:h-5",style:{color:"var(--color-text-secondary)"}})}),o.jsx("textarea",{ref:m,value:l,onChange:P,onKeyDown:p,onPaste:w,onDragOver:T,onDragLeave:N,onDrop:R,placeholder:s?"Nueva conversación...":r?"Procesando...":"Escribe tu mensaje o arrastra imágenes...",disabled:t||r||s,rows:1,className:`flex-1 bg-transparent resize-none outline-none px-1 md:px-2 py-2 text-sm md:text-base transition-all ${h?"ring-2 ring-offset-2":""}`,style:{color:"var(--color-text-primary)",minHeight:"24px",maxHeight:"120px",ringColor:h?"var(--color-accent)":"transparent"}}),o.jsx(or,{type:"submit",size:"icon",disabled:!l.trim()&&d.length===0||t||r||s,className:"flex-shrink-0 transition-all duration-200 rounded-2xl h-9 w-9 md:h-10 md:w-10",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},children:o.jsx(Zs,{size:16,className:"md:w-[18px] md:h-[18px]"})})]}),o.jsx("p",{className:"text-xs mt-2 text-center hidden md:block",style:{color:"var(--color-text-tertiary)"},children:"Press Enter to send, Shift+Enter for new line"})]})})}function Id({className:e=""}){const{theme:t,toggleTheme:r}=kn();return o.jsx("button",{onClick:r,className:`p-2 rounded-lg transition-colors hover:bg-gray-800/50 dark:hover:bg-gray-700/50 ${e}`,title:`Cambiar a modo ${t==="dark"?"claro":"oscuro"}`,"aria-label":"Toggle theme",children:t==="dark"?o.jsx(Mn,{size:20,className:"text-gray-400"}):o.jsx(Vn,{size:20,className:"text-gray-600"})})}const Od=["📁","🚀","💼","🎯","📊","💡","🔬","🎨","📱","⚡","🌟","🔥"],_d=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#6B7280","#14B8A6"];function Bd({isOpen:e,onClose:t,onSave:r,project:s=null}){const[n,i]=v.useState((s==null?void 0:s.name)||""),[a,l]=v.useState((s==null?void 0:s.description)||""),[c,d]=v.useState((s==null?void 0:s.color)||"#3B82F6"),[u,h]=v.useState((s==null?void 0:s.icon)||"📁"),[f,m]=v.useState(!1),[g,x]=v.useState(null),y=!!s,b=async()=>{if(!n.trim()){x("El nombre del proyecto es requerido");return}m(!0),x(null);try{await r({name:n.trim(),description:a.trim(),color:c,icon:u}),t()}catch(p){x(p.message||"Error guardando proyecto")}finally{m(!1)}};return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:o.jsxs("div",{className:"w-full max-w-lg rounded-xl shadow-2xl",style:{backgroundColor:"var(--color-bg-primary)",border:"1px solid var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"text-2xl",children:u}),o.jsx("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:y?"Editar Proyecto":"Nuevo Proyecto"})]}),o.jsx("button",{onClick:t,className:"p-2 rounded-lg transition-all",style:{color:"var(--color-text-secondary)"},onMouseEnter:p=>p.currentTarget.style.backgroundColor="var(--color-bg-hover)",onMouseLeave:p=>p.currentTarget.style.backgroundColor="transparent",children:o.jsx(Ne,{size:20})})]}),o.jsxs("div",{className:"p-4 space-y-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Nombre del proyecto *"}),o.jsx("input",{type:"text",value:n,onChange:p=>i(p.target.value),className:"w-full p-3 rounded-lg border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)"},placeholder:"Ej: Startup Ideas, Data Analysis...",maxLength:50,autoFocus:!0}),o.jsxs("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:[n.length,"/50 caracteres"]})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Descripción (opcional)"}),o.jsx("textarea",{value:a,onChange:p=>l(p.target.value),className:"w-full p-3 rounded-lg border resize-none",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",color:"var(--color-text-primary)",minHeight:"80px"},placeholder:"Breve descripción del proyecto...",maxLength:200})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Icono"}),o.jsx("div",{className:"grid grid-cols-6 gap-2",children:Od.map(p=>o.jsx("button",{onClick:()=>h(p),className:`text-2xl p-2 rounded-lg transition-all ${u===p?"ring-2":""}`,style:{backgroundColor:u===p?"var(--color-accent)":"var(--color-bg-secondary)",borderColor:"var(--color-border)",border:"1px solid",ringColor:"var(--color-accent)"},children:p},p))})]}),o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium mb-2",style:{color:"var(--color-text-primary)"},children:"Color"}),o.jsx("div",{className:"grid grid-cols-8 gap-2",children:_d.map(p=>o.jsx("button",{onClick:()=>d(p),className:`w-10 h-10 rounded-lg transition-all ${c===p?"ring-2 ring-offset-2":""}`,style:{backgroundColor:p,ringColor:p,ringOffsetColor:"var(--color-bg-primary)"},title:p},p))})]}),g&&o.jsx("div",{className:"p-3 rounded-lg text-sm",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.2)",color:"#EF4444"},children:g})]}),o.jsxs("div",{className:"flex items-center justify-end gap-3 p-4 border-t",style:{borderColor:"var(--color-border)"},children:[o.jsx("button",{onClick:t,className:"px-4 py-2 rounded-lg transition-all",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},disabled:f,children:"Cancelar"}),o.jsx("button",{onClick:b,className:"px-4 py-2 rounded-lg transition-all flex items-center gap-2",style:{backgroundColor:c,color:"#FFFFFF"},disabled:f||!n.trim(),children:f?o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Guardando..."]}):o.jsxs(o.Fragment,{children:[y?o.jsx(qs,{size:16}):o.jsx(to,{size:16}),y?"Guardar Cambios":"Crear Proyecto"]})})]})]})}):null}async function zd(e){const{data:t,error:r}=await O.from("project_members_view").select("*").eq("project_id",e).order("role",{ascending:!1});if(r)throw r;return t||[]}async function Ud(e,t,r="member"){const{data:s,error:n}=await O.rpc("invite_user_to_project",{p_project_id:e,p_user_email:t,p_role:r});if(n)throw n;return s}async function $d(e,t){const{error:r}=await O.from("project_members").delete().eq("project_id",e).eq("user_id",t);if(r)throw r;return{success:!0}}async function Wd(e,t,r){const{error:s}=await O.from("project_members").update({role:r,updated_at:new Date().toISOString()}).eq("project_id",e).eq("user_id",t);if(s)throw s;return{success:!0}}async function Hd(e){const{data:{user:t}}=await O.auth.getUser();if(!t)return!1;const{data:r}=await O.from("user_projects").select("user_id").eq("id",e).single();return(r==null?void 0:r.user_id)===t.id}const _t={owner:{label:"Propietario",icon:Yn,color:"text-yellow-500"},editor:{label:"Editor",icon:dr,color:"text-blue-500"},viewer:{label:"Visor",icon:$n,color:"text-gray-500"}};function Gd({isOpen:e,onClose:t,project:r}){const[s,n]=v.useState([]),[i,a]=v.useState(""),[l,c]=v.useState("editor"),[d,u]=v.useState(!1),[h,f]=v.useState(null),[m,g]=v.useState(!1);v.useEffect(()=>{e&&r&&(y(),x())},[e,r]);const x=async()=>{if(!r)return;const w=await Hd(r.id);g(w)},y=async()=>{try{u(!0);const w=await zd(r.id);n(w),f(null)}catch(w){console.error("Error cargando miembros:",w),f("No se pudo cargar la lista de miembros")}finally{u(!1)}},b=async w=>{if(w.preventDefault(),!!i.trim())try{u(!0),f(null);const C=await Ud(r.id,i,l);C.success?(a(""),c("editor"),await y()):f(C.error||"Error al invitar usuario")}catch(C){console.error("Error invitando usuario:",C),f(C.message||"No se pudo enviar la invitación")}finally{u(!1)}},p=async w=>{if(confirm("¿Eliminar este miembro del proyecto?"))try{u(!0),await $d(r.id,w),await y()}catch(C){console.error("Error removiendo miembro:",C),f("No se pudo eliminar el miembro")}finally{u(!1)}},j=async(w,C)=>{try{u(!0),await Wd(r.id,w,C),await y()}catch(P){console.error("Error cambiando rol:",P),f("No se pudo cambiar el rol")}finally{u(!1)}};return e?o.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:o.jsxs("div",{className:"bg-[var(--color-surface)] rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",children:[o.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-700",children:[o.jsxs("div",{children:[o.jsx("h2",{className:"text-xl font-semibold text-white",children:"Compartir proyecto"}),o.jsx("p",{className:"text-sm text-gray-400 mt-1",children:r==null?void 0:r.name})]}),o.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:o.jsx(Ne,{className:"w-6 h-6"})})]}),o.jsxs("div",{className:"flex-1 overflow-y-auto p-6 space-y-6",children:[m&&o.jsx("form",{onSubmit:b,className:"space-y-4",children:o.jsxs("div",{children:[o.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Invitar usuario por email"}),o.jsxs("div",{className:"flex gap-3",children:[o.jsx("input",{type:"email",value:i,onChange:w=>a(w.target.value),placeholder:"usuario@ejemplo.com",className:"flex-1 bg-[var(--color-bg)] text-white rounded-lg px-4 py-2.5 border border-gray-700 focus:border-[var(--color-accent)] focus:outline-none",disabled:d}),o.jsxs("select",{value:l,onChange:w=>c(w.target.value),className:"bg-[var(--color-bg)] text-white rounded-lg px-4 py-2.5 border border-gray-700 focus:border-[var(--color-accent)] focus:outline-none",disabled:d,children:[o.jsx("option",{value:"editor",children:"Editor"}),o.jsx("option",{value:"viewer",children:"Visor"})]}),o.jsxs("button",{type:"submit",disabled:d||!i.trim(),className:"bg-[var(--color-accent)] hover:bg-[var(--color-accent-hover)] text-white rounded-lg px-6 py-2.5 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[o.jsx(si,{className:"w-4 h-4"}),"Invitar"]})]})]})}),h&&o.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-lg p-4 text-red-400 text-sm",children:h}),o.jsxs("div",{children:[o.jsxs("h3",{className:"text-sm font-medium text-gray-300 mb-3",children:["Miembros del proyecto (",s.length,")"]}),d&&s.length===0?o.jsx("div",{className:"text-center py-8 text-gray-400",children:"Cargando miembros..."}):s.length===0?o.jsx("div",{className:"text-center py-8 text-gray-400",children:"No hay miembros aún"}):o.jsx("div",{className:"space-y-2",children:s.map(w=>{var T,N,R,E,I;const C=((T=_t[w.role])==null?void 0:T.icon)||dr,P=((N=_t[w.role])==null?void 0:N.color)||"text-gray-500";return o.jsxs("div",{className:"flex items-center justify-between p-4 bg-[var(--color-bg)] rounded-lg border border-gray-700",children:[o.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[o.jsx("div",{className:"w-10 h-10 rounded-full bg-[var(--color-accent)] flex items-center justify-center text-white font-medium flex-shrink-0",children:((E=(R=w.display_name)==null?void 0:R[0])==null?void 0:E.toUpperCase())||w.email[0].toUpperCase()}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("div",{className:"font-medium text-white truncate",children:w.display_name||w.email.split("@")[0]}),o.jsx("div",{className:"text-sm text-gray-400 truncate",children:w.email})]}),o.jsxs("div",{className:`flex items-center gap-1.5 ${P} flex-shrink-0`,children:[o.jsx(C,{className:"w-4 h-4"}),o.jsx("span",{className:"text-sm font-medium",children:((I=_t[w.role])==null?void 0:I.label)||w.role})]})]}),m&&w.role!=="owner"&&o.jsxs("div",{className:"flex items-center gap-2 ml-4",children:[o.jsxs("select",{value:w.role,onChange:L=>j(w.user_id,L.target.value),className:"bg-[var(--color-surface)] text-white text-sm rounded px-2 py-1 border border-gray-700 focus:border-[var(--color-accent)] focus:outline-none",disabled:d,children:[o.jsx("option",{value:"editor",children:"Editor"}),o.jsx("option",{value:"viewer",children:"Visor"})]}),o.jsx("button",{onClick:()=>p(w.user_id),className:"text-red-400 hover:text-red-300 transition-colors p-1",disabled:d,children:o.jsx(ur,{className:"w-4 h-4"})})]})]},w.id)})})]}),o.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:[o.jsx("h4",{className:"text-sm font-medium text-blue-400 mb-2",children:"ℹ️ Roles y permisos"}),o.jsxs("ul",{className:"text-sm text-blue-300 space-y-1",children:[o.jsxs("li",{children:[o.jsx("strong",{children:"Propietario:"})," Control total del proyecto"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Editor:"})," Puede chatear y ver documentos"]}),o.jsxs("li",{children:[o.jsx("strong",{children:"Visor:"})," Solo puede ver conversaciones"]})]})]})]}),o.jsx("div",{className:"flex justify-end gap-3 p-6 border-t border-gray-700",children:o.jsx("button",{onClick:t,className:"px-6 py-2.5 rounded-lg border border-gray-600 text-gray-300 hover:bg-gray-700 transition-colors",children:"Cerrar"})})]})}):null}async function qd(e,t){try{const r=e.name.split(".").pop(),s=`${Date.now()}-${Math.random().toString(36).substring(7)}.${r}`,n=`${t}/${s}`,{data:i,error:a}=await O.storage.from("user-files").upload(n,e,{cacheControl:"3600",upsert:!1});if(a)throw a;const{data:{publicUrl:l}}=O.storage.from("user-files").getPublicUrl(n);return{bucket:"user-files",path:n,url:l,name:e.name,type:e.type,size:e.size}}catch(r){throw console.error("Error subiendo archivo:",r),new Error(`No se pudo subir el archivo: ${r.message}`)}}async function Kd(e,t){const r=e.map(s=>qd(s,t));return Promise.all(r)}function Xd({isOpen:e,onClose:t,project:r}){const{user:s}=Ke(),n=s==null?void 0:s.id,[i,a]=v.useState([]),[l,c]=v.useState(!1),[d,u]=v.useState(!1);v.useEffect(()=>{e&&r&&h()},[e,r]);const h=async()=>{u(!0);try{const y=`${n}/projects/${r.id}/`,{data:b,error:p}=await O.storage.from("user-files").list(y,{limit:100,offset:0,sortBy:{column:"created_at",order:"desc"}});if(p)throw p;a(b||[])}catch(y){console.error("Error cargando documentos:",y)}finally{u(!1)}},f=async y=>{const b=Array.from(y.target.files);if(b.length!==0){if(!n){alert("❌ ERROR: userId no está definido. No se puede subir el archivo."),console.error("[UPLOAD BLOQUEADO] userId es undefined"),y.target.value="";return}if(!(r!=null&&r.id)){alert("❌ ERROR: No hay proyecto seleccionado. No se puede subir el archivo."),console.error("[UPLOAD BLOQUEADO] project.id es undefined"),y.target.value="";return}console.log("[UPLOAD] ✅ userId:",n),console.log("[UPLOAD] ✅ projectId:",r.id),c(!0);try{for(const p of b){const w=p.name.replace(/[^\w\s.-]/gi,"_").replace(/\s+/g,"_"),C=`${n}/projects/${r.id}/${w}`.replace(/\/+/g,"/");console.log("[UPLOAD] Subiendo a ruta:",C);const{error:P}=await O.storage.from("user-files").upload(C,p,{cacheControl:"3600",upsert:!0});if(P)throw P}await h()}catch(p){console.error("Error subiendo archivos:",p),alert("Error subiendo archivos: "+p.message)}finally{c(!1),y.target.value=""}}},m=async y=>{if(confirm(`¿Eliminar "${y}"?`))try{const b=`${n}/projects/${r.id}/${y}`.replace(/\/+/g,"/"),{error:p}=await O.storage.from("user-files").remove([b]);if(p)throw p;await h()}catch(b){console.error("Error eliminando documento:",b),alert("Error eliminando documento: "+b.message)}},g=async y=>{try{const b=`${n}/projects/${r.id}/${y}`.replace(/\/+/g,"/"),{data:p,error:j}=await O.storage.from("user-files").download(b);if(j)throw j;const w=URL.createObjectURL(p),C=document.createElement("a");C.href=w,C.download=y,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(w)}catch(b){console.error("Error descargando documento:",b),alert("Error descargando documento: "+b.message)}},x=y=>{if(y===0)return"0 Bytes";const b=1024,p=["Bytes","KB","MB","GB"],j=Math.floor(Math.log(y)/Math.log(b));return Math.round(y/Math.pow(b,j)*100)/100+" "+p[j]};return e?o.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:o.jsxs("div",{className:"w-full max-w-2xl max-h-[80vh] rounded-xl shadow-2xl flex flex-col",style:{backgroundColor:"var(--color-bg-primary)",border:"1px solid var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b",style:{borderColor:"var(--color-border)"},children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("span",{className:"text-2xl",children:(r==null?void 0:r.icon)||"📁"}),o.jsxs("div",{children:[o.jsxs("h2",{className:"text-lg font-semibold",style:{color:"var(--color-text-primary)"},children:["Documentos de ",r==null?void 0:r.name]}),o.jsxs("p",{className:"text-sm",style:{color:"var(--color-text-tertiary)"},children:[i.length," documento",i.length!==1?"s":""]})]})]}),o.jsx("button",{onClick:t,className:"p-2 rounded-lg transition-all",style:{color:"var(--color-text-secondary)"},onMouseEnter:y=>y.currentTarget.style.backgroundColor="var(--color-bg-hover)",onMouseLeave:y=>y.currentTarget.style.backgroundColor="transparent",children:o.jsx(Ne,{size:20})})]}),o.jsxs("div",{className:"p-4 border-b",style:{borderColor:"var(--color-border)"},children:[(!n||!(r!=null&&r.id))&&o.jsxs("div",{className:"mb-3 p-3 rounded-lg bg-red-50 border border-red-200 text-red-700 text-sm",children:["⚠️ ",o.jsx("strong",{children:"No se puede subir archivos:"})," ",n?"Proyecto no seleccionado":"Usuario no identificado"]}),o.jsxs("label",{className:"flex items-center justify-center gap-2 p-4 border-2 border-dashed rounded-lg transition-all",style:{borderColor:l?"var(--color-accent)":"var(--color-border)",color:"var(--color-text-secondary)",cursor:!n||!(r!=null&&r.id)||l?"not-allowed":"pointer",opacity:!n||!(r!=null&&r.id)||l?.5:1},children:[o.jsx(Wn,{size:20}),o.jsx("span",{children:l?"Subiendo...":!n||!(r!=null&&r.id)?"Upload deshabilitado":"Haz clic o arrastra archivos aquí"}),o.jsx("input",{type:"file",multiple:!0,onChange:f,disabled:l||!n||!(r!=null&&r.id),className:"hidden",accept:".pdf,.doc,.docx,.txt,.md,.csv,.xlsx,.xls"})]})]}),o.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:d?o.jsx("div",{className:"flex items-center justify-center py-8",children:o.jsx("div",{className:"w-8 h-8 border-2 border-t-transparent rounded-full animate-spin",style:{borderColor:"var(--color-accent)"}})}):i.length===0?o.jsxs("div",{className:"text-center py-8",style:{color:"var(--color-text-tertiary)"},children:[o.jsx(Se,{size:48,className:"mx-auto mb-3 opacity-50"}),o.jsx("p",{children:"No hay documentos en este proyecto"}),o.jsx("p",{className:"text-sm mt-1",children:"Sube archivos para que AL-E pueda accederlos"})]}):o.jsx("div",{className:"space-y-2",children:i.map(y=>{var b;return o.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border hover:bg-[var(--color-bg-secondary)] transition-all",style:{borderColor:"var(--color-border)"},children:[o.jsx(Se,{size:20,style:{color:"var(--color-accent)"}}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("p",{className:"text-sm font-medium truncate",style:{color:"var(--color-text-primary)"},children:y.name}),o.jsxs("p",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:[x(((b=y.metadata)==null?void 0:b.size)||0)," • ",new Date(y.created_at).toLocaleDateString()]})]}),o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("button",{onClick:()=>g(y.name),className:"p-2 rounded-lg hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-secondary)"},title:"Descargar",children:o.jsx(Hn,{size:16})}),o.jsx("button",{onClick:()=>m(y.name),className:"p-2 rounded-lg hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-error, #ef4444)"},title:"Eliminar",children:o.jsx(ur,{size:16})})]})]},y.name)})})}),o.jsx("div",{className:"p-4 border-t",style:{borderColor:"var(--color-border)"},children:o.jsx("div",{className:"text-xs",style:{color:"var(--color-text-tertiary)"},children:"💡 Los documentos se guardan en el bucket de Supabase. AL-E puede acceder a ellos cuando los menciones en el chat."})})]})}):null}function Yd(){const{user:e}=Ke(),[t,r]=v.useState([]),[s,n]=v.useState([]),[i,a]=v.useState(0),[l,c]=v.useState(!1),[d,u]=v.useState(!1),h=gt();v.useEffect(()=>{e!=null&&e.id&&(m(),f());const p=O.channel("notifications").on("postgres_changes",{event:"*",schema:"public",table:"user_notifications"},w=>{console.log("🔔 Nueva notificación:",w),m()}).subscribe(),j=setInterval(()=>{e!=null&&e.id&&f()},5*60*1e3);return()=>{p.unsubscribe(),clearInterval(j)}},[e]);const f=async()=>{if(e!=null&&e.id)try{const p=new Date,j=new Date(p);j.setDate(j.getDate()+2);const{data:w,error:C}=await O.from("calendar_events").select("*").eq("owner_user_id",e.id).eq("status","scheduled").gte("start_at",p.toISOString()).lte("start_at",j.toISOString()).order("start_at",{ascending:!0}).limit(10);if(C)throw C;console.log("📅 Eventos próximos:",w),n(w||[])}catch(p){console.error("Error cargando eventos próximos:",p)}},m=async()=>{try{const{data:p,error:j}=await O.from("user_notifications").select("*").order("created_at",{ascending:!1}).limit(10);if(j)throw j;r(p||[]);const w=(p==null?void 0:p.filter(C=>!C.is_read).length)||0;a(w+s.length)}catch(p){console.error("Error cargando notificaciones:",p)}},g=async p=>{var j;u(!0);try{const w=(j=p.metadata)==null?void 0:j.project_id,{error:C}=await O.rpc("accept_project_invitation",{p_project_id:w});if(C)throw C;await m(),c(!1),window.location.reload()}catch(w){console.error("Error aceptando invitación:",w),alert("Error al aceptar invitación")}finally{u(!1)}},x=async p=>{var j;u(!0);try{const w=(j=p.metadata)==null?void 0:j.project_id,{error:C}=await O.rpc("reject_project_invitation",{p_project_id:w});if(C)throw C;await m()}catch(w){console.error("Error rechazando invitación:",w),alert("Error al rechazar invitación")}finally{u(!1)}},y=async p=>{try{await O.rpc("mark_notification_read",{p_notification_id:p}),await m()}catch(j){console.error("Error marcando como leída:",j)}},b=async()=>{try{await O.rpc("mark_all_notifications_read"),await m()}catch(p){console.error("Error marcando todas como leídas:",p)}};return o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>c(!l),className:"relative p-2 rounded-lg transition-colors hover:bg-[var(--color-bg-hover)] flex items-center gap-2",style:{color:"var(--color-text-secondary)"},"aria-label":"Notificaciones",children:[o.jsx($t,{size:20}),o.jsx("span",{className:"hidden sm:inline text-sm font-medium",children:"Notificaciones"}),i>0&&o.jsx("span",{className:"absolute -top-1 -right-1 sm:relative sm:top-0 sm:right-0 min-w-[20px] h-5 px-1.5 rounded-full text-xs font-bold flex items-center justify-center shadow-lg",style:{backgroundColor:"#EF4444",color:"white"},children:i>9?"9+":i})]}),l&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-40 bg-black/50 lg:hidden",onClick:()=>c(!1)}),o.jsxs("div",{className:"fixed bottom-0 left-0 right-0 lg:fixed lg:bottom-16 lg:right-4 lg:left-auto lg:top-auto w-full lg:w-96 rounded-t-2xl lg:rounded-xl shadow-2xl z-50 flex flex-col max-h-[80vh] lg:max-h-[600px]",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)",border:"1px solid var(--color-border)",maxHeight:"calc(100vh - 8rem)"},children:[o.jsxs("div",{className:"flex items-center justify-between p-4 border-b shrink-0",style:{borderColor:"var(--color-border)"},children:[o.jsx("h3",{className:"font-semibold text-base",style:{color:"var(--color-text-primary)"},children:"Notificaciones"}),i>0&&o.jsx("button",{onClick:b,className:"text-xs hover:underline shrink-0",style:{color:"var(--color-accent)"},children:"Marcar como leídas"})]}),o.jsx("div",{className:"flex-1 overflow-y-auto",children:t.length===0&&s.length===0?o.jsxs("div",{className:"p-8 text-center",style:{color:"var(--color-text-tertiary)"},children:[o.jsx($t,{size:48,className:"mx-auto mb-3 opacity-50"}),o.jsx("p",{children:"No tienes notificaciones"})]}):o.jsxs(o.Fragment,{children:[s.map(p=>{const j=new Date(p.start_at),w=new Date,C=j-w,P=Math.floor(C/6e4),T=Math.floor(P/60),N=Math.floor(T/24),R=new Date(w.getFullYear(),w.getMonth(),w.getDate()),E=new Date(R);E.setDate(E.getDate()+1);const I=new Date(j.getFullYear(),j.getMonth(),j.getDate());let L="";return P<0?L="Ahora":P<60?L=`En ${P} min`:I.getTime()===R.getTime()?L=`Hoy ${j.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})}`:I.getTime()===E.getTime()?L=`Mañana ${j.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})}`:N<7?L=`${j.toLocaleDateString("es-MX",{weekday:"short"})} ${j.toLocaleTimeString("es-MX",{hour:"2-digit",minute:"2-digit"})}`:L=j.toLocaleDateString("es-MX",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}),o.jsx("div",{className:"p-4 border-b transition-colors cursor-pointer hover:bg-[var(--color-bg-hover)]",style:{borderColor:"var(--color-border)",backgroundColor:"var(--color-bg-tertiary)"},onClick:()=>{h("/calendar"),c(!1)},children:o.jsxs("div",{className:"flex items-start gap-3",children:[o.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#3B82F6"},children:o.jsx(Wt,{size:20,className:"text-white"})}),o.jsx("div",{className:"flex-1 min-w-0",children:o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:p.title}),o.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:p.location||"Sin ubicación"}),o.jsx("p",{className:"text-xs mt-1 font-semibold",style:{color:"#3B82F6"},children:L})]}),o.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 mt-1",style:{backgroundColor:"#3B82F6"}})]})})]})},`event-${p.id}`)}),t.map(p=>o.jsxs("div",{className:`p-4 border-b transition-colors cursor-pointer hover:bg-[var(--color-bg-hover)] ${p.is_read?"":"bg-[var(--color-bg-secondary)]"}`,style:{borderColor:"var(--color-border)"},onClick:()=>{var j;p.type==="calendar_reminder"&&((j=p.metadata)!=null&&j.eventId)&&(h("/calendar"),c(!1)),p.is_read||y(p.id)},children:["                    ",o.jsxs("div",{className:"flex items-start gap-3",children:[p.type==="project_invite"&&o.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-accent)"},children:o.jsx(hr,{size:20,className:"text-white"})}),p.type==="calendar_reminder"&&o.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#3B82F6"},children:o.jsx(Wt,{size:20,className:"text-white"})}),!p.type&&o.jsx("div",{className:"w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"#6B7280"},children:o.jsx(Ve,{size:20,className:"text-white"})}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-start justify-between gap-2",children:[o.jsxs("div",{className:"flex-1",children:[o.jsx("p",{className:"font-medium text-sm",style:{color:"var(--color-text-primary)"},children:p.title}),o.jsx("p",{className:"text-sm mt-1",style:{color:"var(--color-text-secondary)"},children:p.message}),o.jsx("p",{className:"text-xs mt-1",style:{color:"var(--color-text-tertiary)"},children:new Date(p.created_at).toLocaleDateString("es-MX",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),!p.is_read&&o.jsx("div",{className:"w-2 h-2 rounded-full flex-shrink-0 mt-1",style:{backgroundColor:"var(--color-accent)"}})]}),p.type==="project_invite"&&!p.is_read&&o.jsxs("div",{className:"flex gap-2 mt-3",children:[o.jsxs("button",{onClick:()=>g(p),disabled:d,className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 rounded text-sm font-medium transition-colors disabled:opacity-50",style:{backgroundColor:"var(--color-accent)",color:"white"},children:[o.jsx(lr,{size:14}),"Aceptar"]}),o.jsxs("button",{onClick:()=>x(p),disabled:d,className:"flex-1 flex items-center justify-center gap-1 px-3 py-1.5 rounded text-sm font-medium transition-colors hover:bg-[var(--color-bg-hover)] disabled:opacity-50",style:{color:"var(--color-text-secondary)"},children:[o.jsx(Ne,{size:14}),"Rechazar"]})]}),p.type!=="project_invite"&&!p.is_read&&o.jsx("button",{onClick:()=>y(p.id),className:"text-xs mt-2 hover:underline",style:{color:"var(--color-accent)"},children:"Marcar como leída"})]})]})]},p.id))]})})]})]})]})}async function Jd(){try{console.log("[ProjectsService] 🔍 Obteniendo proyectos...");const{data:{user:e},error:t}=await O.auth.getUser();if(t)return console.error("[ProjectsService] ❌ Error obteniendo usuario:",t),[];if(!e)return console.warn("[ProjectsService] ⚠️ No hay usuario autenticado"),[];console.log("[ProjectsService] ✅ Usuario autenticado:",e.id);const{data:r,error:s}=await O.from("user_projects").select(`
        *,
        project_members!left(
          user_id,
          role,
          accepted_at
        )
      `).eq("is_archived",!1).order("sort_order",{ascending:!0});if(s)throw console.error("[ProjectsService] ❌ Error obteniendo proyectos:",s),s;console.log("[ProjectsService] 📦 Datos recibidos:",(r==null?void 0:r.length)||0,"proyectos");const n=(r||[]).map(i=>{var c;const a=i.user_id===e.id,l=(c=i.project_members)==null?void 0:c.find(d=>d.user_id===e.id);return{...i,isOwner:a,isShared:!a,myRole:(l==null?void 0:l.role)||(a?"owner":null)}});return console.log(`[ProjectsService] ✅ Procesados ${n.length} proyectos (${n.filter(i=>i.isOwner).length} propios, ${n.filter(i=>i.isShared).length} compartidos)`),n}catch(e){throw console.error("[ProjectsService] ❌ Error en getProjects:",e),e}}async function Zd({name:e,description:t="",color:r="#3B82F6",icon:s="📁"}){try{const{data:{user:n}}=await O.auth.getUser();if(!n)throw new Error("No hay usuario autenticado");const{data:i,error:a}=await O.from("user_projects").insert({user_id:n.id,name:e,description:t,color:r,icon:s}).select().single();if(a)throw console.error("❌ Error creando proyecto:",a),a;return console.log("✅ Proyecto creado:",i.name),i}catch(n){throw console.error("❌ Error en createProject:",n),n}}async function Qd(e){try{const{error:t}=await O.from("user_projects").delete().eq("id",e);if(t)throw console.error("❌ Error borrando proyecto:",t),t;console.log("✅ Proyecto eliminado:",e)}catch(t){throw console.error("❌ Error en deleteProject:",t),t}}function eu({conversations:e,currentConversationId:t,onNewConversation:r,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i,isOpen:a,currentUser:l,onLogout:c}){const d=v.useRef(null),u=gt(),{toast:h}=ar(),{userProfile:f}=Ke();Qs("mail.send");const[m,g]=v.useState(""),[x,y]=v.useState(!1),[b,p]=v.useState(!1),[j,w]=v.useState(!1),[C,P]=v.useState(null),[T,N]=v.useState(null),[R,E]=v.useState([]);v.useState(null);const[I,L]=v.useState(!1),[B,S]=v.useState({today:!0,yesterday:!0,last7days:!0,last30days:!0,projects:!0});v.useEffect(()=>{d.current&&(d.current.scrollTop=0)},[]),v.useEffect(()=>{_(),F()},[]);const F=()=>{"Notification"in window&&L(Notification.permission==="granted")},k=async()=>{if(!("Notification"in window)){h({variant:"destructive",title:"No soportado",description:"Tu navegador no soporta notificaciones"});return}try{await Notification.requestPermission()==="granted"?(L(!0),h({title:"Notificaciones activadas",description:"Recibirás notificaciones de correos y agenda"})):h({variant:"destructive",title:"Permiso denegado",description:"No podrás recibir notificaciones"})}catch(A){console.error("Error solicitando permiso:",A)}},_=async()=>{try{console.log("[Sidebar] 🔍 Cargando proyectos...");const A=await Jd();console.log("[Sidebar] ✅ Proyectos cargados:",(A==null?void 0:A.length)||0),console.log("[Sidebar] Proyectos:",A),E(A||[])}catch(A){console.error("[Sidebar] ❌ Error cargando proyectos:",A),E([])}};if(!a)return null;const D=e.filter(A=>!A.project_id);e.filter(A=>A.project_id);const z=tu(D),G=m?e.filter(A=>A.title.toLowerCase().includes(m.toLowerCase())):null,M=A=>{S($=>({...$,[A]:!$[A]}))},K=async A=>{try{await Zd(A),h({title:"Proyecto creado",description:`${A.icon} ${A.name} ha sido creado exitosamente`,duration:3e3}),y(!1),await _()}catch($){h({variant:"destructive",title:"Error",description:$.message||"No se pudo crear el proyecto",duration:5e3})}},oe=async A=>{if(confirm("¿Eliminar este proyecto? Las conversaciones se mantendrán pero quedarán sin proyecto."))try{await Qd(A),h({title:"Proyecto eliminado",description:"El proyecto ha sido eliminado",duration:3e3}),await _()}catch($){h({variant:"destructive",title:"Error",description:$.message||"No se pudo eliminar el proyecto",duration:5e3})}},Z=A=>{r(A)};return o.jsxs(o.Fragment,{children:[o.jsx(Bd,{isOpen:x,onClose:()=>y(!1),onSave:K}),o.jsxs("div",{className:"h-full flex flex-col w-[280px] md:w-[300px] border-r",style:{backgroundColor:"var(--color-bg-primary)",borderColor:"var(--color-border)"},children:[o.jsxs("div",{className:"p-3 space-y-3",children:[o.jsx("div",{className:"relative",children:o.jsx("div",{className:"relative p-5 rounded-2xl border backdrop-blur-xl overflow-hidden",style:{backgroundColor:"rgba(0, 0, 0, 0.5)",borderColor:"rgba(99, 179, 237, 0.4)",boxShadow:"0 8px 32px 0 rgba(0, 0, 0, 0.4), 0 0 0 1px rgba(99, 179, 237, 0.1)"},children:o.jsxs("div",{className:"flex items-center gap-4",children:[o.jsxs("div",{className:"relative flex-shrink-0",children:[o.jsx("div",{className:"w-16 h-16 rounded-full flex items-center justify-center overflow-hidden border-2 relative",style:{borderColor:"#63B3ED",boxShadow:"0 0 25px rgba(99, 179, 237, 0.7), 0 0 50px rgba(99, 179, 237, 0.4), inset 0 0 20px rgba(99, 179, 237, 0.2)",backgroundColor:f!=null&&f.assistant_avatar_url?"transparent":"var(--color-accent)"},children:f!=null&&f.assistant_avatar_url?o.jsx("img",{src:f.assistant_avatar_url,alt:f.assistant_name||"AL-E",className:"w-full h-full object-cover",style:{filter:"drop-shadow(0 0 12px rgba(99, 179, 237, 0.6))"}}):o.jsx(Rn,{size:28,style:{color:"#FFFFFF"}})}),o.jsx("div",{className:"absolute inset-0 rounded-full animate-pulse",style:{boxShadow:"0 0 40px rgba(99, 179, 237, 0.5), 0 0 60px rgba(99, 179, 237, 0.3)",pointerEvents:"none"}})]}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsx("h3",{className:"font-bold text-lg truncate",style:{color:"#FFFFFF",textShadow:"0 0 12px rgba(99, 179, 237, 0.6), 0 2px 4px rgba(0, 0, 0, 0.5)"},children:(f==null?void 0:f.assistant_name)||"AL-E"}),o.jsx("p",{className:"text-xs truncate mt-0.5",style:{color:"rgba(255, 255, 255, 0.8)",textShadow:"0 1px 2px rgba(0, 0, 0, 0.5)"},children:"Tu asistente inteligente"})]}),o.jsx("div",{className:"flex-shrink-0",children:o.jsx(Id,{})})]})})}),o.jsxs("div",{className:"flex gap-2",children:[o.jsxs("button",{onClick:r,className:"flex-1 flex items-center justify-center gap-2 py-2.5 px-3 rounded-2xl transition-all duration-200 hover:opacity-90",style:{backgroundColor:"var(--color-accent)",color:"#FFFFFF"},children:[o.jsx(eo,{size:18,strokeWidth:2.5}),o.jsx("span",{className:"font-medium",style:{color:"#FFFFFF"},children:"Nuevo chat"})]}),!I&&o.jsx("button",{onClick:k,className:"flex items-center justify-center gap-2 py-2.5 px-3 rounded-2xl transition-all duration-200",style:{backgroundColor:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444"},title:"Activar notificaciones",children:o.jsx($t,{size:18})}),o.jsx("button",{onClick:()=>y(!0),className:"flex items-center justify-center gap-2 py-2.5 px-3 rounded-2xl transition-all duration-200",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},title:"Nuevo proyecto",children:o.jsx(to,{size:18})})]}),o.jsxs("div",{className:"relative",children:[o.jsx(ei,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2",style:{color:"var(--color-text-tertiary)"}}),o.jsx("input",{type:"text",placeholder:"Buscar chats...",value:m,onChange:A=>g(A.target.value),className:"w-full pl-9 pr-3 py-2 rounded-2xl text-sm transition-all focus:outline-none",style:{backgroundColor:"var(--color-bg-secondary)",color:"var(--color-text-primary)",border:"1px solid var(--color-border)"}})]}),o.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[o.jsx("button",{onClick:()=>u("/correo"),className:"flex items-center justify-center py-3 px-2 rounded-xl transition-all hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},title:"Email",children:o.jsx(Gn,{size:22})}),o.jsx("button",{onClick:()=>u("/calendar"),className:"flex items-center justify-center py-3 px-2 rounded-xl transition-all hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},title:"Agenda",children:o.jsx(Wt,{size:22})}),o.jsx("button",{onClick:()=>u("/telegram"),className:"flex items-center justify-center py-3 px-2 rounded-xl transition-all hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},title:"Telegram",children:o.jsx(Zs,{size:22})}),o.jsx("button",{onClick:()=>u("/reuniones"),className:"flex items-center justify-center py-3 px-2 rounded-xl transition-all hover:opacity-80",style:{backgroundColor:"var(--color-bg-secondary)",border:"1px solid var(--color-border)",color:"var(--color-text-primary)"},title:"Reuniones (Meetings)",children:o.jsx(hr,{size:22})})]})]}),R.length>0&&o.jsxs("div",{className:"px-2 py-2 border-b",style:{borderColor:"var(--color-border)"},children:[o.jsxs("button",{onClick:()=>M("projects"),className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-[var(--color-bg-secondary)] transition-all",style:{color:"var(--color-text-tertiary)"},children:[B.projects?o.jsx(Xe,{size:14}):o.jsx(fr,{size:14}),o.jsx(Jn,{size:14}),o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:"Proyectos"}),o.jsxs("span",{className:"text-xs",children:["(",R.length,")"]})]}),B.projects&&o.jsx("div",{className:"mt-2 space-y-1",children:R.map(A=>o.jsx(su,{project:A,conversations:e.filter($=>$.project_id===A.id),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i,onNewChatInProject:()=>Z(A.id),onDeleteProject:()=>oe(A.id),onShareProject:()=>{P(A),p(!0)},onManageDocuments:()=>{N(A),w(!0)}},A.id))})]}),o.jsx(Gd,{isOpen:b,onClose:()=>{p(!1),P(null)},project:C}),o.jsx(Xd,{isOpen:j,onClose:()=>{w(!1),N(null)},project:T}),o.jsx("div",{ref:d,className:"flex-1 overflow-y-auto px-2",children:e.length===0?o.jsxs("div",{className:"p-6 text-center space-y-3",style:{color:"var(--color-text-tertiary)"},children:[o.jsx(cr,{size:40,className:"mx-auto opacity-40"}),o.jsxs("div",{children:[o.jsx("p",{className:"text-sm font-medium",children:"No hay conversaciones"}),o.jsx("p",{className:"text-xs mt-1",children:"Inicia un nuevo chat para comenzar"})]})]}):G?o.jsx("div",{className:"space-y-1 py-2",children:G.map(A=>o.jsx(Lr,{conversation:A,isActive:A.id===t,onSelect:()=>s(A.id),onUpdate:$=>n(A.id,{title:$}),onDelete:()=>i(A.id)},A.id))}):o.jsxs("div",{className:"space-y-1 py-2",children:[z.today.length>0&&o.jsx(_e,{title:"Hoy",conversations:z.today,isExpanded:B.today,onToggle:()=>M("today"),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i}),z.yesterday.length>0&&o.jsx(_e,{title:"Ayer",conversations:z.yesterday,isExpanded:B.yesterday,onToggle:()=>M("yesterday"),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i}),z.last7days.length>0&&o.jsx(_e,{title:"Últimos 7 días",conversations:z.last7days,isExpanded:B.last7days,onToggle:()=>M("last7days"),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i}),z.last30days.length>0&&o.jsx(_e,{title:"Últimos 30 días",conversations:z.last30days,isExpanded:B.last30days,onToggle:()=>M("last30days"),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i}),z.older.length>0&&o.jsx(_e,{title:"Más antiguo",conversations:z.older,isExpanded:B.older,onToggle:()=>M("older"),currentConversationId:t,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i})]})}),o.jsxs("div",{className:"border-t",style:{borderColor:"var(--color-border)"},children:[o.jsx("div",{className:"p-2 flex justify-end",children:o.jsx(Yd,{})}),l&&o.jsx(ru,{currentUser:l,onLogout:c,navigate:u})]})]})]})}function tu(e){const t=Date.now(),r=24*60*60*1e3,s=7*r,n=30*r;return e.reduce((i,a)=>{const l=t-a.updatedAt;return l<r?i.today.push(a):l<2*r?i.yesterday.push(a):l<s?i.last7days.push(a):l<n?i.last30days.push(a):i.older.push(a),i},{today:[],yesterday:[],last7days:[],last30days:[],older:[]})}function _e({title:e,conversations:t,isExpanded:r,onToggle:s,currentConversationId:n,onSelectConversation:i,onUpdateConversation:a,onDeleteConversation:l}){return o.jsxs("div",{className:"mb-2",children:[o.jsxs("button",{onClick:s,className:"w-full flex items-center gap-2 px-2 py-1.5 rounded hover:bg-[var(--color-bg-secondary)] transition-all",style:{color:"var(--color-text-tertiary)"},children:[r?o.jsx(Xe,{size:14}):o.jsx(fr,{size:14}),o.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide",children:e}),o.jsxs("span",{className:"text-xs",children:["(",t.length,")"]})]}),r&&o.jsx("div",{className:"space-y-0.5 mt-1",children:t.map(c=>o.jsx(Lr,{conversation:c,isActive:c.id===n,onSelect:()=>i(c.id),onUpdate:d=>a(c.id,{title:d}),onDelete:()=>l(c.id)},c.id))})]})}function Lr({conversation:e,isActive:t,onSelect:r,onUpdate:s,onDelete:n}){const[i,a]=v.useState(!1),[l,c]=v.useState(e.title),[d,u]=v.useState(!1),[h,f]=v.useState(!1),m=async b=>{if(b.stopPropagation(),!!confirm("¿Eliminar esta conversación? Esta acción no se puede deshacer."))try{f(!0),await n(),console.log("✅ Conversación eliminada exitosamente")}catch(p){console.error("❌ Error eliminando conversación:",p),alert("Error al eliminar la conversación. Por favor intenta de nuevo.")}finally{f(!1)}},g=b=>{b.stopPropagation(),a(!0)},x=b=>{b.stopPropagation(),l.trim()&&l!==e.title&&s(l.trim()),a(!1)},y=b=>{b.stopPropagation(),c(e.title),a(!1)};return o.jsx("div",{onClick:r,onMouseEnter:()=>u(!0),onMouseLeave:()=>u(!1),className:Gs("group relative px-3 py-2 rounded-2xl cursor-pointer transition-all duration-150","hover:bg-[var(--color-bg-secondary)]"),style:{backgroundColor:t?"var(--color-bg-secondary)":"transparent"},children:o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx(cr,{size:16,className:"flex-shrink-0 opacity-70",style:{color:"var(--color-text-secondary)"}}),i?o.jsxs("div",{className:"flex-1 flex items-center gap-2",onClick:b=>b.stopPropagation(),children:[o.jsx("input",{type:"text",value:l,onChange:b=>c(b.target.value),className:"flex-1 px-2 py-1 text-sm rounded-xl bg-[var(--color-bg-tertiary)] border border-[var(--color-border)] focus:outline-none focus:border-[var(--color-accent)]",style:{color:"var(--color-text-primary)"},autoFocus:!0,onKeyDown:b=>{b.key==="Enter"&&x(b),b.key==="Escape"&&y(b)}}),o.jsx("button",{onClick:x,className:"p-1 hover:bg-[var(--color-bg-tertiary)] rounded-xl",children:o.jsx(lr,{size:14,style:{color:"var(--color-accent)"}})}),o.jsx("button",{onClick:y,className:"p-1 hover:bg-[var(--color-bg-tertiary)] rounded-xl",children:o.jsx(Ne,{size:14,style:{color:"var(--color-text-tertiary)"}})})]}):o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"flex-1 min-w-0",children:o.jsx("p",{className:"text-sm truncate",style:{color:"var(--color-text-primary)"},children:e.title})}),(d||t)&&o.jsxs("div",{className:"flex items-center gap-1",children:[o.jsx("button",{onClick:g,className:"p-1.5 rounded-xl hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-tertiary)"},title:"Renombrar",children:o.jsx(dr,{size:14})}),o.jsx("button",{onClick:m,disabled:h,className:"p-1.5 rounded-xl hover:bg-red-500/10 transition-all disabled:opacity-50",style:{color:"var(--color-text-tertiary)"},title:h?"Eliminando...":"Eliminar",children:h?o.jsx(Ys,{size:14,className:"animate-spin"}):o.jsx(ur,{size:14})})]})]})]})})}function ru({currentUser:e,onLogout:t,navigate:r}){const[s,n]=v.useState(!1);return o.jsx("div",{className:"p-2",children:o.jsxs("div",{className:"relative",children:[o.jsxs("button",{onClick:()=>n(!s),className:"w-full flex items-center gap-3 p-2.5 rounded-2xl hover:bg-[var(--color-bg-secondary)] transition-all",children:[o.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-accent)"},children:o.jsx(_r,{size:16,style:{color:"var(--color-text-primary)"}})}),o.jsx("span",{className:"text-sm font-medium truncate flex-1 text-left",style:{color:"var(--color-text-primary)"},children:e}),o.jsx(Xe,{size:16,style:{color:"var(--color-text-tertiary)"}})]}),s&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>n(!1)}),o.jsxs("div",{className:"absolute bottom-full left-0 right-0 mb-2 rounded-xl shadow-2xl overflow-hidden z-20 border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)"},children:[o.jsx("div",{className:"px-4 py-3 border-b",style:{borderColor:"var(--color-border)"},children:o.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide",style:{color:"var(--color-text-tertiary)"},children:"Mi cuenta"})}),o.jsxs("div",{className:"py-2",children:[o.jsx(Bt,{icon:o.jsx(_r,{size:16}),label:"Mi perfil",onClick:()=>{n(!1),r("/profile")}}),o.jsx(Bt,{icon:o.jsx(Js,{size:16}),label:"Configuración",onClick:()=>{n(!1),r("/settings")}})]}),o.jsx("div",{className:"border-t",style:{borderColor:"var(--color-border)"}}),o.jsx("div",{className:"py-2",children:o.jsx(Bt,{icon:o.jsx(Zn,{size:16}),label:"Cerrar sesión",onClick:()=>{n(!1),t()},danger:!0})})]})]})]})})}function Bt({icon:e,label:t,onClick:r,danger:s=!1}){return o.jsxs("button",{onClick:r,className:"w-full flex items-center gap-3 px-4 py-2.5 hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:s?"var(--color-error, #ef4444)":"var(--color-text-primary)"},children:[e,o.jsx("span",{className:"text-sm",children:t})]})}function su({project:e,conversations:t,currentConversationId:r,onSelectConversation:s,onUpdateConversation:n,onDeleteConversation:i,onNewChatInProject:a,onDeleteProject:l,onShareProject:c,onManageDocuments:d}){const[u,h]=v.useState(!0),[f,m]=v.useState(!1);return o.jsxs("div",{className:"mb-2",children:[o.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 rounded-xl hover:bg-[var(--color-bg-secondary)] transition-all group",children:[o.jsxs("button",{onClick:()=>h(!u),className:"flex items-center gap-2 flex-1 text-left",children:[u?o.jsx(Xe,{size:14}):o.jsx(fr,{size:14}),o.jsx("span",{className:"text-lg",children:e.icon||"📁"}),o.jsxs("div",{className:"flex-1 min-w-0",children:[o.jsxs("div",{className:"flex items-center gap-2",children:[o.jsx("p",{className:"text-sm font-medium truncate",style:{color:"var(--color-text-primary)"},children:e.name}),e.isShared&&o.jsxs("span",{className:"flex items-center gap-1 px-1.5 py-0.5 rounded text-xs font-medium",style:{backgroundColor:"rgba(99, 179, 237, 0.15)",color:"#63B3ED",border:"1px solid rgba(99, 179, 237, 0.3)"},title:`Compartido - Rol: ${e.myRole}`,children:[o.jsx(hr,{size:10}),"Compartido"]})]}),o.jsxs("p",{className:"text-xs truncate",style:{color:"var(--color-text-tertiary)"},children:[t.length," chat",t.length!==1?"s":"",e.isShared&&` • ${e.myRole==="editor"?"Editor":"Visor"}`]})]})]}),o.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[o.jsx("button",{onClick:a,className:"p-1.5 rounded-xl hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-tertiary)"},title:"Nuevo chat en este proyecto",children:o.jsx(eo,{size:14})}),e.myRole!=="viewer"&&o.jsx("button",{onClick:d,className:"p-1.5 rounded-xl hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-tertiary)"},title:"Documentos del proyecto",children:o.jsx(Se,{size:14})}),e.isOwner&&o.jsx("button",{onClick:c,className:"p-1.5 rounded-xl hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-tertiary)"},title:"Compartir proyecto",children:o.jsx(ti,{size:14})}),e.isOwner&&o.jsxs("div",{className:"relative",children:[o.jsx("button",{onClick:()=>m(!f),className:"p-1.5 rounded-xl hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-text-tertiary)"},title:"Más opciones",children:o.jsx(Qn,{size:14})}),f&&o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>m(!1)}),o.jsx("div",{className:"absolute right-0 top-full mt-1 rounded-xl shadow-lg overflow-hidden z-20 border",style:{backgroundColor:"var(--color-bg-secondary)",borderColor:"var(--color-border)",minWidth:"150px"},children:o.jsx("button",{onClick:()=>{m(!1),l()},className:"w-full px-3 py-2 text-left text-sm hover:bg-[var(--color-bg-tertiary)] transition-all",style:{color:"var(--color-error, #ef4444)"},children:"Eliminar proyecto"})})]})]})]})]}),u&&t.length>0&&o.jsx("div",{className:"ml-6 mt-1 space-y-0.5",children:t.map(g=>o.jsx(Lr,{conversation:g,isActive:g.id===r,onSelect:()=>s(g.id),onUpdate:x=>n(g.id,{title:x}),onDelete:()=>i(g.id)},g.id))})]})}const ue={CONVERSATIONS:"ale_conversations",CURRENT_CONVERSATION:"ale_current_conversation",USER_ID:"ale_user_id",WORKSPACE_ID:"ale_workspace_id"},re={getConversations(){try{const e=localStorage.getItem(ue.CONVERSATIONS);return e?JSON.parse(e):[]}catch(e){return console.error("Error reading conversations:",e),[]}},saveConversations(e){try{localStorage.setItem(ue.CONVERSATIONS,JSON.stringify(e))}catch(t){console.error("Error saving conversations:",t)}},getCurrentConversationId(){return localStorage.getItem(ue.CURRENT_CONVERSATION)},setCurrentConversationId(e){localStorage.setItem(ue.CURRENT_CONVERSATION,e)},getUserId(){let e=localStorage.getItem(ue.USER_ID);return e||(e=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(ue.USER_ID,e)),e},getWorkspaceId(){let e=localStorage.getItem(ue.WORKSPACE_ID);return e||(e=`workspace_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem(ue.WORKSPACE_ID,e)),e},cleanMessagesFromJSON(){try{const e=this.getConversations();let t=!1;const r=e.map(s=>{const n=s.messages.map(i=>{if(typeof i.content=="object"&&i.content!==null){console.warn("🧹 Limpiando mensaje con JSON:",i.id);const a=i.content.answer||i.content.message||i.content.text||JSON.stringify(i.content);return t=!0,{...i,content:a}}return i});return{...s,messages:n}});return t?(console.log("✅ Mensajes limpiados - JSON eliminado del chat"),this.saveConversations(r),!0):!1}catch(e){return console.error("Error limpiando mensajes:",e),!1}}},ou="https://api.al-eon.com";async function nu(e){try{const t=await fetch(`${ou}/api/sessions/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Error eliminando sesión: ${t.status}`);return!0}catch(t){throw console.error("❌ Error eliminando sesión:",t),t}}async function Hs(){try{const{data:{user:e}}=await O.auth.getUser();if(!e)return console.warn("⚠️ No hay usuario autenticado - usando localStorage"),null;const{data:t,error:r}=await O.from("user_conversations").select("*").eq("user_id",e.id).order("updated_at",{ascending:!1});if(r)return console.error("❌ Error cargando conversaciones de Supabase:",r),null;const s=t.map(n=>({id:n.conversation_id,title:n.title,messages:n.messages,createdAt:new Date(n.created_at).toISOString(),updatedAt:new Date(n.updated_at).toISOString()}));return console.log(`✅ Cargadas ${s.length} conversaciones de Supabase`),s}catch(e){return console.error("❌ Error en loadConversationsFromSupabase:",e),null}}async function Nn(e){try{const{data:{user:t}}=await O.auth.getUser();if(!t)return console.warn("⚠️ No hay usuario autenticado - guardando solo en localStorage"),!1;const{error:r}=await O.from("user_conversations").upsert({user_id:t.id,conversation_id:e.id,title:e.title,messages:e.messages,updated_at:new Date().toISOString()},{onConflict:"user_id,conversation_id"});return r?(console.error("❌ Error guardando conversación en Supabase:",r),!1):(console.log(`✅ Conversación ${e.id} guardada en Supabase`),!0)}catch(t){return console.error("❌ Error en saveConversationToSupabase:",t),!1}}async function iu(e){try{const{data:{user:t}}=await O.auth.getUser();if(!t)return console.warn("⚠️ No hay usuario autenticado"),!1;const{error:r}=await O.from("user_conversations").delete().eq("user_id",t.id).eq("conversation_id",e);return r?(console.error("❌ Error borrando conversación del usuario:",r),console.error("Detalles del error:",{code:r.code,message:r.message,details:r.details,hint:r.hint}),!1):(console.log(`✅ Conversación ${e} eliminada para el usuario ${t.id}`),!0)}catch(t){return console.error("❌ Error en deleteConversationFromSupabase:",t),!1}}async function au(e){try{const{data:{user:t}}=await O.auth.getUser();if(!t)return console.warn("⚠️ No hay usuario autenticado - no se puede migrar"),0;console.log(`🔄 Migrando ${e.length} conversaciones a Supabase...`);let r=0;for(const s of e)await Nn(s)&&r++;return console.log(`✅ Migradas ${r}/${e.length} conversaciones`),r}catch(t){return console.error("❌ Error en migrateLocalStorageToSupabase:",t),0}}function lu(e,t){const r=new Map;return t.forEach(s=>{r.set(s.id,s)}),e.forEach(s=>{const n=r.get(s.id);if(!n)r.set(s.id,s);else{const i=new Date(s.updatedAt||s.createdAt).getTime(),a=new Date(n.updatedAt||n.createdAt).getTime();i>a&&r.set(s.id,s)}}),Array.from(r.values()).sort((s,n)=>{const i=new Date(s.updatedAt||s.createdAt).getTime();return new Date(n.updatedAt||n.createdAt).getTime()-i})}function cu(){const[e,t]=v.useState([]),[r,s]=v.useState(null),[n,i]=v.useState(!1);v.useEffect(()=>{(async()=>{i(!0);try{re.cleanMessagesFromJSON();const f=re.getConversations();console.log(`📱 localStorage: ${f.length} conversaciones`);const m=await Hs();if(m){console.log(`☁️ Supabase: ${m.length} conversaciones`);const g=lu(f,m);console.log(`✅ Merged: ${g.length} conversaciones`),t(g),re.saveConversations(g),f.length>m.length&&(console.log("🔄 Migrando conversaciones locales a Supabase..."),await au(g));const x=re.getCurrentConversationId();x&&g.find(y=>y.id===x)?s(x):g.length>0&&s(g[0].id)}else{console.log("⚠️ Modo offline - usando solo localStorage"),t(f);const g=re.getCurrentConversationId();g&&f.find(x=>x.id===g)?s(g):f.length>0&&s(f[0].id)}}catch(f){console.error("❌ Error inicializando conversaciones:",f);const m=re.getConversations();t(m)}finally{i(!1)}})()},[]),v.useEffect(()=>{let h;return(async()=>{const{data:{user:m}}=await O.auth.getUser();if(!m){console.log("⚠️ No hay usuario autenticado, saltando realtime");return}console.log("🔴 Iniciando listener de conversaciones en tiempo real para user:",m.id),h=O.channel("conversations-changes").on("postgres_changes",{event:"DELETE",schema:"public",table:"user_conversations",filter:`user_id=eq.${m.id}`},g=>{console.log("🗑️ Conversación eliminada detectada:",g.old.id),t(x=>{const y=x.filter(b=>b.id!==g.old.id);if(r===g.old.id){const b=y.length>0?y[0].id:null;s(b),re.saveCurrentConversationId(b)}return re.saveConversations(y),y})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"user_conversations",filter:`user_id=eq.${m.id}`},async g=>{console.log("➕ Nueva conversación detectada:",g.new.id);const x=await Hs();x&&(t(x),re.saveConversations(x))}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"user_conversations",filter:`user_id=eq.${m.id}`},g=>{console.log("✏️ Conversación actualizada:",g.new.id),t(x=>{const y=x.map(b=>b.id===g.new.id?{...b,...g.new}:b);return re.saveConversations(y),y})}).subscribe()})(),()=>{h&&(console.log("🔴 Desuscribiendo listener de conversaciones"),O.removeChannel(h))}},[r]),v.useEffect(()=>{if(e.length===0||n)return;re.saveConversations(e),(async()=>{for(const f of e)await Nn(f)})()},[e,n]),v.useEffect(()=>{r&&re.setCurrentConversationId(r)},[r]);const a=(h=null)=>{const f={id:nt(),title:"New conversation",messages:[],sessionId:null,project_id:h,createdAt:Date.now(),updatedAt:Date.now()};return t(m=>[f,...m]),s(f.id),f},l=(h,f)=>{t(m=>m.map(g=>g.id===h?{...g,...f,updatedAt:Date.now()}:g))},c=async h=>{try{const f=e.find(g=>g.id===h);if(console.log("🗑️ Eliminando conversación de Supabase:",h),!await iu(h))throw console.error("❌ No se pudo eliminar la conversación de Supabase"),new Error("No se pudo eliminar la conversación del servidor");if(f!=null&&f.sessionId)try{await nu(f.sessionId),console.log("✅ Sesión eliminada del backend:",f.sessionId)}catch(g){console.warn("⚠️ Error eliminando sesión del backend (no crítico):",g)}return t(g=>{const x=g.filter(y=>y.id!==h);return h===r&&(x.length>0?s(x[0].id):s(null)),x}),console.log("✅ Conversación eliminada completamente:",h),!0}catch(f){throw console.error("❌ Error eliminando conversación:",f),f}},d=(h,f)=>{t(m=>m.map(g=>{if(g.id===h){const x=[...g.messages,f],y=g.messages.length===0?En(f.content):g.title;return{...g,messages:x,title:y,updatedAt:Date.now()}}return g}))};return{conversations:e,currentConversationId:r,currentConversation:(()=>e.find(h=>h.id===r))(),setCurrentConversationId:s,createConversation:a,updateConversation:l,deleteConversation:c,addMessage:d}}async function nr(e,t,r=1){try{const s=await fetch(e,t);return!s.ok&&(s.status===502||s.status===504)&&r>0?(console.log(`⚠️ Error ${s.status}, reintentando... (${r} reintentos restantes)`),await new Promise(n=>setTimeout(n,1e3)),nr(e,t,r-1)):s}catch(s){if(r>0&&(s.name==="TypeError"||s.message.includes("timeout")))return console.log(`⚠️ Error de red, reintentando... (${r} reintentos restantes)`),await new Promise(n=>setTimeout(n,1e3)),nr(e,t,r-1);throw s}}async function du({accessToken:e,userId:t,message:r,sessionId:s,workspaceId:n,projectId:i,userEmail:a,userDisplayName:l,meta:c,files:d,signal:u}){const f="https://api.al-eon.com/api/ai/truth-chat";if(console.log("✅ ALE CORE URL (truth-chat) =>",f),!e)throw new Error("❌ Missing accessToken");if(!r||!r.trim())throw new Error("❌ Message is required");const m={messages:[{role:"user",content:r.trim()}],userId:t||e,sessionId:s||void 0,workspaceId:n||"core",projectId:i||void 0,userEmail:a||void 0,userDisplayName:l||void 0,userConfirmed:!1,mode:"universal",meta:c||{platform:"AL-EON",version:"1.0.0",source:"al-eon-console",timestamp:new Date().toISOString()}};d&&d.length>0&&(m.attachments=d,console.log("📎 Archivos adjuntos:",d.length,d)),console.log("📤 PAYLOAD (v2):",JSON.stringify(m,null,2));const g={method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(m)};u&&(g.signal=u);try{const x=await nr(f,g,1),y=await x.text();if(!x.ok){let b=`Error ${x.status}`;try{const p=JSON.parse(y);b=(p==null?void 0:p.safe_message)||(p==null?void 0:p.error)||(p==null?void 0:p.message)||b}catch{y&&y.length<200?b=y:b=`Error ${x.status}: No se pudo procesar la respuesta`}throw new Error(b)}return JSON.parse(y)}catch(x){throw x.name==="AbortError"?(console.log("🛑 Request cancelado"),new Error("Request cancelado")):(console.error("❌ Error comunicándose con AL-E Core:",x),x)}}function uu(e){if(console.log("📥 Respuesta completa de AL-E Core:",e),typeof e=="string")return console.log("✅ Respuesta ya es string:",e),e;if(typeof e!="object"||e===null)return console.warn("⚠️ Respuesta no es objeto, convirtiendo a string:",e),String(e);if(e.success===!1&&e.userMessage)return console.log("⚠️ success=false -> mostrando userMessage del CORE"),e.userMessage;if(e.answer&&typeof e.answer=="string")return console.log("✅ Extrayendo data.answer"),e.answer;if(e.userMessage&&typeof e.userMessage=="string")return console.log("✅ Extrayendo data.userMessage"),e.userMessage;const t=e.message||e.content||e.reply||e.response||e.text;return t&&typeof t=="string"?(console.log("✅ Respuesta extraída de campo alternativo"),t):(console.error('❌ FORMATO INVÁLIDO - No se encontró campo "answer" o "userMessage"'),console.error("❌ Estructura recibida:",Object.keys(e)),"Error: respuesta inválida del servidor")}function hu(e){console.log("📥 Extrayendo respuesta completa con metadata:",e);const t=uu(e),r={answer:t,toolsUsed:e.toolsUsed||[],executionTime:e.executionTime||0,metadata:e.metadata||null,debug:e.debug||null};return console.log("✅ Respuesta completa extraída:",{answer:t.substring(0,100)+"...",toolsUsed:r.toolsUsed,executionTime:r.executionTime,hasMetadata:!!r.metadata,hasDebug:!!r.debug}),r}function fu({currentConversation:e,addMessage:t,updateConversation:r,accessToken:s,userId:n}){const[i,a]=v.useState(!1),[l,c]=v.useState(!1),[d,u]=v.useState(null),[h,f]=v.useState(null),[m,g]=v.useState(null),[x,y]=v.useState({enabled:!1,gender:"female",voice_name:null,lang:"es-MX"}),b=v.useRef(null);return v.useEffect(()=>{(async()=>{var P,T;const{data:{user:C}}=await O.auth.getUser();if(C){f(C.email),g(((P=C.user_metadata)==null?void 0:P.display_name)||((T=C.email)==null?void 0:T.split("@")[0]));const{data:N}=await O.from("user_settings").select("tts_enabled, tts_gender, tts_voice_name, tts_lang").eq("user_id",C.id).single();N&&(y({enabled:N.tts_enabled??!1,gender:N.tts_gender||"female",voice_name:N.tts_voice_name||null,lang:N.tts_lang||"es-MX"}),console.log("[TTS] Preferencias cargadas:",N))}})()},[]),v.useEffect(()=>()=>{b.current&&(console.log("🛑 useChat: Aborting request on unmount"),b.current.abort())},[]),{sendMessage:async(w,C=[],P=null)=>{if(!(!e||!w.trim())){if(!s)throw new Error("No hay sesión activa");a(!0),u(null);try{let T=[];if(e!=null&&e.project_id&&n){console.log("📁 Buscando documentos del proyecto:",e.project_id);try{const D=`${n}/projects/${e.project_id}/`,{data:z,error:G}=await O.storage.from("user-files").list(D,{limit:100,offset:0});!G&&z&&z.length>0&&(console.log(`✅ Encontrados ${z.length} documentos del proyecto`),T=z.map(M=>{var oe,Z;const{data:{publicUrl:K}}=O.storage.from("user-files").getPublicUrl(`${D}${M.name}`);return{name:M.name,url:K,size:((oe=M.metadata)==null?void 0:oe.size)||0,type:((Z=M.metadata)==null?void 0:Z.mimetype)||"application/octet-stream"}}),console.log("📄 Documentos del proyecto que se enviarán:",T.map(M=>M.name)))}catch(D){console.warn("⚠️ Error obteniendo documentos del proyecto:",D)}}let N=[];if(C&&C.length>0){if(!n)throw new Error("Usuario no autenticado. No se pueden subir archivos.");c(!0),console.log("📤 Subiendo archivos adjuntos:",C.map(D=>D.name)),N=await Kd(C,n),console.log("✅ Archivos adjuntos subidos:",N),c(!1)}const R=[...T,...N.map(D=>({name:D.name,url:D.url,type:D.type,size:D.size}))];console.log(`📦 Total de archivos a enviar: ${R.length} (${T.length} del proyecto + ${N.length} adjuntos)`);const E={id:nt(),role:"user",content:w.trim(),attachments:N.map(D=>({bucket:D.bucket,path:D.path,name:D.name,url:D.url,type:D.type,size:D.size})),timestamp:Date.now()};t(e.id,E),console.log("📤 Enviando a AL-E Core - SOLO mensaje actual"),b.current=new AbortController;const I=setTimeout(()=>{b.current&&(console.warn("⏰ Timeout de 60s alcanzado, cancelando request..."),b.current.abort())},6e4),L="core",B=localStorage.getItem(`sessionId:${e.id}`),S=e.sessionId||B||null;S&&console.log("🔄 Usando sessionId persistente:",S);const F=await du({accessToken:s,userId:n,message:w.trim(),sessionId:S,workspaceId:L,projectId:e.project_id||null,userEmail:h,userDisplayName:m,meta:{platform:"AL-EON",version:"1.0.0",source:"al-eon-console",timestamp:new Date().toISOString(),...P&&{inputMode:P.inputMode||"text",localeHint:P.localeHint||"es-MX",handsFree:P.handsFree||!1}},files:R.length>0?R:void 0,signal:b.current.signal});clearTimeout(I),F.session_id&&!e.sessionId&&(console.log("💾 Guardando session_id del backend:",F.session_id),r(e.id,{sessionId:F.session_id}),localStorage.setItem(`sessionId:${e.id}`,F.session_id));const k=hu(F);if(!k.answer||typeof k.answer!="string")throw console.error("❌ Respuesta inválida del asistente"),new Error("Respuesta inválida del asistente");const _={id:nt(),role:"assistant",content:k.answer,timestamp:Date.now(),toolsUsed:k.toolsUsed,executionTime:k.executionTime,metadata:k.metadata,debug:k.debug};return t(e.id,_),x.enabled&&F.should_speak!==!1&&(console.log("[TTS] 🔊 Hablando respuesta del asistente..."),_n(k.answer,{lang:x.lang,voiceName:x.voice_name,gender:x.gender}).catch(D=>{console.error("[TTS] ❌ Error al hablar:",D)})),k.answer}catch(T){console.error("❌ Error enviando mensaje:",T),u(T.message);const N={id:nt(),role:"assistant",content:T.message||"Error desconocido",timestamp:Date.now(),isError:!0};return t(e.id,N),null}finally{a(!1),c(!1),b.current=null}}},stopResponse:()=>{Bn(),b.current&&(console.log("🛑 Cancelando request..."),b.current.abort(),b.current=null,a(!1),c(!1))},isLoading:i,isUploading:l,error:d}}const zt={}.VITE_CORE_BASE_URL||"https://api.al-entity.com";function mu({accessToken:e,sessionId:t,workspaceId:r="core",enabled:s=!0,onResponse:n,onError:i,handsFreeEnabled:a=!1}={}){const[l,c]=v.useState("text"),[d,u]=v.useState("idle"),[h,f]=v.useState(!1),[m,g]=v.useState(null),[x,y]=v.useState(""),b=v.useRef(null),p=v.useRef([]),j=v.useRef(null),w=v.useRef(null),C=v.useRef(a),P=v.useRef(null);v.useEffect(()=>{C.current=a},[a]);const T=v.useCallback(()=>{b.current&&b.current.state!=="inactive"&&(console.log("🛑 Deteniendo grabación..."),b.current.stop())},[]),N=v.useCallback(()=>{j.current&&(console.log("🔇 Deteniendo audio..."),j.current.pause(),j.current.currentTime=0,j.current=null),d==="speaking"&&u("idle")},[d]);if(v.useEffect(()=>()=>{T(),N(),P.current&&P.current.getTracks().forEach(S=>S.stop())},[T,N]),!s)return{mode:"text",status:"idle",isListening:!1,isSending:!1,error:null,transcript:"",setMode:()=>{},startListening:()=>{},stopRecording:()=>{},stopAudio:()=>{},stopAll:()=>{}};const R=v.useCallback(async()=>{if(h){console.warn("⚠️ Ya hay un proceso en curso, esperando...");return}if(!e){const S=new Error("No hay sesión activa");g(S),i==null||i(S);return}try{console.log("🎤 [P0-2] Iniciando grabación..."),console.log("🎤 [P0-2] Solicitando permisos de micrófono...");const S=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});if(!S||S.getAudioTracks().length===0)throw new Error("No se pudo acceder al micrófono. Verifica permisos.");console.log("✅ [P0-2] Permisos concedidos, tracks activos:",S.getAudioTracks().length);const F=S.getAudioTracks()[0];console.log("🎙️ [P0-2] Track info:",{label:F.label,enabled:F.enabled,readyState:F.readyState,muted:F.muted}),P.current=S;const k=MediaRecorder.isTypeSupported("audio/webm;codecs=opus")?"audio/webm;codecs=opus":MediaRecorder.isTypeSupported("audio/webm")?"audio/webm":"audio/mp4",_=new MediaRecorder(S,{mimeType:k});b.current=_,p.current=[],_.ondataavailable=D=>{console.log(`📊 [DEBUG] ondataavailable disparado - size: ${D.data.size} bytes`),D.data&&D.data.size>0?(console.log(`✅ [P0-2] Chunk válido recibido: ${D.data.size} bytes`),p.current.push(D.data)):console.error("❌ [P0-2] Chunk vacío o inválido recibido")},_.onstop=async()=>{console.log("🛑 [P0-2] Grabación detenida, procesando..."),console.log(`📦 [P0-2] Total chunks: ${p.current.length}`),P.current&&(P.current.getTracks().forEach(M=>M.stop()),P.current=null);const D=p.current.filter(M=>M.size>0),z=new Blob(D,{type:k}),G=z.size;if(console.log(`🎵 [P0-2] Blob creado: ${G} bytes, tipo: ${z.type}`),console.log(`✅ [P0-2] BYTES GRABADOS: ${G} bytes (${p.current.length} chunks)`),p.current=[],G<100){const M=`❌ [P0-2] GRABACIÓN FALLÓ - Solo se capturaron ${G} bytes`;console.error(M),console.error("🔍 [DEBUG] Información de debugging:",{chunks:p.current.length,validChunks:D.length,mimeType:k,streamWasActive:!!P.current,recorderState:_.state}),u("idle");const K=new Error(`Error de captura: solo se grabaron ${G} bytes. Mantén presionado el botón al menos 3 segundos mientras hablas en voz alta.`);g(K),i==null||i(K);return}console.log(`✅ [P0-2] Audio válido: ${G} bytes - Enviando al backend...`),await E(z)},console.log("🎤 [P0-2] Iniciando MediaRecorder SIN timeslice para capturar todo"),_.start(),u("recording"),g(null),y(""),console.log("✅ [P0-2] Grabación iniciada - recording continuo"),console.log("🎤 [P0-2] Estado del recorder:",_.state),console.log("🎙️ [P0-2] Tracks de audio:",S.getAudioTracks().length),console.log("🎙️ [P0-2] Track 0 settings:",F.getSettings())}catch(S){if(console.error("❌ [P0-2] Error al iniciar grabación:",S),S.name==="NotAllowedError"||S.name==="PermissionDeniedError"){const F=new Error("Debes permitir el acceso al micrófono en la configuración de tu navegador.");g(F),i==null||i(F)}else if(S.name==="NotFoundError"){const F=new Error("No se encontró ningún micrófono. Conecta uno e intenta de nuevo.");g(F),i==null||i(F)}else g(S),i==null||i(S);u("idle")}},[h,e,i]),E=v.useCallback(async S=>{if(!S||S.size===0){const k="No se detectó audio. Verifica que tu micrófono esté funcionando y que hayas hablado.";console.error("❌ [Voice] Audio blob vacío:",{size:(S==null?void 0:S.size)||0}),g(k),u("idle"),f(!1),i==null||i(new Error(k));return}console.log("✅ [Voice] Audio válido:",{size:S.size,type:S.type}),f(!0),u("processing"),w.current=new AbortController;const F=setTimeout(()=>{var k;return(k=w.current)==null?void 0:k.abort()},6e4);try{console.log("📤 Enviando audio a /api/voice/transcribe...");const k=Nt();console.log(`[REQ-VOICE] 📤 STT - id=${k} sessionId=${t}`);const _=new FormData;_.append("audio",ke,"voice-message.webm"),_.append("sessionId",t),r&&_.append("workspaceId",r),_.append("meta",JSON.stringify({platform:"web",version:"1.0",timestamp:new Date().toISOString()}));const D=await fetch(`${zt}/api/voice/transcribe`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"x-request-id":k},body:_,signal:w.current.signal});if(!D.ok){const ne=await D.json().catch(()=>({}));throw Fe(k,"/api/voice/transcribe",{status:D.status,error:ne.error,sessionId:t}),new Error(ne.error||`STT Error: ${D.status}`)}const z=await D.json(),G=z.text||z.transcript||"";if(!G.trim())throw Fe(k,"/api/voice/transcribe",{error:"No voice detected",sessionId:t}),new Error("No se detectó voz en el audio");console.log(`✅ STT: "${G}"`),Tt(k,"/api/voice/transcribe",D.status,{sessionId:t,textLength:G.length}),y(G),console.log("💬 Enviando mensaje al chat...");const M=Nt();console.log(`[REQ-VOICE] 📤 CHAT - id=${M} sessionId=${t}`);const K=await fetch(`${zt}/api/ai/chat`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","x-request-id":M},body:JSON.stringify({message:G,sessionId:t,workspaceId:r,meta:{inputMode:"voice",platform:"web",handsFree:C.current}}),signal:w.current.signal});if(!K.ok){const ne=await K.json().catch(()=>({}));throw Fe(M,"/api/ai/chat",{status:K.status,error:ne.error,sessionId:t}),new Error(ne.error||`Chat Error: ${K.status}`)}const oe=await K.json(),Z=oe.response||oe.message||"";if(!Z.trim())throw Fe(M,"/api/ai/chat",{error:"Empty response",sessionId:t}),new Error("Respuesta vacía del asistente");console.log(`✅ Respuesta: "${Z.substring(0,100)}..."`),Tt(M,"/api/ai/chat",K.status,{sessionId:t,responseLength:Z.length}),n==null||n(Z),console.log("🔊 Solicitando audio con /api/voice/tts...");const A=Nt();console.log(`[REQ-VOICE] 📤 TTS - id=${A} sessionId=${t}`);const $=await fetch(`${zt}/api/voice/tts`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","x-request-id":A},body:JSON.stringify({text:Z,voice:"mx_female_default",format:"mp3"}),signal:w.current.signal});if(!$.ok){const ne=await $.json().catch(()=>({}));throw Fe(A,"/api/voice/tts",{status:$.status,error:ne.error,sessionId:t}),new Error(ne.error||`TTS Error: ${$.status}`)}const ke=await $.blob();Tt(A,"/api/voice/tts",$.status,{sessionId:t,audioBlobSize:ke.size}),console.log("🎵 Reproduciendo respuesta..."),await I(ke),console.log("✅ Ciclo de voz completado"),l==="voice"&&C.current?(console.log("🔄 Modo manos libres: reiniciando grabación..."),setTimeout(()=>{l==="voice"&&C.current&&!h&&R()},500)):u("idle")}catch(k){if(console.error("❌ Error en ciclo de voz:",k),k.name==="AbortError"){const _=new Error("Timeout: La solicitud tardó más de 60 segundos");g(_),i==null||i(_)}else g(k),i==null||i(k);u("idle")}finally{clearTimeout(F),f(!1),w.current=null}},[e,t,r,l,n,i,R]),I=v.useCallback(S=>new Promise((F,k)=>{const _=URL.createObjectURL(S),D=new Audio(_);j.current=D,D.onended=()=>{console.log("✅ Audio reproducido completamente"),URL.revokeObjectURL(_),u("idle"),F()},D.onerror=z=>{console.error("❌ Error al reproducir audio:",z),URL.revokeObjectURL(_),u("idle"),k(z)},u("speaking"),D.play().catch(k)}),[]),L=v.useCallback(S=>{console.log(`🔄 Cambiando modo: ${l} → ${S}`),T(),N(),w.current&&w.current.abort(),u("idle"),c(S),S==="voice"&&C.current&&!h&&setTimeout(()=>R(),500)},[l,T,N,h,R]),B=v.useCallback(()=>{console.log("🛑 Deteniendo todo..."),T(),N(),w.current&&w.current.abort(),u("idle"),f(!1)},[T,N]);return{mode:l,status:d,isSending:h,error:m,transcript:x,setMode:L,startRecording:R,stopRecording:T,stopAll:B,startListening:R,isListening:d==="recording",isRecording:d==="recording",isProcessing:d==="processing",isSpeaking:d==="speaking",isIdle:d==="idle"}}function pu(e){const t=v.useRef(new Set),r=v.useRef(null);v.useEffect(()=>{if(!e)return;if(Ln()!=="granted"){console.log("ℹ️ Notificaciones no habilitadas");return}console.log("✅ Sistema de notificaciones de eventos activado");const s=async()=>{try{const n=new Date,i=new Date(n.getTime()+30*6e4),{data:a,error:l}=await O.from("calendar_events").select("*").eq("owner_user_id",e).gte("start_at",n.toISOString()).lte("start_at",i.toISOString()).order("start_at",{ascending:!0});if(l){console.error("Error obteniendo eventos:",l);return}if(!a||a.length===0)return;console.log(`📅 ${a.length} evento(s) próximo(s) encontrado(s)`);for(const u of a){const h=`${u.id}-${u.start_at}`;if(!t.current.has(h)){const f=Math.floor((new Date(u.start_at)-n)/6e4);f<=30&&(console.log(`🔔 Notificando evento: ${u.title} en ${f} min`),Fn(u),t.current.add(h))}}const c=new Date(n.getTime()-60*6e4),d=[];for(const u of t.current){const[,h]=u.split("-");new Date(h)<c&&d.push(u)}d.forEach(u=>t.current.delete(u))}catch(n){console.error("Error verificando eventos:",n)}};return s(),r.current=setInterval(s,6e4),()=>{r.current&&clearInterval(r.current)}},[e])}function Yu(){const{user:e,userProfile:t,accessToken:r,logout:s}=Ke(),[n]=An(),[i,a]=v.useState(!1),l=n.get("mode")==="voice";pu(e==null?void 0:e.id),console.log("🔍 [ChatPage] userProfile:",t),console.log("🔍 [ChatPage] assistant_avatar_url:",t==null?void 0:t.assistant_avatar_url),console.log("🔍 [ChatPage] assistant_name:",t==null?void 0:t.assistant_name);const c=Qs("voice"),[d,u]=v.useState(()=>typeof window<"u"?window.innerWidth>=768:!1),{conversations:h,currentConversationId:f,currentConversation:m,setCurrentConversationId:g,createConversation:x,updateConversation:y,deleteConversation:b,addMessage:p}=cu(),{sendMessage:j,stopResponse:w,isLoading:C,isUploading:P}=fu({currentConversation:m,addMessage:p,updateConversation:y,accessToken:r,userId:e==null?void 0:e.id}),T=mu({accessToken:r,sessionId:(m==null?void 0:m.session_id)||(m==null?void 0:m.id),workspaceId:"core",enabled:c,onResponse:S=>{console.log("✅ [Voice] Respuesta de AL-E:",S.substring(0,100))},onError:S=>{console.error("❌ [Voice] Error:",S),alert(`Error de voz: ${S.message}`)},handsFreeEnabled:i});v.useEffect(()=>{l&&T&&T.mode!=="voice"&&(console.log("🎤 Activando modo voz desde URL..."),T.setMode("voice"))},[l,T]);const N=(S=null)=>{x(S)},R=S=>{g(S)},E=async(S,F)=>{m||x(),await j(S,F)},I=()=>{a(!i)},L=()=>{w()},B=async()=>{if(!m||m.messages.length<2)return;const S=m.messages.slice(0,-1);y(m.id,{messages:S});const F=S[S.length-1];F&&F.role==="user"&&await j(F.content,F.attachments||[])};return o.jsxs("div",{className:"h-full flex overflow-hidden",style:{backgroundColor:"var(--color-bg-primary)",width:"100vw",maxWidth:"100vw"},children:[o.jsx("div",{className:`
        fixed inset-y-0 left-0 z-50 transform transition-transform duration-300 ease-in-out
        md:relative md:transform-none
        ${d?"translate-x-0":"-translate-x-full md:translate-x-0"}
      `,children:o.jsx(eu,{conversations:h,currentConversationId:f,onNewConversation:N,onSelectConversation:R,onUpdateConversation:y,onDeleteConversation:b,isOpen:d,currentUser:(t==null?void 0:t.display_name)||(e==null?void 0:e.email),onLogout:s})}),d&&o.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 md:hidden",onClick:()=>u(!1)}),o.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",style:{width:"100%",maxWidth:"100%"},children:[o.jsx(Vd,{conversation:m,isLoading:C,voiceMode:T,handsFree:i,onToggleHandsFree:I,onToggleSidebar:()=>u(!d),onStopResponse:L,onRegenerateResponse:B,currentUser:(t==null?void 0:t.display_name)||(e==null?void 0:e.email)||"Usuario",assistantName:(t==null?void 0:t.assistant_name)||"Luma",assistantAvatar:t==null?void 0:t.assistant_avatar_url,userAvatar:t==null?void 0:t.user_avatar_url}),o.jsx(Fd,{onSendMessage:E,isLoading:C,isUploading:P,disabled:(T==null?void 0:T.mode)==="voice"})]})]})}export{Yu as default};
